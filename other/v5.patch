From 38881a0a8ae4b55136fa4d53777c130b1d6b4986 Mon Sep 17 00:00:00 2001
From: gexudong <gexudong@xiaomi.com>
Date: Thu, 21 Feb 2013 14:32:28 +0800
Subject: [PATCH 1/6] merge V5 for note2

Change-Id: I574a632faef164294b047ab38e48871a12e2db1c
---
 MiuiHome/res/values-xhdpi/dimens.xml.part          |   17 -
 OriginalSettings/AndroidManifest.xml               |    2 +-
 .../impl/KeyguardUpdateMonitor$SimArgs.smali       |    6 +-
 .../policy/impl/KeyguardUpdateMonitor.smali        |   43 +-
 .../internal/policy/impl/KeyguardViewManager.smali |    3 +
 .../policy/impl/KeyguardViewMediator.smali         |  546 ++++-----------
 .../policy/impl/LockPatternKeyguardView$3.smali    |    1 -
 .../LockPatternKeyguardView$AccountAnalyzer.smali  |    9 +-
 .../policy/impl/LockPatternKeyguardView.smali      |  109 +++-
 .../policy/impl/PasswordUnlockScreen.smali         |  107 +++
 .../policy/impl/PhoneWindow$DecorView.smali        |   87 +++-
 .../android/internal/policy/impl/PhoneWindow.smali |   80 ++-
 customize_framework.sh                             |    8 +-
 framework.jar.out/smali/android/app/Activity.smali |   55 ++-
 .../android/app/ApplicationPackageManager.smali    |  721 +++++---------------
 framework.jar.out/smali/android/app/Dialog.smali   |   64 ++-
 .../smali/android/app/ListActivity.smali           |   30 -
 .../smali/android/app/ProgressDialog.smali         |   19 +-
 .../smali/android/app/StatusBarManager.smali       |   39 ++
 .../smali/android/content/ClipboardManager.smali   |   38 +
 .../smali/android/content/res/Resources.smali      |   23 +-
 .../graphics/drawable/AnimatedRotateDrawable.smali |   21 +-
 .../smali/android/graphics/drawable/Drawable.smali |   54 +-
 .../DrawableContainer$DrawableContainerState.smali |   12 +
 .../smali/android/hardware/SensorManager.smali     |   10 +
 .../smali/android/media/AudioService.smali         |  112 ++--
 .../smali/android/media/MediaFile.smali            |    6 +
 .../smali/android/media/MediaScanner.smali         |  142 +----
 framework.jar.out/smali/android/text/SpanSet.smali |   36 +-
 .../smali/android/util/TypedValue.smali            |  114 ++--
 .../smali/android/view/LayoutInflater.smali        |   14 +-
 framework.jar.out/smali/android/view/View.smali    |   78 ++-
 .../smali/android/view/ViewConfiguration.smali     |  104 ++-
 .../smali/android/view/ViewGroup.smali             |   88 ++-
 .../smali/android/webkit/WebViewClassic.smali      |    5 +-
 .../com/android/internal/app/ActionBarImpl.smali   |  296 ++++++++-
 .../app/ResolverActivity$ResolveListAdapter.smali  |   32 +-
 .../android/internal/app/ResolverActivity.smali    |   42 +-
 .../internal/statusbar/IStatusBar$Stub$Proxy.smali |   71 ++
 .../android/internal/statusbar/IStatusBar.smali    |    8 +
 .../statusbar/IStatusBarService$Stub$Proxy.smali   |   83 +++
 .../internal/statusbar/IStatusBarService.smali     |    8 +
 .../internal/telephony/TelephonyCapabilities.smali |    2 +-
 .../android/preference/CheckBoxPreference.smali    |    2 +-
 .../smali/android/preference/Preference.smali      |   45 ++
 .../PreferenceActivity$HeaderAdapter.smali         |   21 +-
 .../android/preference/PreferenceActivity.smali    |    3 +
 .../smali/android/preference/PreferenceGroup.smali |   15 +-
 .../android/preference/PreferenceScreen.smali      |   16 +-
 .../speech/tts/TextToSpeech$Connection.smali       |   30 +
 .../smali/android/speech/tts/TextToSpeech.smali    |   27 +
 .../smali/android/widget/CompoundButton.smali      |  246 ++++++-
 .../smali/android/widget/DatePicker.smali          |  173 +++++-
 .../smali/android/widget/EdgeEffect.smali          |   12 +
 .../smali/android/widget/Editor.smali              |    5 +
 .../smali/android/widget/NumberPicker.smali        |  402 ++++++++++--
 .../smali/android/widget/PopupWindow.smali         |   42 +-
 .../smali/android/widget/QuickContactBadge.smali   |    8 +
 .../smali/android/widget/TimePicker.smali          |   43 ++
 .../internal/view/menu/ListMenuItemView.smali      |   57 ++-
 .../android/internal/view/menu/MenuBuilder.smali   |   48 ++
 .../internal/widget/ActionBarContainer.smali       |   16 +-
 .../internal/widget/ActionBarContextView.smali     |  171 ++++-
 ...onBarView$ExpandedActionViewMenuPresenter.smali |   20 +-
 .../android/internal/widget/ActionBarView.smali    |  340 ++++++++--
 .../android/internal/widget/LockPatternUtils.smali |  638 +++---------------
 ...crollingTabContainerView$TabClickListener.smali |    4 +
 .../widget/ScrollingTabContainerView.smali         |   34 +-
 .../android/server/InputMethodManagerService.smali |   35 +
 .../android/server/StatusBarManagerService.smali   |  206 +++++-
 .../android/server/am/ActivityManagerService.smali |   12 +-
 .../com/android/server/am/ActivityStack.smali      |  101 ++-
 .../com/android/server/am/BaseErrorDialog.smali    |    2 +-
 .../com/android/server/am/UsageStatsService.smali  |   69 ++-
 .../server/net/NetworkPolicyManagerService.smali   |   34 +-
 .../android/server/pm/PackageManagerService.smali  |   14 +-
 .../com/android/server/pm/ShutdownThread.smali     |    4 +-
 .../smali/com/android/server/pm/UserManager.smali  |   50 +-
 .../android/server/wm/WindowManagerService.smali   |    1 +
 79 files changed, 3913 insertions(+), 2378 deletions(-)
 delete mode 100644 MiuiHome/res/values-xhdpi/dimens.xml.part

--- a/MiuiHome/res/values-xhdpi/dimens.xml.part
+++ b/MiuiHome/res/values-xhdpi/dimens.xml.part
@@ -1,17 +0,0 @@
-<?xml version="1.0" encoding="utf-8"?>
-<resources>
-    <dimen name="config_icon_width">62.5dip</dimen>
-    <dimen name="config_icon_height">62.5dip</dimen>
-    <dimen name="workspace_padding_side">12.0dip</dimen>
-    <dimen name="workspace_margin_bottom">82.0dip</dimen>
-    <dimen name="hotseats_padding_side">8.5dip</dimen>
-    <dimen name="user_folder_cell_height">95.0dip</dimen>
-    <dimen name="icon_title_padding_bottom">0.0dip</dimen>
-    <item type="dimen" name="workspace_icon_text_shadow_radius">2.0</item>
-    <item type="dimen" name="workspace_icon_text_shadow_dx">0.0</item>
-    <item type="dimen" name="workspace_icon_text_shadow_dy">3.8</item>
-    <dimen name="upside_apps_btn_text_size">13.0sp</dimen>
-    <dimen name="workspace_cell_padding_bottom">28.0dip</dimen>
-    <dimen name="workspace_icon_text_size">13.0sp</dimen>
-    <dimen name="user_folder_cell_width">90.0dip</dimen>
-</resources>
--- a/OriginalSettings/AndroidManifest.xml
+++ b/OriginalSettings/AndroidManifest.xml
@@ -57,7 +57,7 @@
     <uses-permission android:name="com.android.setting.permission.ALLSHARE_CAST_SERVICE" />
     <uses-permission android:name="com.sec.android.app.twdvfs.DVFS_BOOSTER_PERMISSION" />
     <permission android:label="@string/wfd_settings_summary" android:name="com.android.setting.permission.ALLSHARE_CAST_SERVICE" android:protectionLevel="dangerous" android:permissionGroup="android.permission-group.PERSONAL_INFO" />
-    <application android:theme="@miui:style/Theme.Light" android:label="@string/settings_label" android:icon="@mipmap/ic_launcher_settings" android:taskAffinity="" android:hardwareAccelerated="@bool/hardwareAccelerated" android:uiOptions="splitActionBarWhenNarrow">
+    <application android:theme="@miui:style/V5.Theme" android:label="@string/settings_label" android:icon="@mipmap/ic_launcher_settings" android:taskAffinity="" android:hardwareAccelerated="@bool/hardwareAccelerated" android:uiOptions="splitActionBarWhenNarrow">
         <meta-data android:name="android.nfc.disable_beam_default" android:value="true" />
         <uses-library android:name="sechardware" />
         <uses-library android:name="sec_platform_library" />
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardUpdateMonitor$SimArgs.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardUpdateMonitor$SimArgs.smali
@@ -1,11 +1,11 @@
-.class Lcom/android/internal/policy/impl/KeyguardUpdateMonitor$SimArgs;
+.class public Lcom/android/internal/policy/impl/KeyguardUpdateMonitor$SimArgs;
 .super Ljava/lang/Object;
 .source "KeyguardUpdateMonitor.java"
 
 
 # annotations
 .annotation build Landroid/annotation/MiuiHook;
-    value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE_AND_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
 .end annotation
 
 .annotation system Ldalvik/annotation/EnclosingClass;
@@ -13,7 +13,7 @@
 .end annotation
 
 .annotation system Ldalvik/annotation/InnerClass;
-    accessFlags = 0xa
+    accessFlags = 0xc
     name = "SimArgs"
 .end annotation
 
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardUpdateMonitor.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardUpdateMonitor.smali
@@ -209,6 +209,12 @@
     .end annotation
 .end field
 
+.field private mSkipSimStateChange:Z
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mTelephonyPlmn:Ljava/lang/CharSequence;
 
 .field private mTelephonySpn:Ljava/lang/CharSequence;
@@ -218,6 +224,9 @@
 .method public constructor <init>(Landroid/content/Context;)V
     .locals 7
     .parameter "context"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v3, 0x1
@@ -226,6 +235,8 @@
 
     invoke-direct/range {p0 .. p0}, Ljava/lang/Object;-><init>()V
 
+    iput-boolean v4, p0, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;->mSkipSimStateChange:Z
+
     sget-object v2, Lcom/android/internal/telephony/IccCard$State;->READY:Lcom/android/internal/telephony/IccCard$State;
 
     iput-object v2, p0, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;->mSimState:Lcom/android/internal/telephony/IccCard$State;
@@ -1790,8 +1801,19 @@
 .method private handleSimStateChange(Lcom/android/internal/policy/impl/KeyguardUpdateMonitor$SimArgs;)V
     .locals 3
     .parameter "simArgs"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
+    iget-boolean v2, p0, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;->mSkipSimStateChange:Z
+
+    if-eqz v2, :cond_1
+
+    :cond_0
+    return-void
+
+    :cond_1
     iget-object v1, p1, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor$SimArgs;->simState:Lcom/android/internal/telephony/IccCard$State;
 
     .local v1, state:Lcom/android/internal/telephony/IccCard$State;
@@ -1830,10 +1852,6 @@
     add-int/lit8 v0, v0, 0x1
 
     goto :goto_0
-
-    .end local v0           #i:I
-    :cond_0
-    return-void
 .end method
 
 .method private handleTimeUpdate()V
@@ -2978,6 +2996,19 @@
 
     return-void
 .end method
+
+.method public setSkipSimStateChange(Z)V
+    .locals 0
+    .parameter "skip"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-boolean p1, p0, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;->mSkipSimStateChange:Z
+
+    return-void
+.end method
 
 .method public shouldShowBatteryInfo()Z
     .locals 1
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardViewManager.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardViewManager.smali
@@ -145,6 +145,9 @@
 
 .method public declared-synchronized hide()V
     .locals 5
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     monitor-enter p0
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardViewMediator.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/KeyguardViewMediator.smali
@@ -351,9 +351,9 @@
 
     iput-object p2, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mCallback:Lcom/android/internal/policy/impl/PhoneWindowManager;
 
-    new-instance v0, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;
+    new-instance v0, Lcom/android/internal/policy/impl/MiuiKeyguardUpdateMonitor;
 
-    invoke-direct {v0, p1}, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;-><init>(Landroid/content/Context;)V
+    invoke-direct {v0, p1}, Lcom/android/internal/policy/impl/MiuiKeyguardUpdateMonitor;-><init>(Landroid/content/Context;)V
 
     iput-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mUpdateMonitor:Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;
 
@@ -1506,7 +1506,7 @@
 
     const/4 v0, 0x0
 
-    invoke-direct {p0, v0}, Lcom/android/internal/policy/impl/KeyguardViewMediator;->playSounds(Z)V
+    invoke-virtual {p0, v0}, Lcom/android/internal/policy/impl/KeyguardViewMediator;->playSounds(Z)V
 
     :cond_1
     iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mKeyguardViewManager:Lcom/android/internal/policy/impl/KeyguardViewManager;
@@ -1802,7 +1802,7 @@
     :cond_0
     const/4 v0, 0x1
 
-    invoke-direct {p0, v0}, Lcom/android/internal/policy/impl/KeyguardViewMediator;->playSounds(Z)V
+    invoke-virtual {p0, v0}, Lcom/android/internal/policy/impl/KeyguardViewMediator;->playSounds(Z)V
 
     iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mKeyguardViewManager:Lcom/android/internal/policy/impl/KeyguardViewManager;
 
@@ -2346,115 +2346,6 @@
     throw v0
 .end method
 
-.method private playSounds(Z)V
-    .locals 8
-    .parameter "locked"
-
-    .prologue
-    const/4 v5, 0x0
-
-    const/4 v4, 0x1
-
-    iget-boolean v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mSuppressNextLockSound:Z
-
-    if-eqz v0, :cond_1
-
-    iput-boolean v5, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mSuppressNextLockSound:Z
-
-    :cond_0
-    :goto_0
-    return-void
-
-    :cond_1
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mContext:Landroid/content/Context;
-
-    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
-
-    move-result-object v7
-
-    .local v7, cr:Landroid/content/ContentResolver;
-    const-string v0, "lockscreen_sounds_enabled"
-
-    invoke-static {v7, v0, v4}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;I)I
-
-    move-result v0
-
-    if-ne v0, v4, :cond_0
-
-    if-eqz p1, :cond_3
-
-    iget v1, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundId:I
-
-    .local v1, whichSound:I
-    :goto_1
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSounds:Landroid/media/SoundPool;
-
-    iget v2, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundStreamId:I
-
-    invoke-virtual {v0, v2}, Landroid/media/SoundPool;->stop(I)V
-
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
-
-    if-nez v0, :cond_2
-
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mContext:Landroid/content/Context;
-
-    const-string v2, "audio"
-
-    invoke-virtual {v0, v2}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
-
-    move-result-object v0
-
-    check-cast v0, Landroid/media/AudioManager;
-
-    iput-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
-
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
-
-    if-eqz v0, :cond_0
-
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
-
-    invoke-virtual {v0}, Landroid/media/AudioManager;->getMasterStreamType()I
-
-    move-result v0
-
-    iput v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mMasterStreamType:I
-
-    :cond_2
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
-
-    iget v2, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mMasterStreamType:I
-
-    invoke-virtual {v0, v2}, Landroid/media/AudioManager;->isStreamMute(I)Z
-
-    move-result v0
-
-    if-nez v0, :cond_0
-
-    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSounds:Landroid/media/SoundPool;
-
-    iget v2, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundVolume:F
-
-    iget v3, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundVolume:F
-
-    const/high16 v6, 0x3f80
-
-    invoke-virtual/range {v0 .. v6}, Landroid/media/SoundPool;->play(IFFIIF)I
-
-    move-result v0
-
-    iput v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundStreamId:I
-
-    goto :goto_0
-
-    .end local v1           #whichSound:I
-    :cond_3
-    iget v1, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mUnlockSoundId:I
-
-    goto :goto_1
-.end method
-
 .method private resetStateLocked()V
     .locals 3
 
@@ -4085,6 +3976,118 @@
     return v0
 .end method
 
+.method protected playSounds(Z)V
+    .locals 8
+    .parameter "locked"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v5, 0x0
+
+    const/4 v4, 0x1
+
+    iget-boolean v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mSuppressNextLockSound:Z
+
+    if-eqz v0, :cond_1
+
+    iput-boolean v5, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mSuppressNextLockSound:Z
+
+    :cond_0
+    :goto_0
+    return-void
+
+    :cond_1
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v0}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v7
+
+    .local v7, cr:Landroid/content/ContentResolver;
+    const-string v0, "lockscreen_sounds_enabled"
+
+    invoke-static {v7, v0, v4}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;I)I
+
+    move-result v0
+
+    if-ne v0, v4, :cond_0
+
+    if-eqz p1, :cond_3
+
+    iget v1, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundId:I
+
+    .local v1, whichSound:I
+    :goto_1
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSounds:Landroid/media/SoundPool;
+
+    iget v2, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundStreamId:I
+
+    invoke-virtual {v0, v2}, Landroid/media/SoundPool;->stop(I)V
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
+
+    if-nez v0, :cond_2
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mContext:Landroid/content/Context;
+
+    const-string v2, "audio"
+
+    invoke-virtual {v0, v2}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, Landroid/media/AudioManager;
+
+    iput-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
+
+    invoke-virtual {v0}, Landroid/media/AudioManager;->getMasterStreamType()I
+
+    move-result v0
+
+    iput v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mMasterStreamType:I
+
+    :cond_2
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mAudioManager:Landroid/media/AudioManager;
+
+    iget v2, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mMasterStreamType:I
+
+    invoke-virtual {v0, v2}, Landroid/media/AudioManager;->isStreamMute(I)Z
+
+    move-result v0
+
+    if-nez v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSounds:Landroid/media/SoundPool;
+
+    iget v2, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundVolume:F
+
+    iget v3, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundVolume:F
+
+    const/high16 v6, 0x3f80
+
+    invoke-virtual/range {v0 .. v6}, Landroid/media/SoundPool;->play(IFFIIF)I
+
+    move-result v0
+
+    iput v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mLockSoundStreamId:I
+
+    goto :goto_0
+
+    .end local v1           #whichSound:I
+    :cond_3
+    iget v1, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mUnlockSoundId:I
+
+    goto :goto_1
+.end method
+
 .method public pokeWakelock()V
     .locals 1
 
@@ -4595,3 +4598,17 @@
 
     return-void
 .end method
+
+.method suppressNextLockSound()V
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v0, 0x1
+
+    iput-boolean v0, p0, Lcom/android/internal/policy/impl/KeyguardViewMediator;->mSuppressNextLockSound:Z
+
+    return-void
+.end method
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView$3.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView$3.smali
@@ -617,7 +617,6 @@
 
     .local v5, showTimeout:Z
     :goto_3
-    if-eqz v6, :cond_7
 
     iget-object v9, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView$3;->this$0:Lcom/android/internal/policy/impl/LockPatternKeyguardView;
 
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer.smali
@@ -75,6 +75,9 @@
 
 .method private next()V
     .locals 6
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v2, 0x0
@@ -124,7 +127,7 @@
 
     move-result-object v0
 
-    instance-of v0, v0, Lcom/android/internal/policy/impl/PatternUnlockScreen;
+    instance-of v0, v0, Lcom/android/internal/policy/impl/MiuiCommonUnlockScreen;
 
     if-eqz v0, :cond_1
 
@@ -135,7 +138,7 @@
 
     move-result-object v0
 
-    check-cast v0, Lcom/android/internal/policy/impl/PatternUnlockScreen;
+    check-cast v0, Lcom/android/internal/policy/impl/MiuiCommonUnlockScreen;
 
     iget-object v1, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer;->this$0:Lcom/android/internal/policy/impl/LockPatternKeyguardView;
 
@@ -144,7 +147,7 @@
 
     move-result v1
 
-    invoke-virtual {v0, v1}, Lcom/android/internal/policy/impl/PatternUnlockScreen;->setEnableFallback(Z)V
+    invoke-virtual {v0, v1}, Lcom/android/internal/policy/impl/MiuiCommonUnlockScreen;->setEnableFallback(Z)V
 
     goto :goto_0
 
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView.smali
@@ -2275,6 +2275,9 @@
 
 .method private getUnlockMode()Lcom/android/internal/policy/impl/LockPatternKeyguardView$UnlockMode;
     .locals 6
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mUpdateMonitor:Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;
@@ -4701,7 +4704,7 @@
 
     if-ne p1, v3, :cond_0
 
-    new-instance v0, Lcom/android/internal/policy/impl/PatternUnlockScreen;
+    new-instance v0, Lcom/android/internal/policy/impl/MiuiPatternUnlockScreen;
 
     iget-object v1, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mContext:Landroid/content/Context;
 
@@ -4796,7 +4799,7 @@
 
     iget-object v6, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mLockPatternUtils:Lcom/android/internal/widget/LockPatternUtils;
 
-    invoke-direct/range {v1 .. v6}, Lcom/android/internal/policy/impl/SimPukUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;Lcom/android/internal/widget/LockPatternUtils;)V
+    invoke-direct/range {v1 .. v6}, Lcom/android/internal/policy/impl/MiuiSimPUKUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;Lcom/android/internal/widget/LockPatternUtils;)V
 
     .restart local v1       #unlockView:Landroid/view/View;
     goto :goto_0
@@ -4819,7 +4822,7 @@
 
     iget-object v6, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mLockPatternUtils:Lcom/android/internal/widget/LockPatternUtils;
 
-    invoke-direct/range {v1 .. v6}, Lcom/android/internal/policy/impl/SimUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;Lcom/android/internal/widget/LockPatternUtils;)V
+    invoke-direct/range {v1 .. v6}, Lcom/android/internal/policy/impl/MiuiSimPINUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;Lcom/android/internal/widget/LockPatternUtils;)V
 
     .restart local v1       #unlockView:Landroid/view/View;
     goto :goto_0
@@ -5721,6 +5724,87 @@
     return-void
 .end method
 
+.method protected showTimeoutDialog()V
+    .locals 7
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/16 v2, 0x1e
+
+    .local v2, timeoutInSeconds:I
+    const v1, 0x1040316
+
+    .local v1, messageId:I
+    invoke-direct {p0}, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->getUnlockMode()Lcom/android/internal/policy/impl/LockPatternKeyguardView$UnlockMode;
+
+    move-result-object v3
+
+    sget-object v4, Lcom/android/internal/policy/impl/LockPatternKeyguardView$UnlockMode;->Password:Lcom/android/internal/policy/impl/LockPatternKeyguardView$UnlockMode;
+
+    if-ne v3, v4, :cond_0
+
+    iget-object v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mLockPatternUtils:Lcom/android/internal/widget/LockPatternUtils;
+
+    invoke-virtual {v3}, Lcom/android/internal/widget/LockPatternUtils;->getKeyguardStoredPasswordQuality()I
+
+    move-result v3
+
+    const/high16 v4, 0x2
+
+    if-ne v3, v4, :cond_1
+
+    const v1, 0x1040318
+
+    :cond_0
+    :goto_0
+    iget-object v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mContext:Landroid/content/Context;
+
+    const/4 v4, 0x2
+
+    new-array v4, v4, [Ljava/lang/Object;
+
+    const/4 v5, 0x0
+
+    iget-object v6, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mUpdateMonitor:Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;
+
+    invoke-virtual {v6}, Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;->getFailedAttempts()I
+
+    move-result v6
+
+    invoke-static {v6}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;
+
+    move-result-object v6
+
+    aput-object v6, v4, v5
+
+    const/4 v5, 0x1
+
+    invoke-static {v2}, Ljava/lang/Integer;->valueOf(I)Ljava/lang/Integer;
+
+    move-result-object v6
+
+    aput-object v6, v4, v5
+
+    invoke-virtual {v3, v1, v4}, Landroid/content/Context;->getString(I[Ljava/lang/Object;)Ljava/lang/String;
+
+    move-result-object v0
+
+    .local v0, message:Ljava/lang/String;
+    const/4 v3, 0x0
+
+    invoke-direct {p0, v3, v0}, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->showDialog(Ljava/lang/String;Ljava/lang/String;)V
+
+    return-void
+
+    .end local v0           #message:Ljava/lang/String;
+    :cond_1
+    const v1, 0x1040317
+
+    goto :goto_0
+.end method
+
 .method public verifyUnlock()V
     .locals 4
 
@@ -5880,6 +5964,23 @@
 
     return-object v0
 .end method
+
+.method protected getFaceLockAreaView(Landroid/view/View;)Landroid/view/View;
+    .locals 1
+    .parameter "view"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const v0, 0x10202b2
+
+    invoke-virtual {p1, v0}, Landroid/view/View;->findViewById(I)Landroid/view/View;
+
+    move-result-object v0
+
+    return-object v0
+.end method
 
 .method getLockPatternUtils()Lcom/android/internal/widget/LockPatternUtils;
     .locals 1
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/PasswordUnlockScreen.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/PasswordUnlockScreen.smali
@@ -15,6 +15,7 @@
 
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
+        Lcom/android/internal/policy/impl/PasswordUnlockScreen$MiuiPasswordEntryTextWatcher;,
         Lcom/android/internal/policy/impl/PasswordUnlockScreen$Injector;
     }
 .end annotation
@@ -227,6 +228,14 @@
 
     iget-object v1, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mPasswordEntry:Landroid/widget/EditText;
 
+    new-instance v2, Lcom/android/internal/policy/impl/PasswordUnlockScreen$MiuiPasswordEntryTextWatcher;
+
+    invoke-direct {v2, p0}, Lcom/android/internal/policy/impl/PasswordUnlockScreen$MiuiPasswordEntryTextWatcher;-><init>(Lcom/android/internal/policy/impl/PasswordUnlockScreen;)V
+
+    invoke-virtual {v1, v2}, Landroid/widget/EditText;->addTextChangedListener(Landroid/text/TextWatcher;)V
+
+    iget-object v1, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mPasswordEntry:Landroid/widget/EditText;
+
     invoke-virtual {v1, p0}, Landroid/widget/EditText;->setOnKeyListener(Landroid/view/View$OnKeyListener;)V
 
     invoke-static {}, Lcom/android/internal/policy/impl/sec/SamsungLockScreenProperties;->isVZWDevice()Z
@@ -1653,6 +1662,8 @@
 
     invoke-virtual {v3}, Landroid/widget/EditText;->requestFocus()Z
 
+    invoke-direct {p0}, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->showImmOnResume()V
+
     invoke-direct {p0}, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->isDeviceDisabledForMaxFailedAttempt()Z
 
     move-result v2
@@ -1697,3 +1708,95 @@
 
     goto :goto_0
 .end method
+
+
+.method verifyPassword(Ljava/lang/String;)V
+    .locals 2
+    .parameter "password"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mLockPatternUtils:Lcom/android/internal/widget/LockPatternUtils;
+
+    invoke-virtual {v0, p1}, Lcom/android/internal/widget/LockPatternUtils;->checkPassword(Ljava/lang/String;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mCallback:Lcom/android/internal/policy/impl/KeyguardScreenCallback;
+
+    const/4 v1, 0x1
+
+    invoke-interface {v0, v1}, Lcom/android/internal/policy/impl/KeyguardScreenCallback;->keyguardDone(Z)V
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mCallback:Lcom/android/internal/policy/impl/KeyguardScreenCallback;
+
+    invoke-interface {v0}, Lcom/android/internal/policy/impl/KeyguardScreenCallback;->reportSuccessfulUnlockAttempt()V
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mStatusViewManager:Lcom/android/internal/policy/impl/KeyguardStatusViewManager;
+
+    const/4 v1, 0x0
+
+    invoke-virtual {v0, v1}, Lcom/android/internal/policy/impl/KeyguardStatusViewManager;->setInstructionText(Ljava/lang/String;)V
+
+    invoke-static {p0, p1}, Lcom/android/internal/policy/impl/PasswordUnlockScreen$Injector;->clearPinLockForFindDevice(Lcom/android/internal/policy/impl/PasswordUnlockScreen;Ljava/lang/String;)V
+
+    :cond_0
+    return-void
+.end method
+
+.method private showImmOnResume()V
+    .locals 4
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-boolean v1, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mIsAlpha:Z
+
+    if-eqz v1, :cond_0
+
+    invoke-virtual {p0}, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->getContext()Landroid/content/Context;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Landroid/content/Context;->getContentResolver()Landroid/content/ContentResolver;
+
+    move-result-object v1
+
+    const-string v2, "torch_state"
+
+    const/4 v3, 0x0
+
+    invoke-static {v1, v2, v3}, Landroid/provider/Settings$System;->getInt(Landroid/content/ContentResolver;Ljava/lang/String;I)I
+
+    move-result v1
+
+    if-nez v1, :cond_0
+
+    invoke-virtual {p0}, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->getContext()Landroid/content/Context;
+
+    move-result-object v1
+
+    const-string v2, "input_method"
+
+    invoke-virtual {v1, v2}, Landroid/content/Context;->getSystemService(Ljava/lang/String;)Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, Landroid/view/inputmethod/InputMethodManager;
+
+    .local v0, imm:Landroid/view/inputmethod/InputMethodManager;
+    iget-object v1, p0, Lcom/android/internal/policy/impl/PasswordUnlockScreen;->mPasswordEntry:Landroid/widget/EditText;
+
+    const/4 v2, 0x1
+
+    invoke-virtual {v0, v1, v2}, Landroid/view/inputmethod/InputMethodManager;->showSoftInput(Landroid/view/View;I)Z
+
+    .end local v0           #imm:Landroid/view/inputmethod/InputMethodManager;
+    :cond_0
+    return-void
+.end method
\ No newline at end of file
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/PhoneWindow$DecorView.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/PhoneWindow$DecorView.smali
@@ -4,6 +4,7 @@
 
 # interfaces
 .implements Lcom/android/internal/view/RootViewSurfaceTaker;
+.implements Lcom/miui/internal/v5/widget/ActionBarView$ActionBarViewHolder;
 
 
 # annotations
@@ -22,6 +23,7 @@
 
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
+        Lcom/android/internal/policy/impl/PhoneWindow$DecorView$SearchActionModeCallbackWrapper;,
         Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;
     }
 .end annotation
@@ -939,6 +941,79 @@
     return v0
 .end method
 
+.method public getActionBarView()Lcom/miui/internal/v5/widget/ActionBarView;
+    .locals 2
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v1, p0, Lcom/android/internal/policy/impl/PhoneWindow$DecorView;->this$0:Lcom/android/internal/policy/impl/PhoneWindow;
+
+    invoke-virtual {v1}, Lcom/android/internal/policy/impl/PhoneWindow;->getActionBarView()Lcom/android/internal/widget/ActionBarView;
+
+    move-result-object v0
+
+    .local v0, abv:Lcom/android/internal/widget/ActionBarView;
+    instance-of v1, v0, Lcom/miui/internal/v5/widget/ActionBarView;
+
+    if-eqz v1, :cond_0
+
+    check-cast v0, Lcom/miui/internal/v5/widget/ActionBarView;
+
+    .end local v0           #abv:Lcom/android/internal/widget/ActionBarView;
+    :goto_0
+    return-object v0
+
+    .restart local v0       #abv:Lcom/android/internal/widget/ActionBarView;
+    :cond_0
+    const/4 v0, 0x0
+
+    goto :goto_0
+.end method
+
+.method miuiCreateActionModeCallbackWrapper(Landroid/view/ActionMode$Callback;)Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;
+    .locals 1
+    .parameter "callback"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/policy/impl/PhoneWindow$DecorView;->mContext:Landroid/content/Context;
+
+    invoke-static {v0}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_1
+
+    instance-of v0, p1, Lmiui/v5/view/SearchActionMode$Callback;
+
+    if-eqz v0, :cond_0
+
+    new-instance v0, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$SearchActionModeCallbackWrapper;
+
+    invoke-direct {v0, p0, p1}, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$SearchActionModeCallbackWrapper;-><init>(Lcom/android/internal/policy/impl/PhoneWindow$DecorView;Landroid/view/ActionMode$Callback;)V
+
+    :goto_0
+    return-object v0
+
+    :cond_0
+    new-instance v0, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;
+
+    invoke-direct {v0, p0, p1}, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;-><init>(Lcom/android/internal/policy/impl/PhoneWindow$DecorView;Landroid/view/ActionMode$Callback;)V
+
+    goto :goto_0
+
+    :cond_1
+    new-instance v0, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;
+
+    invoke-direct {v0, p0, p1}, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;-><init>(Lcom/android/internal/policy/impl/PhoneWindow$DecorView;Landroid/view/ActionMode$Callback;)V
+
+    goto :goto_0
+.end method
+
 .method protected onAttachedToWindow()V
     .locals 3
 
@@ -2248,6 +2323,9 @@
 .method public startActionMode(Landroid/view/ActionMode$Callback;)Landroid/view/ActionMode;
     .locals 11
     .parameter "callback"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v10, 0x0
@@ -2265,9 +2343,9 @@
     invoke-virtual {v5}, Landroid/view/ActionMode;->finish()V
 
     :cond_0
-    new-instance v4, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;
+    invoke-virtual {p0, p1}, Lcom/android/internal/policy/impl/PhoneWindow$DecorView;->miuiCreateActionModeCallbackWrapper(Landroid/view/ActionMode$Callback;)Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;
 
-    invoke-direct {v4, p0, p1}, Lcom/android/internal/policy/impl/PhoneWindow$DecorView$ActionModeCallbackWrapper;-><init>(Lcom/android/internal/policy/impl/PhoneWindow$DecorView;Landroid/view/ActionMode$Callback;)V
+    move-result-object v4
 
     .local v4, wrappedCallback:Landroid/view/ActionMode$Callback;
     const/4 v2, 0x0
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/PhoneWindow.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/PhoneWindow.smali
@@ -1313,6 +1313,11 @@
     invoke-virtual {v8}, Lcom/android/internal/widget/ActionBarView;->initIndeterminateProgress()V
 
     :cond_9
+
+    iget-object v8, p0, Lcom/android/internal/policy/impl/PhoneWindow;->mActionBar:Lcom/android/internal/widget/ActionBarView;
+
+    invoke-static {p0, v8}, Lcom/android/internal/policy/impl/PhoneWindow$Injector;->handleStartingWindow(Lcom/android/internal/policy/impl/PhoneWindow;Lcom/android/internal/widget/ActionBarView;)V
+
     const/4 v4, 0x0
 
     .local v4, splitActionBar:Z
@@ -1908,7 +1913,7 @@
 
     iget-boolean v4, v0, Lcom/android/internal/policy/impl/PhoneWindow$PanelFeatureState;->isCompact:Z
 
-    if-eqz v4, :cond_f
+    if-eqz v4, :cond_11
 
     invoke-direct/range {p0 .. p0}, Lcom/android/internal/policy/impl/PhoneWindow;->getOptionsPanelGravity()I
 
@@ -1933,7 +1938,7 @@
 
     move-object/from16 v1, v17
 
-    invoke-static {v0, v1, v2}, Lcom/android/internal/policy/impl/PhoneWindow$Injector;->handleIcsAppLayoutParams(Lcom/android/internal/policy/impl/PhoneWindow;Landroid/view/WindowManager;Landroid/view/WindowManager$LayoutParams;)V
+    invoke-static {v0, v1, v2}, Lcom/android/internal/policy/impl/PhoneWindow$Injector;->handleAppLayoutParams(Lcom/android/internal/policy/impl/PhoneWindow;Landroid/view/WindowManager;Landroid/view/WindowManager$LayoutParams;)V
 
     move-object/from16 v0, p1
 
@@ -1998,7 +2003,7 @@
 
     iget-object v4, v0, Lcom/android/internal/policy/impl/PhoneWindow$PanelFeatureState;->createdPanelView:Landroid/view/View;
 
-    if-eqz v4, :cond_a
+    if-eqz v4, :cond_f
 
     move-object/from16 v0, p1
 
@@ -2021,10 +2026,38 @@
 
     goto/16 :goto_5
 
-    .local v2, lp:Landroid/view/WindowManager$LayoutParams;
+    .end local v2           #lp:Landroid/view/ViewGroup$LayoutParams;
     :cond_f
     move-object/from16 v0, p1
 
+    iget-object v4, v0, Lcom/android/internal/policy/impl/PhoneWindow$PanelFeatureState;->decorView:Lcom/android/internal/policy/impl/PhoneWindow$DecorView;
+
+    invoke-virtual {v4}, Lcom/android/internal/policy/impl/PhoneWindow$DecorView;->getLayoutParams()Landroid/view/ViewGroup$LayoutParams;
+
+    move-result-object v2
+
+    .restart local v2       #lp:Landroid/view/ViewGroup$LayoutParams;
+    if-eqz v2, :cond_10
+
+    iget v3, v2, Landroid/view/ViewGroup$LayoutParams;->width:I
+
+    :cond_10
+    move-object/from16 v0, p1
+
+    iget-object v4, v0, Lcom/android/internal/policy/impl/PhoneWindow$PanelFeatureState;->decorView:Lcom/android/internal/policy/impl/PhoneWindow$DecorView;
+
+    invoke-virtual {v4}, Lcom/android/internal/policy/impl/PhoneWindow$DecorView;->getChildCount()I
+
+    move-result v4
+
+    if-nez v4, :cond_a
+
+    goto/16 :goto_0
+
+    .local v2, lp:Landroid/view/WindowManager$LayoutParams;
+    :cond_11
+    move-object/from16 v0, p1
+
     iget v4, v0, Lcom/android/internal/policy/impl/PhoneWindow$PanelFeatureState;->gravity:I
 
     iput v4, v2, Landroid/view/WindowManager$LayoutParams;->gravity:I
@@ -3199,7 +3232,13 @@
 
     if-eqz v19, :cond_19
 
-    const/16 v19, -0x2
+    invoke-virtual/range {p0 .. p0}, Lcom/android/internal/policy/impl/PhoneWindow;->getContext()Landroid/content/Context;
+
+    move-result-object v19
+
+    invoke-static/range {v19 .. v19}, Lcom/android/internal/policy/impl/PhoneWindow$Injector;->getFloatingWindowWidth(Landroid/content/Context;)I
+
+    move-result v19
 
     const/16 v20, -0x2
 
@@ -4325,14 +4364,26 @@
 
     if-eqz v19, :cond_26
 
-    const v10, 0x10900d0
+    invoke-virtual/range {p0 .. p0}, Lcom/android/internal/policy/impl/PhoneWindow;->getContext()Landroid/content/Context;
+
+    move-result-object v19
+
+    invoke-static/range {v19 .. v19}, Lcom/android/internal/policy/impl/PhoneWindow$Injector;->getActionBarOverlayResourceId(Landroid/content/Context;)I
+
+    move-result v10
 
     .restart local v10       #layoutResource:I
     goto/16 :goto_8
 
     .end local v10           #layoutResource:I
     :cond_26
-    const v10, 0x10900cf
+    invoke-virtual/range {p0 .. p0}, Lcom/android/internal/policy/impl/PhoneWindow;->getContext()Landroid/content/Context;
+
+    move-result-object v19
+
+    invoke-static/range {v19 .. v19}, Lcom/android/internal/policy/impl/PhoneWindow$Injector;->getActionBarResourceId(Landroid/content/Context;)I
+
+    move-result v10
 
     .restart local v10       #layoutResource:I
     goto/16 :goto_8
@@ -4546,6 +4597,18 @@
     return-object v4
 .end method
 
+.method getActionBarView()Lcom/android/internal/widget/ActionBarView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/policy/impl/PhoneWindow;->mActionBar:Lcom/android/internal/widget/ActionBarView;
+
+    return-object v0
+.end method
+
 .method getAudioManager()Landroid/media/AudioManager;
     .locals 2
 
--- a/customize_framework.sh
+++ b/customize_framework.sh
@@ -18,9 +18,9 @@
 
     # move some smali to create a separate $SEP_FRAME.jar
     # including: smali/miui smali/android/widget
-	mkdir -p "$BUILD_OUT/$SEP_FRAME/smali"
-    rm -rf $BUILD_OUT/$SEP_FRAME/smali/miui
-	mv "$BUILD_OUT/framework/smali/miui" "$BUILD_OUT/$SEP_FRAME/smali"
+	#mkdir -p "$BUILD_OUT/$SEP_FRAME/smali"
+    #rm -rf $BUILD_OUT/$SEP_FRAME/smali/miui
+	#mv "$BUILD_OUT/framework/smali/miui" "$BUILD_OUT/$SEP_FRAME/smali"
 fi
 
 if [ $2 = "$BUILD_OUT/framework2" ]
@@ -32,5 +32,5 @@
             rm -rf "$file"
     done
 
-	mv "$BUILD_OUT/$SEP_FRAME/smali/miui/"  "$BUILD_OUT/framework2/smali/miui"
+	#mv "$BUILD_OUT/$SEP_FRAME/smali/miui/"  "$BUILD_OUT/framework2/smali/miui"
 fi
--- a/framework.jar.out/smali/android/app/Activity.smali
+++ b/framework.jar.out/smali/android/app/Activity.smali
@@ -326,6 +326,9 @@
 
 .method private initActionBar()V
     .locals 3
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     invoke-virtual {p0}, Landroid/app/Activity;->getWindow()Landroid/view/Window;
@@ -358,9 +361,9 @@
     return-void
 
     :cond_1
-    new-instance v1, Lcom/android/internal/app/ActionBarImpl;
+    invoke-static {p0}, Landroid/app/Activity$Injector;->generateActionBar(Landroid/app/Activity;)Lcom/android/internal/app/ActionBarImpl;
 
-    invoke-direct {v1, p0}, Lcom/android/internal/app/ActionBarImpl;-><init>(Landroid/app/Activity;)V
+    move-result-object v1
 
     iput-object v1, p0, Landroid/app/Activity;->mActionBar:Lcom/android/internal/app/ActionBarImpl;
 
@@ -2385,6 +2388,35 @@
     goto :goto_0
 .end method
 
+.method public getMiuiActionBar()Lmiui/v5/app/MiuiActionBar;
+    .locals 2
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-virtual {p0}, Landroid/app/Activity;->getActionBar()Landroid/app/ActionBar;
+
+    move-result-object v0
+
+    .local v0, bar:Landroid/app/ActionBar;
+    instance-of v1, v0, Lmiui/v5/app/MiuiActionBar;
+
+    if-eqz v1, :cond_0
+
+    check-cast v0, Lmiui/v5/app/MiuiActionBar;
+
+    .end local v0           #bar:Landroid/app/ActionBar;
+    :goto_0
+    return-object v0
+
+    .restart local v0       #bar:Landroid/app/ActionBar;
+    :cond_0
+    const/4 v0, 0x0
+
+    goto :goto_0
+.end method
+
 .method public final getParent()Landroid/app/Activity;
     .locals 1
 
@@ -3502,6 +3534,8 @@
 
     iput-boolean v4, p0, Landroid/app/Activity;->mCalled:Z
 
+    invoke-static {p0}, Landroid/app/Activity$Injector;->setActivityGravity(Landroid/app/Activity;)V
+
     return-void
 
     :cond_4
@@ -4813,6 +4847,9 @@
 .method public onOptionsItemSelected(Landroid/view/MenuItem;)Z
     .locals 1
     .parameter "item"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v0, p0, Landroid/app/Activity;->mParent:Landroid/app/Activity;
@@ -4829,7 +4866,9 @@
     return v0
 
     :cond_0
-    const/4 v0, 0x0
+    invoke-static {p0, p1}, Landroid/app/Activity$Injector;->onOptionsItemSelected(Landroid/app/Activity;Landroid/view/MenuItem;)Z
+
+    move-result v0
 
     goto :goto_0
 .end method
@@ -4899,8 +4938,13 @@
 
 .method protected onPause()V
     .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
+    invoke-static {p0}, Landroid/app/Activity$Injector;->onWindowHide(Landroid/app/Activity;)V
+
     invoke-virtual {p0}, Landroid/app/Activity;->getApplication()Landroid/app/Application;
 
     move-result-object v0
@@ -5125,6 +5169,8 @@
 
     invoke-static {p0}, Landroid/app/Activity$Injector;->checkAccessControl(Landroid/app/Activity;)V
 
+    invoke-static {p0}, Landroid/app/Activity$Injector;->onWindowShow(Landroid/app/Activity;)V
+
     return-void
 .end method
 
--- a/framework.jar.out/smali/android/app/ApplicationPackageManager.smali
+++ b/framework.jar.out/smali/android/app/ApplicationPackageManager.smali
@@ -135,74 +135,6 @@
     throw v0
 .end method
 
-.method static getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
-    .locals 4
-    .parameter "name"
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    sget-object v3, Landroid/app/ApplicationPackageManager;->sSync:Ljava/lang/Object;
-
-    monitor-enter v3
-
-    :try_start_0
-    sget-object v2, Landroid/app/ApplicationPackageManager;->sIconCache:Ljava/util/HashMap;
-
-    invoke-virtual {v2, p0}, Ljava/util/HashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;
-
-    move-result-object v1
-
-    check-cast v1, Ljava/lang/ref/WeakReference;
-
-    .local v1, wr:Ljava/lang/ref/WeakReference;,"Ljava/lang/ref/WeakReference<Landroid/graphics/drawable/Drawable$ConstantState;>;"
-    if-eqz v1, :cond_1
-
-    invoke-virtual {v1}, Ljava/lang/ref/WeakReference;->get()Ljava/lang/Object;
-
-    move-result-object v0
-
-    check-cast v0, Landroid/graphics/drawable/Drawable$ConstantState;
-
-    .local v0, state:Landroid/graphics/drawable/Drawable$ConstantState;
-    if-eqz v0, :cond_0
-
-    invoke-virtual {v0}, Landroid/graphics/drawable/Drawable$ConstantState;->newDrawable()Landroid/graphics/drawable/Drawable;
-
-    move-result-object v2
-
-    monitor-exit v3
-
-    .end local v0           #state:Landroid/graphics/drawable/Drawable$ConstantState;
-    :goto_0
-    return-object v2
-
-    .restart local v0       #state:Landroid/graphics/drawable/Drawable$ConstantState;
-    :cond_0
-    sget-object v2, Landroid/app/ApplicationPackageManager;->sIconCache:Ljava/util/HashMap;
-
-    invoke-virtual {v2, p0}, Ljava/util/HashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;
-
-    .end local v0           #state:Landroid/graphics/drawable/Drawable$ConstantState;
-    :cond_1
-    monitor-exit v3
-
-    const/4 v2, 0x0
-
-    goto :goto_0
-
-    .end local v1           #wr:Ljava/lang/ref/WeakReference;,"Ljava/lang/ref/WeakReference<Landroid/graphics/drawable/Drawable$ConstantState;>;"
-    :catchall_0
-    move-exception v2
-
-    monitor-exit v3
-    :try_end_0
-    .catchall {:try_start_0 .. :try_end_0} :catchall_0
-
-    throw v2
-.end method
-
 .method private getCachedString(Landroid/app/ApplicationPackageManager$ResourceName;)Ljava/lang/CharSequence;
     .locals 4
     .parameter "name"
@@ -464,46 +396,6 @@
     goto :goto_3
 .end method
 
-.method static putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
-    .locals 4
-    .parameter "name"
-    .parameter "dr"
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    sget-object v1, Landroid/app/ApplicationPackageManager;->sSync:Ljava/lang/Object;
-
-    monitor-enter v1
-
-    :try_start_0
-    sget-object v0, Landroid/app/ApplicationPackageManager;->sIconCache:Ljava/util/HashMap;
-
-    new-instance v2, Ljava/lang/ref/WeakReference;
-
-    invoke-virtual {p1}, Landroid/graphics/drawable/Drawable;->getConstantState()Landroid/graphics/drawable/Drawable$ConstantState;
-
-    move-result-object v3
-
-    invoke-direct {v2, v3}, Ljava/lang/ref/WeakReference;-><init>(Ljava/lang/Object;)V
-
-    invoke-virtual {v0, p0, v2}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
-
-    monitor-exit v1
-
-    return-void
-
-    :catchall_0
-    move-exception v0
-
-    monitor-exit v1
-    :try_end_0
-    .catchall {:try_start_0 .. :try_end_0} :catchall_0
-
-    throw v0
-.end method
-
 .method private putCachedString(Landroid/app/ApplicationPackageManager$ResourceName;Ljava/lang/CharSequence;)V
     .locals 3
     .parameter "name"
@@ -1447,7 +1339,8 @@
     invoke-direct {v3, p1, v5}, Landroid/app/ApplicationPackageManager$ResourceName;-><init>(Ljava/lang/String;I)V
 
     .local v3, name:Landroid/app/ApplicationPackageManager$ResourceName;
-    invoke-static {v3}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
+
+    invoke-virtual {p0, v3}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
 
     move-result-object v1
 
@@ -1491,7 +1384,8 @@
 
     move-result-object v1
 
-    invoke-static {v3, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+    #invoke-static {v3, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+    invoke-virtual {p0, v3, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
     :try_end_0
     .catch Ljava/lang/RuntimeException; {:try_start_0 .. :try_end_0} :catch_0
 
@@ -1787,6 +1681,18 @@
     goto :goto_0
 .end method
 
+.method getContext()Landroid/app/ContextImpl;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/app/ApplicationPackageManager;->mContext:Landroid/app/ContextImpl;
+
+    return-object v0
+.end method
+
 .method public getDefaultActivityIcon()Landroid/graphics/drawable/Drawable;
     .locals 2
 
@@ -1901,7 +1807,8 @@
     invoke-direct {v6, p1, p2}, Landroid/app/ApplicationPackageManager$ResourceName;-><init>(Ljava/lang/String;I)V
 
     .local v6, name:Landroid/app/ApplicationPackageManager$ResourceName;
-    invoke-static {v6}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
+    #invoke-static {v6}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
+    invoke-virtual {p0, v6}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
 
     move-result-object v1
 
@@ -1938,7 +1845,8 @@
 
     move-result-object v1
 
-    invoke-static {v6, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+    #invoke-static {v6, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+    invoke-virtual {p0, v6, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
     :try_end_2
     .catch Landroid/content/pm/PackageManager$NameNotFoundException; {:try_start_2 .. :try_end_2} :catch_1
     .catch Landroid/content/res/Resources$NotFoundException; {:try_start_2 .. :try_end_2} :catch_3
@@ -3825,6 +3733,46 @@
     goto :goto_0
 .end method
 
+.method putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+    .locals 4
+    .parameter "name"
+    .parameter "dr"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    sget-object v1, Landroid/app/ApplicationPackageManager;->sSync:Ljava/lang/Object;
+
+    monitor-enter v1
+
+    :try_start_0
+    sget-object v0, Landroid/app/ApplicationPackageManager;->sIconCache:Ljava/util/HashMap;
+
+    new-instance v2, Ljava/lang/ref/WeakReference;
+
+    invoke-virtual {p2}, Landroid/graphics/drawable/Drawable;->getConstantState()Landroid/graphics/drawable/Drawable$ConstantState;
+
+    move-result-object v3
+
+    invoke-direct {v2, v3}, Ljava/lang/ref/WeakReference;-><init>(Ljava/lang/Object;)V
+
+    invoke-virtual {v0, p1, v2}, Ljava/util/HashMap;->put(Ljava/lang/Object;Ljava/lang/Object;)Ljava/lang/Object;
+
+    monitor-exit v1
+
+    return-void
+
+    :catchall_0
+    move-exception v0
+
+    monitor-exit v1
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    throw v0
+.end method
+
 .method public queryBroadcastReceivers(Landroid/content/Intent;I)Ljava/util/List;
     .locals 4
     .parameter "intent"
@@ -4725,3 +4673,71 @@
 
     goto :goto_0
 .end method
+
+.method getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
+    .locals 4
+    .parameter "name"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    sget-object v3, Landroid/app/ApplicationPackageManager;->sSync:Ljava/lang/Object;
+
+    monitor-enter v3
+
+    :try_start_0
+    sget-object v2, Landroid/app/ApplicationPackageManager;->sIconCache:Ljava/util/HashMap;
+
+    invoke-virtual {v2, p1}, Ljava/util/HashMap;->get(Ljava/lang/Object;)Ljava/lang/Object;
+
+    move-result-object v1
+
+    check-cast v1, Ljava/lang/ref/WeakReference;
+
+    .local v1, wr:Ljava/lang/ref/WeakReference;,"Ljava/lang/ref/WeakReference<Landroid/graphics/drawable/Drawable$ConstantState;>;"
+    if-eqz v1, :cond_1
+
+    invoke-virtual {v1}, Ljava/lang/ref/WeakReference;->get()Ljava/lang/Object;
+
+    move-result-object v0
+
+    check-cast v0, Landroid/graphics/drawable/Drawable$ConstantState;
+
+    .local v0, state:Landroid/graphics/drawable/Drawable$ConstantState;
+    if-eqz v0, :cond_0
+
+    invoke-virtual {v0}, Landroid/graphics/drawable/Drawable$ConstantState;->newDrawable()Landroid/graphics/drawable/Drawable;
+
+    move-result-object v2
+
+    monitor-exit v3
+
+    .end local v0           #state:Landroid/graphics/drawable/Drawable$ConstantState;
+    :goto_0
+    return-object v2
+
+    .restart local v0       #state:Landroid/graphics/drawable/Drawable$ConstantState;
+    :cond_0
+    sget-object v2, Landroid/app/ApplicationPackageManager;->sIconCache:Ljava/util/HashMap;
+
+    invoke-virtual {v2, p1}, Ljava/util/HashMap;->remove(Ljava/lang/Object;)Ljava/lang/Object;
+
+    .end local v0           #state:Landroid/graphics/drawable/Drawable$ConstantState;
+    :cond_1
+    monitor-exit v3
+
+    const/4 v2, 0x0
+
+    goto :goto_0
+
+    .end local v1           #wr:Ljava/lang/ref/WeakReference;,"Ljava/lang/ref/WeakReference<Landroid/graphics/drawable/Drawable$ConstantState;>;"
+    :catchall_0
+    move-exception v2
+
+    monitor-exit v3
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    throw v2
+.end method
--- a/framework.jar.out/smali/android/app/Dialog.smali
+++ b/framework.jar.out/smali/android/app/Dialog.smali
@@ -12,7 +12,8 @@
 # annotations
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
-        Landroid/app/Dialog$ListenersHandler;
+        Landroid/app/Dialog$ListenersHandler;,
+        Landroid/app/Dialog$Injector;
     }
 .end annotation
 
@@ -106,6 +107,9 @@
     .parameter "context"
     .parameter "theme"
     .parameter "createContextWrapper"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v5, 0x0
@@ -201,6 +205,8 @@
 
     iput-object v2, p0, Landroid/app/Dialog;->mListenersHandler:Landroid/os/Handler;
 
+    invoke-static {p0, p2}, Landroid/app/Dialog$Injector;->setDialogGravity(Landroid/app/Dialog;I)V
+
     return-void
 
     .end local v1           #w:Landroid/view/Window;
@@ -439,6 +445,9 @@
 
 .method dismissDialog()V
     .locals 4
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v3, 0x0
@@ -481,6 +490,8 @@
     iget-object v1, p0, Landroid/app/Dialog;->mDecor:Landroid/view/View;
 
     invoke-interface {v0, v1}, Landroid/view/WindowManager;->removeView(Landroid/view/View;)V
+
+    invoke-static {p0}, Landroid/app/Dialog$Injector;->onWindowHide(Landroid/app/Dialog;)V
     :try_end_0
     .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
@@ -858,6 +869,35 @@
     return-object v0
 .end method
 
+.method public getMiuiActionBar()Lmiui/v5/app/MiuiActionBar;
+    .locals 2
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-virtual {p0}, Landroid/app/Dialog;->getActionBar()Landroid/app/ActionBar;
+
+    move-result-object v0
+
+    .local v0, bar:Landroid/app/ActionBar;
+    instance-of v1, v0, Lmiui/v5/app/MiuiActionBar;
+
+    if-eqz v1, :cond_0
+
+    check-cast v0, Lmiui/v5/app/MiuiActionBar;
+
+    .end local v0           #bar:Landroid/app/ActionBar;
+    :goto_0
+    return-object v0
+
+    .restart local v0       #bar:Landroid/app/ActionBar;
+    :cond_0
+    const/4 v0, 0x0
+
+    goto :goto_0
+.end method
+
 .method public final getOwnerActivity()Landroid/app/Activity;
     .locals 1
 
@@ -1984,6 +2024,9 @@
 
 .method public show()V
     .locals 5
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v4, 0x0
@@ -2053,9 +2096,9 @@
 
     if-eqz v2, :cond_4
 
-    new-instance v2, Lcom/android/internal/app/ActionBarImpl;
+    invoke-static {p0}, Landroid/app/Dialog$Injector;->generateActionBar(Landroid/app/Dialog;)Lcom/android/internal/app/ActionBarImpl;
 
-    invoke-direct {v2, p0}, Lcom/android/internal/app/ActionBarImpl;-><init>(Landroid/app/Dialog;)V
+    move-result-object v2
 
     iput-object v2, p0, Landroid/app/Dialog;->mActionBar:Lcom/android/internal/app/ActionBarImpl;
 
@@ -2102,6 +2145,8 @@
     iput-boolean v2, p0, Landroid/app/Dialog;->mShowing:Z
 
     invoke-direct {p0}, Landroid/app/Dialog;->sendShowMessage()V
+
+    invoke-static {p0}, Landroid/app/Dialog$Injector;->onWindowShow(Landroid/app/Dialog;)V
     :try_end_0
     .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
--- a/framework.jar.out/smali/android/app/ListActivity.smali
+++ b/framework.jar.out/smali/android/app/ListActivity.smali
@@ -266,33 +266,3 @@
 
     return-void
 .end method
-
-.method protected onCreate(Landroid/os/Bundle;)V
-    .locals 2
-    .parameter "savedInstanceState"
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    invoke-virtual {p0}, Landroid/app/ListActivity;->getThemeResId()I
-
-    move-result v0
-
-    const v1, 0x60d0089
-
-    if-ne v0, v1, :cond_0
-
-    invoke-virtual {p0}, Landroid/app/ListActivity;->getActionBar()Landroid/app/ActionBar;
-
-    move-result-object v0
-
-    const/4 v1, 0x0
-
-    invoke-virtual {v0, v1}, Landroid/app/ActionBar;->setHomeViewBackground(I)V
-
-    :cond_0
-    invoke-super {p0, p1}, Landroid/app/Activity;->onCreate(Landroid/os/Bundle;)V
-
-    return-void
-.end method
--- a/framework.jar.out/smali/android/app/ProgressDialog.smali
+++ b/framework.jar.out/smali/android/app/ProgressDialog.smali
@@ -3,6 +3,14 @@
 .source "ProgressDialog.java"
 
 
+# annotations
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Landroid/app/ProgressDialog$Injector;
+    }
+.end annotation
+
+
 # static fields
 .field public static final STYLE_HORIZONTAL:I = 0x1
 
@@ -440,6 +448,9 @@
 .method protected onCreate(Landroid/os/Bundle;)V
     .locals 9
     .parameter "savedInstanceState"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const v8, 0x102000d
@@ -641,7 +652,13 @@
 
     invoke-virtual {p0, v2}, Landroid/app/ProgressDialog;->setView(Landroid/view/View;)V
 
-    goto :goto_0
+    iget-object v3, p0, Landroid/app/ProgressDialog;->mContext:Landroid/content/Context;
+
+    iget-object v4, p0, Landroid/app/ProgressDialog;->mMessageView:Landroid/widget/TextView;
+
+    invoke-static {p0, v3, v4}, Landroid/app/ProgressDialog$Injector;->usingV5Style(Landroid/app/ProgressDialog;Landroid/content/Context;Landroid/widget/TextView;)V
+
+    goto/16 :goto_0
 .end method
 
 .method public onStart()V
--- a/framework.jar.out/smali/android/app/StatusBarManager.smali
+++ b/framework.jar.out/smali/android/app/StatusBarManager.smali
@@ -432,3 +432,42 @@
 
     throw v2
 .end method
+
+.method public setStatus(ILjava/lang/String;Landroid/os/Bundle;)V
+    .locals 3
+    .parameter "what"
+    .parameter "action"
+    .parameter "ext"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    :try_start_0
+    invoke-direct {p0}, Landroid/app/StatusBarManager;->getService()Lcom/android/internal/statusbar/IStatusBarService;
+
+    move-result-object v1
+
+    .local v1, svc:Lcom/android/internal/statusbar/IStatusBarService;
+    if-eqz v1, :cond_0
+
+    iget-object v2, p0, Landroid/app/StatusBarManager;->mToken:Landroid/os/IBinder;
+
+    invoke-interface {v1, p1, v2, p2, p3}, Lcom/android/internal/statusbar/IStatusBarService;->setStatus(ILandroid/os/IBinder;Ljava/lang/String;Landroid/os/Bundle;)V
+    :try_end_0
+    .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
+
+    :cond_0
+    return-void
+
+    .end local v1           #svc:Lcom/android/internal/statusbar/IStatusBarService;
+    :catch_0
+    move-exception v0
+
+    .local v0, ex:Landroid/os/RemoteException;
+    new-instance v2, Ljava/lang/RuntimeException;
+
+    invoke-direct {v2, v0}, Ljava/lang/RuntimeException;-><init>(Ljava/lang/Throwable;)V
+
+    throw v2
+.end method
--- a/framework.jar.out/smali/android/content/ClipboardManager.smali
+++ b/framework.jar.out/smali/android/content/ClipboardManager.smali
@@ -95,6 +95,44 @@
     return-object v0
 .end method
 
+.method private addClipDataExtra(Landroid/content/ClipData;)V
+    .locals 3
+    .parameter "clip"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    if-eqz p1, :cond_0
+
+    invoke-virtual {p1}, Landroid/content/ClipData;->getItemCount()I
+
+    move-result v0
+
+    if-lez v0, :cond_0
+
+    invoke-static {}, Lmiui/content/ClipServiceManagerExtra;->getInstance()Lmiui/content/ClipServiceManagerExtra;
+
+    move-result-object v0
+
+    const/4 v1, 0x0
+
+    invoke-virtual {p1, v1}, Landroid/content/ClipData;->getItemAt(I)Landroid/content/ClipData$Item;
+
+    move-result-object v1
+
+    iget-object v2, p0, Landroid/content/ClipboardManager;->mContext:Landroid/content/Context;
+
+    invoke-virtual {v1, v2}, Landroid/content/ClipData$Item;->coerceToText(Landroid/content/Context;)Ljava/lang/CharSequence;
+
+    move-result-object v1
+
+    invoke-virtual {v0, v1}, Lmiui/content/ClipServiceManagerExtra;->addData(Ljava/lang/CharSequence;)V
+
+    :cond_0
+    return-void
+.end method
+
 .method private static getService()Landroid/content/IClipboard;
     .locals 3
 
--- a/framework.jar.out/smali/android/content/res/Resources.smali
+++ b/framework.jar.out/smali/android/content/res/Resources.smali
@@ -2847,6 +2847,20 @@
     throw v1
 .end method
 
+.method getTheme()Landroid/content/res/Resources$Theme;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    new-instance v0, Landroid/content/res/Resources$Theme;
+
+    invoke-direct {v0, p0}, Landroid/content/res/Resources$Theme;-><init>(Landroid/content/res/Resources;)V
+
+    return-object v0
+.end method
+
 .method public getValue(ILandroid/util/TypedValue;Z)V
     .locals 4
     .parameter "id"
@@ -4340,16 +4354,16 @@
     throw v7
 .end method
 
-.method public newTheme()Landroid/content/res/Resources$Theme;
+.method public final newTheme()Landroid/content/res/Resources$Theme;
     .locals 1
     .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
     .end annotation
 
     .prologue
-    new-instance v0, Landroid/content/res/Resources$Theme;
+    invoke-virtual {p0}, Landroid/content/res/Resources;->getTheme()Landroid/content/res/Resources$Theme;
 
-    invoke-direct {v0, p0}, Landroid/content/res/Resources$Theme;-><init>(Landroid/content/res/Resources;)V
+    move-result-object v0
 
     return-object v0
 .end method
--- a/framework.jar.out/smali/android/graphics/drawable/AnimatedRotateDrawable.smali
+++ b/framework.jar.out/smali/android/graphics/drawable/AnimatedRotateDrawable.smali
@@ -12,7 +12,8 @@
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
         Landroid/graphics/drawable/AnimatedRotateDrawable$1;,
-        Landroid/graphics/drawable/AnimatedRotateDrawable$AnimatedRotateState;
+        Landroid/graphics/drawable/AnimatedRotateDrawable$AnimatedRotateState;,
+        Landroid/graphics/drawable/AnimatedRotateDrawable$Injector;
     }
 .end annotation
 
@@ -366,6 +367,10 @@
     .parameter "r"
     .parameter "parser"
     .parameter "attrs"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
     .annotation system Ldalvik/annotation/Throws;
         value = {
             Lorg/xmlpull/v1/XmlPullParserException;,
@@ -476,6 +481,14 @@
 
     invoke-virtual {v0, v14}, Landroid/graphics/drawable/AnimatedRotateDrawable;->setFramesDuration(I)V
 
+    move-object/from16 v0, p0
+
+    move-object/from16 v1, p1
+
+    move-object/from16 v2, p3
+
+    invoke-static {v0, v1, v2}, Landroid/graphics/drawable/AnimatedRotateDrawable$Injector;->init(Landroid/graphics/drawable/AnimatedRotateDrawable;Landroid/content/res/Resources;Landroid/util/AttributeSet;)V
+
     const/4 v14, 0x1
 
     const/4 v15, 0x0
@@ -583,13 +596,13 @@
 
     move-result v6
 
-    goto :goto_1
+    goto/16 :goto_1
 
     .restart local v6       #pivotX:F
     :cond_5
     const/4 v9, 0x0
 
-    goto :goto_2
+    goto/16 :goto_2
 
     .restart local v9       #pivotYRel:Z
     :cond_6
--- a/framework.jar.out/smali/android/graphics/drawable/Drawable.smali
+++ b/framework.jar.out/smali/android/graphics/drawable/Drawable.smali
@@ -90,6 +90,10 @@
 
     iput-boolean v0, p0, Landroid/graphics/drawable/Drawable;->mVisible:Z
 
+    const/4 v0, -0x1
+
+    iput v0, p0, Landroid/graphics/drawable/Drawable;->mId:I
+
     return-void
 .end method
 
@@ -871,6 +875,18 @@
     return-object p0
 .end method
 
+.method public getId()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/graphics/drawable/Drawable;->mId:I
+
+    return v0
+.end method
+
 .method public getIntrinsicHeight()I
     .locals 1
 
@@ -1300,6 +1316,19 @@
     return-void
 .end method
 
+.method public setId(I)V
+    .locals 0
+    .parameter "id"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput p1, p0, Landroid/graphics/drawable/Drawable;->mId:I
+
+    return-void
+.end method
+
 .method public final setLevel(I)Z
     .locals 1
     .parameter "level"
@@ -1399,28 +1428,3 @@
     :cond_0
     return-void
 .end method
-
-.method public setId(I)V
-    .locals 0
-    .parameter "id"
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    iput p1, p0, Landroid/graphics/drawable/Drawable;->mId:I
-
-    return-void
-.end method
-
-.method public getId()I
-    .locals 1
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    iget v0, p0, Landroid/graphics/drawable/Drawable;->mId:I
-
-    return v0
-.end method
--- a/framework.jar.out/smali/android/graphics/drawable/DrawableContainer$DrawableContainerState.smali
+++ b/framework.jar.out/smali/android/graphics/drawable/DrawableContainer$DrawableContainerState.smali
@@ -809,6 +809,18 @@
     goto :goto_0
 .end method
 
+.method public final getVariablePadding()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-boolean v0, p0, Landroid/graphics/drawable/DrawableContainer$DrawableContainerState;->mVariablePadding:Z
+
+    return v0
+.end method
+
 .method public growArray(II)V
     .locals 3
     .parameter "oldSize"
--- a/framework.jar.out/smali/android/hardware/SensorManager.smali
+++ b/framework.jar.out/smali/android/hardware/SensorManager.smali
@@ -2411,6 +2411,16 @@
 
 
 # virtual methods
+.method public calibrateSensor(Landroid/hardware/Sensor;)Z
+    .locals 1
+    .parameter "sensor"
+
+    .prologue
+    const/4 v0, 0x0
+
+    return v0
+.end method
+
 .method public getDefaultSensor(I)Landroid/hardware/Sensor;
     .locals 2
     .parameter "type"
--- a/framework.jar.out/smali/android/media/AudioService.smali
+++ b/framework.jar.out/smali/android/media/AudioService.smali
@@ -3521,59 +3521,60 @@
 .end method
 
 .method private dispatchMediaKeyEvent(Landroid/view/KeyEvent;Z)V
-    .locals 12
+    .locals 13
     .parameter "keyEvent"
     .parameter "needWakeLock"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/16 v2, 0x7bc
 
-    const/4 v1, 0x0
+    const/4 v4, 0x0
 
     if-eqz p2, :cond_0
 
-    iget-object v0, p0, Landroid/media/AudioService;->mMediaEventWakeLock:Landroid/os/PowerManager$WakeLock;
+    iget-object v1, p0, Landroid/media/AudioService;->mMediaEventWakeLock:Landroid/os/PowerManager$WakeLock;
 
-    invoke-virtual {v0}, Landroid/os/PowerManager$WakeLock;->acquire()V
+    invoke-virtual {v1}, Landroid/os/PowerManager$WakeLock;->acquire()V
 
     :cond_0
     new-instance v3, Landroid/content/Intent;
 
-    const-string v0, "android.intent.action.MEDIA_BUTTON"
+    const-string v1, "android.intent.action.MEDIA_BUTTON"
 
-    invoke-direct {v3, v0, v1}, Landroid/content/Intent;-><init>(Ljava/lang/String;Landroid/net/Uri;)V
+    invoke-direct {v3, v1, v4}, Landroid/content/Intent;-><init>(Ljava/lang/String;Landroid/net/Uri;)V
 
     .local v3, keyIntent:Landroid/content/Intent;
-    const-string v0, "android.intent.extra.KEY_EVENT"
+    const-string v1, "android.intent.extra.KEY_EVENT"
 
-    invoke-virtual {v3, v0, p1}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
+    invoke-virtual {v3, v1, p1}, Landroid/content/Intent;->putExtra(Ljava/lang/String;Landroid/os/Parcelable;)Landroid/content/Intent;
 
-    iget-object v11, p0, Landroid/media/AudioService;->mRCStack:Ljava/util/Stack;
+    iget-object v12, p0, Landroid/media/AudioService;->mRCStack:Ljava/util/Stack;
 
-    monitor-enter v11
+    monitor-enter v12
 
     :try_start_0
-    iget-object v0, p0, Landroid/media/AudioService;->mRCStack:Ljava/util/Stack;
-
-    invoke-virtual {v0}, Ljava/util/Stack;->empty()Z
-    :try_end_0
-    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+    iget-object v1, p0, Landroid/media/AudioService;->mContext:Landroid/content/Context;
 
-    move-result v0
+    iget-object v4, p0, Landroid/media/AudioService;->mRCStack:Ljava/util/Stack;
 
-    if-nez v0, :cond_2
+    invoke-static {v1, v4, v3}, Landroid/media/AudioService$Injector;->resolveReceiver(Landroid/content/Context;Ljava/util/Stack;Landroid/content/Intent;)Landroid/media/AudioService$Injector$ResolveInfo;
 
-    :try_start_1
-    iget-object v0, p0, Landroid/media/AudioService;->mRCStack:Ljava/util/Stack;
+    move-result-object v11
 
-    invoke-virtual {v0}, Ljava/util/Stack;->peek()Ljava/lang/Object;
+    .local v11, resolveInfo:Landroid/media/AudioService$Injector$ResolveInfo;
+    invoke-static {v11}, Landroid/media/AudioService$Injector;->getPendingIntent(Landroid/media/AudioService$Injector$ResolveInfo;)Landroid/app/PendingIntent;
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
 
     move-result-object v0
 
-    check-cast v0, Landroid/media/AudioService$RemoteControlStackEntry;
-
-    iget-object v0, v0, Landroid/media/AudioService$RemoteControlStackEntry;->mMediaIntent:Landroid/app/PendingIntent;
+    .local v0, pi:Landroid/app/PendingIntent;
+    if-eqz v0, :cond_2
 
+    :try_start_1
     iget-object v1, p0, Landroid/media/AudioService;->mContext:Landroid/content/Context;
 
     if-eqz p2, :cond_1
@@ -3590,7 +3591,7 @@
 
     :goto_1
     :try_start_2
-    monitor-exit v11
+    monitor-exit v12
 
     return-void
 
@@ -3603,59 +3604,65 @@
     move-exception v10
 
     .local v10, e:Landroid/app/PendingIntent$CanceledException;
-    const-string v0, "AudioService"
+    const-string v1, "AudioService"
 
-    new-instance v1, Ljava/lang/StringBuilder;
+    new-instance v2, Ljava/lang/StringBuilder;
 
-    invoke-direct {v1}, Ljava/lang/StringBuilder;-><init>()V
+    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
 
-    const-string v2, "Error sending pending intent "
+    const-string v4, "Error sending pending intent "
 
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
 
-    move-result-object v1
+    move-result-object v2
 
-    iget-object v2, p0, Landroid/media/AudioService;->mRCStack:Ljava/util/Stack;
+    iget-object v4, p0, Landroid/media/AudioService;->mRCStack:Ljava/util/Stack;
 
-    invoke-virtual {v2}, Ljava/util/Stack;->peek()Ljava/lang/Object;
+    invoke-virtual {v4}, Ljava/util/Stack;->peek()Ljava/lang/Object;
 
-    move-result-object v2
+    move-result-object v4
 
-    invoke-virtual {v1, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+    invoke-virtual {v2, v4}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
 
-    move-result-object v1
+    move-result-object v2
 
-    invoke-virtual {v1}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
 
-    move-result-object v1
+    move-result-object v2
 
-    invoke-static {v0, v1}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
 
     invoke-virtual {v10}, Landroid/app/PendingIntent$CanceledException;->printStackTrace()V
 
     goto :goto_1
 
+    .end local v0           #pi:Landroid/app/PendingIntent;
     .end local v10           #e:Landroid/app/PendingIntent$CanceledException;
+    .end local v11           #resolveInfo:Landroid/media/AudioService$Injector$ResolveInfo;
     :catchall_0
-    move-exception v0
+    move-exception v1
 
-    monitor-exit v11
+    monitor-exit v12
     :try_end_2
     .catchall {:try_start_2 .. :try_end_2} :catchall_0
 
-    throw v0
+    throw v1
 
+    .restart local v0       #pi:Landroid/app/PendingIntent;
+    .restart local v11       #resolveInfo:Landroid/media/AudioService$Injector$ResolveInfo;
     :cond_2
     if-eqz p2, :cond_3
 
     :try_start_3
-    const-string v0, "android.media.AudioService.WAKELOCK_ACQUIRED"
+    const-string v1, "android.media.AudioService.WAKELOCK_ACQUIRED"
 
-    const/16 v1, 0x7bc
+    const/16 v2, 0x7bc
 
-    invoke-virtual {v3, v0, v1}, Landroid/content/Intent;->putExtra(Ljava/lang/String;I)Landroid/content/Intent;
+    invoke-virtual {v3, v1, v2}, Landroid/content/Intent;->putExtra(Ljava/lang/String;I)Landroid/content/Intent;
 
     :cond_3
+    invoke-static {v3, v11}, Landroid/media/AudioService$Injector;->setComponentName(Landroid/content/Intent;Landroid/media/AudioService$Injector$ResolveInfo;)V
+
     iget-object v2, p0, Landroid/media/AudioService;->mContext:Landroid/content/Context;
 
     const/4 v4, 0x0
--- a/framework.jar.out/smali/android/media/MediaFile.smali
+++ b/framework.jar.out/smali/android/media/MediaFile.smali
@@ -4,6 +4,10 @@
 
 
 # annotations
+.annotation build Landroid/annotation/MiuiHook;
+    value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+.end annotation
+
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
         Landroid/media/MediaFile$MediaFileType;,
@@ -952,6 +956,8 @@
 
     invoke-static {v0, v1, v2}, Landroid/media/MediaFile;->addFileType(Ljava/lang/String;ILjava/lang/String;)V
 
+    invoke-static {}, Landroid/media/MediaFile$Injector;->addFLV()V
+
     const-string v0, "MPEG"
 
     const/16 v1, 0xc8
--- a/framework.jar.out/smali/android/media/MediaScanner.smali
+++ b/framework.jar.out/smali/android/media/MediaScanner.smali
@@ -6361,7 +6361,7 @@
 .end method
 
 .method public scanMtpFile(Ljava/lang/String;Ljava/lang/String;II)V
-    .locals 20
+    .locals 18
     .parameter "path"
     .parameter "volumeName"
     .parameter "objectHandle"
@@ -6425,72 +6425,7 @@
 
     if-nez v2, :cond_2
 
-    new-instance v18, Landroid/content/ContentValues;
-
-    invoke-direct/range {v18 .. v18}, Landroid/content/ContentValues;-><init>()V
-
-    .local v18, values:Landroid/content/ContentValues;
-    const-string v2, "_size"
-
-    invoke-virtual {v14}, Ljava/io/File;->length()J
-
-    move-result-wide v3
-
-    invoke-static {v3, v4}, Ljava/lang/Long;->valueOf(J)Ljava/lang/Long;
-
-    move-result-object v3
-
-    move-object/from16 v0, v18
-
-    invoke-virtual {v0, v2, v3}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Long;)V
-
-    const-string v2, "date_modified"
-
-    invoke-static {v5, v6}, Ljava/lang/Long;->valueOf(J)Ljava/lang/Long;
-
-    move-result-object v3
-
-    move-object/from16 v0, v18
-
-    invoke-virtual {v0, v2, v3}, Landroid/content/ContentValues;->put(Ljava/lang/String;Ljava/lang/Long;)V
-
-    const/4 v2, 0x1
-
-    :try_start_0
-    new-array v0, v2, [Ljava/lang/String;
-
-    move-object/from16 v19, v0
-
-    const/4 v2, 0x0
-
-    invoke-static/range {p3 .. p3}, Ljava/lang/Integer;->toString(I)Ljava/lang/String;
-
-    move-result-object v3
-
-    aput-object v3, v19, v2
-
-    .local v19, whereArgs:[Ljava/lang/String;
-    move-object/from16 v0, p0
-
-    iget-object v2, v0, Landroid/media/MediaScanner;->mMediaProvider:Landroid/content/IContentProvider;
-
-    invoke-static/range {p2 .. p2}, Landroid/provider/MediaStore$Files;->getMtpObjectsUri(Ljava/lang/String;)Landroid/net/Uri;
-
-    move-result-object v3
-
-    const-string v4, "_id=?"
-
-    move-object/from16 v0, v18
-
-    move-object/from16 v1, v19
-
-    invoke-interface {v2, v3, v0, v4, v1}, Landroid/content/IContentProvider;->update(Landroid/net/Uri;Landroid/content/ContentValues;Ljava/lang/String;[Ljava/lang/String;)I
-    :try_end_0
-    .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
-
     .end local v5           #lastModifiedSeconds:J
-    .end local v18           #values:Landroid/content/ContentValues;
-    .end local v19           #whereArgs:[Ljava/lang/String;
     :cond_0
     :goto_1
     return-void
@@ -6509,21 +6444,6 @@
     .restart local v5       #lastModifiedSeconds:J
     .restart local v14       #file:Ljava/io/File;
     .restart local v16       #fileType:I
-    .restart local v18       #values:Landroid/content/ContentValues;
-    :catch_0
-    move-exception v12
-
-    .local v12, e:Landroid/os/RemoteException;
-    const-string v2, "MediaScanner"
-
-    const-string v3, "RemoteException in scanMtpFile"
-
-    invoke-static {v2, v3, v12}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
-
-    goto :goto_1
-
-    .end local v12           #e:Landroid/os/RemoteException;
-    .end local v18           #values:Landroid/content/ContentValues;
     :cond_2
     move/from16 v0, p3
 
@@ -6534,7 +6454,7 @@
     const/4 v15, 0x0
 
     .local v15, fileList:Landroid/database/Cursor;
-    :try_start_1
+    :try_start_0
     invoke-static/range {v16 .. v16}, Landroid/media/MediaFile;->isPlayListFileType(I)Z
 
     move-result v2
@@ -6584,9 +6504,9 @@
     move-object/from16 v0, p0
 
     invoke-direct {v0, v13, v15}, Landroid/media/MediaScanner;->processPlayList(Landroid/media/MediaScanner$FileEntry;Landroid/database/Cursor;)V
-    :try_end_1
-    .catchall {:try_start_1 .. :try_end_1} :catchall_0
-    .catch Landroid/os/RemoteException; {:try_start_1 .. :try_end_1} :catch_1
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+    .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
 
     .end local v13           #entry:Landroid/media/MediaScanner$FileEntry;
     :cond_3
@@ -6607,7 +6527,7 @@
     :cond_4
     const/4 v2, 0x0
 
-    :try_start_2
+    :try_start_1
     move-object/from16 v0, p0
 
     move-object/from16 v1, p1
@@ -6644,25 +6564,25 @@
     move-object/from16 v3, p1
 
     invoke-virtual/range {v2 .. v11}, Landroid/media/MediaScanner$MyMediaScannerClient;->doScanFile(Ljava/lang/String;Ljava/lang/String;JJZZZ)Landroid/net/Uri;
-    :try_end_2
-    .catchall {:try_start_2 .. :try_end_2} :catchall_0
-    .catch Landroid/os/RemoteException; {:try_start_2 .. :try_end_2} :catch_1
+    :try_end_1
+    .catchall {:try_start_1 .. :try_end_1} :catchall_0
+    .catch Landroid/os/RemoteException; {:try_start_1 .. :try_end_1} :catch_0
 
     goto :goto_2
 
     .end local v5           #lastModifiedSeconds:J
-    :catch_1
+    :catch_0
     move-exception v12
 
-    .restart local v12       #e:Landroid/os/RemoteException;
-    :try_start_3
+    .local v12, e:Landroid/os/RemoteException;
+    :try_start_2
     const-string v2, "MediaScanner"
 
     const-string v3, "RemoteException in MediaScanner.scanFile()"
 
     invoke-static {v2, v3, v12}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;Ljava/lang/Throwable;)I
-    :try_end_3
-    .catchall {:try_start_3 .. :try_end_3} :catchall_0
+    :try_end_2
+    .catchall {:try_start_2 .. :try_end_2} :catchall_0
 
     const/4 v2, 0x0
 
--- a/framework.jar.out/smali/android/text/SpanSet.smali
+++ b/framework.jar.out/smali/android/text/SpanSet.smali
@@ -167,6 +167,9 @@
     .parameter "spanned"
     .parameter "start"
     .parameter "limit"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     .local p0, this:Landroid/text/SpanSet;,"Landroid/text/SpanSet<TE;>;"
@@ -217,7 +220,7 @@
 
     iput-object v7, p0, Landroid/text/SpanSet;->spanFlags:[I
 
-    :cond_1
+    :goto_0
     const/4 v7, 0x0
 
     iput v7, p0, Landroid/text/SpanSet;->numberOfSpans:I
@@ -225,7 +228,7 @@
     const/4 v1, 0x0
 
     .local v1, i:I
-    :goto_0
+    :goto_1
     if-ge v1, v2, :cond_3
 
     aget-object v3, v0, v1
@@ -243,11 +246,24 @@
     .local v4, spanEnd:I
     if-ne v6, v4, :cond_2
 
-    :goto_1
+    :goto_2
     add-int/lit8 v1, v1, 0x1
 
+    goto :goto_1
+
+    .end local v1           #i:I
+    .end local v3           #span:Ljava/lang/Object;,"TE;"
+    .end local v4           #spanEnd:I
+    .end local v6           #spanStart:I
+    :cond_1
+    invoke-virtual {p0}, Landroid/text/SpanSet;->recycle()V
+
     goto :goto_0
 
+    .restart local v1       #i:I
+    .restart local v3       #span:Ljava/lang/Object;,"TE;"
+    .restart local v4       #spanEnd:I
+    .restart local v6       #spanStart:I
     :cond_2
     invoke-interface {p1, v3}, Landroid/text/Spanned;->getSpanFlags(Ljava/lang/Object;)I
 
@@ -284,7 +300,7 @@
 
     iput v7, p0, Landroid/text/SpanSet;->numberOfSpans:I
 
-    goto :goto_1
+    goto :goto_2
 
     .end local v3           #span:Ljava/lang/Object;,"TE;"
     .end local v4           #spanEnd:I
--- a/framework.jar.out/smali/android/util/TypedValue.smali
+++ b/framework.jar.out/smali/android/util/TypedValue.smali
@@ -88,6 +88,12 @@
 
 .field public static final TYPE_STRING:I = 0x3
 
+.field public static miui_font_scale:F
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 
 # instance fields
 .field public assetCookie:I
@@ -118,6 +124,10 @@
 
     const/4 v3, 0x0
 
+    const/high16 v0, 0x3f80
+
+    sput v0, Landroid/util/TypedValue;->miui_font_scale:F
+
     new-array v0, v6, [F
 
     fill-array-data v0, :array_0
@@ -199,6 +209,9 @@
     .parameter "unit"
     .parameter "value"
     .parameter "metrics"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     packed-switch p0, :pswitch_data_0
@@ -219,9 +232,9 @@
     goto :goto_0
 
     :pswitch_2
-    iget v0, p2, Landroid/util/DisplayMetrics;->scaledDensity:F
+    invoke-static {p1, p2}, Landroid/util/TypedValue;->miuiScale(FLandroid/util/DisplayMetrics;)F
 
-    mul-float/2addr p1, v0
+    move-result p1
 
     goto :goto_0
 
@@ -254,8 +267,6 @@
 
     goto :goto_0
 
-    nop
-
     :pswitch_data_0
     .packed-switch 0x0
         :pswitch_0
@@ -777,6 +788,40 @@
     .end packed-switch
 .end method
 
+.method private static miuiScale(FLandroid/util/DisplayMetrics;)F
+    .locals 2
+    .parameter "value"
+    .parameter "metrics"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/high16 v0, 0x41a0
+
+    cmpl-float v0, p0, v0
+
+    if-ltz v0, :cond_0
+
+    iget v0, p1, Landroid/util/DisplayMetrics;->density:F
+
+    mul-float/2addr v0, p0
+
+    :goto_0
+    return v0
+
+    :cond_0
+    iget v0, p1, Landroid/util/DisplayMetrics;->scaledDensity:F
+
+    mul-float/2addr v0, p0
+
+    sget v1, Landroid/util/TypedValue;->miui_font_scale:F
+
+    mul-float/2addr v0, v1
+
+    goto :goto_0
+.end method
+
 
 # virtual methods
 .method public final coerceToString()Ljava/lang/CharSequence;
--- a/framework.jar.out/smali/android/view/LayoutInflater.smali
+++ b/framework.jar.out/smali/android/view/LayoutInflater.smali
@@ -10,7 +10,8 @@
         Landroid/view/LayoutInflater$FactoryMerger;,
         Landroid/view/LayoutInflater$Factory2;,
         Landroid/view/LayoutInflater$Factory;,
-        Landroid/view/LayoutInflater$Filter;
+        Landroid/view/LayoutInflater$Filter;,
+        Landroid/view/LayoutInflater$Injector;
     }
 .end annotation
 
@@ -1495,11 +1496,22 @@
     .parameter "resource"
     .parameter "root"
     .parameter "attachToRoot"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     invoke-virtual {p0}, Landroid/view/LayoutInflater;->getContext()Landroid/content/Context;
 
     move-result-object v1
+
+    invoke-static {v1, p1}, Landroid/view/LayoutInflater$Injector;->getResourceId(Landroid/content/Context;I)I
+
+    move-result p1
+
+    invoke-virtual {p0}, Landroid/view/LayoutInflater;->getContext()Landroid/content/Context;
+
+    move-result-object v1
 
     invoke-virtual {v1}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
 
--- a/framework.jar.out/smali/android/view/View.smali
+++ b/framework.jar.out/smali/android/view/View.smali
@@ -709,6 +709,12 @@
 
 .field mAccessibilityViewId:I
 
+.field mAdditionalState:I
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mAnimator:Landroid/view/ViewPropertyAnimator;
 
 .field mAttachInfo:Landroid/view/View$AttachInfo;
@@ -1794,6 +1800,8 @@
     :goto_0
     iput-object v0, p0, Landroid/view/View;->mInputEventConsistencyVerifier:Landroid/view/InputEventConsistencyVerifier;
 
+    iput v2, p0, Landroid/view/View;->mAdditionalState:I
+
     iput-boolean v2, p0, Landroid/view/View;->mNeededToChangedScrollBarPosition:Z
 
     iput-object v1, p0, Landroid/view/View;->mHoverPopup:Landroid/widget/HoverPopupWindow;
@@ -1886,6 +1894,8 @@
     :goto_0
     iput-object v0, p0, Landroid/view/View;->mInputEventConsistencyVerifier:Landroid/view/InputEventConsistencyVerifier;
 
+    iput v2, p0, Landroid/view/View;->mAdditionalState:I
+
     iput-boolean v2, p0, Landroid/view/View;->mNeededToChangedScrollBarPosition:Z
 
     iput-object v1, p0, Landroid/view/View;->mHoverPopup:Landroid/widget/HoverPopupWindow;
@@ -13452,6 +13462,9 @@
 
 .method protected drawableStateChanged()V
     .locals 2
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v0, p0, Landroid/view/View;->mBackground:Landroid/graphics/drawable/Drawable;
@@ -13471,6 +13484,8 @@
 
     invoke-virtual {v0, v1}, Landroid/graphics/drawable/Drawable;->setState([I)Z
 
+    invoke-static {p0, v0}, Landroid/view/View$Injector;->onDrawableStateChanged(Landroid/view/View;Landroid/graphics/drawable/Drawable;)V
+
     :cond_0
     return-void
 .end method
@@ -13510,6 +13525,31 @@
     return-void
 .end method
 
+.method fillAdditionalState([I)[I
+    .locals 2
+    .parameter "states"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    move-object v0, p1
+
+    .local v0, newStates:[I
+    iget v1, p0, Landroid/view/View;->mAdditionalState:I
+
+    if-eqz v1, :cond_0
+
+    iget v1, p0, Landroid/view/View;->mAdditionalState:I
+
+    invoke-static {v0, v1}, Lmiui/util/UiUtils;->getViewStates([II)[I
+
+    move-result-object v0
+
+    :cond_0
+    return-object v0
+.end method
+
 .method public findFocus()Landroid/view/View;
     .locals 1
 
@@ -20808,6 +20848,9 @@
 .method protected onCreateDrawableState(I)[I
     .locals 8
     .parameter "extraSpace"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/high16 v7, 0x40
@@ -20945,6 +20988,10 @@
     aget-object v0, v5, v4
 
     .local v0, drawableState:[I
+    invoke-virtual {p0, v0}, Landroid/view/View;->fillAdditionalState([I)[I
+
+    move-result-object v0
+
     if-eqz p1, :cond_0
 
     if-eqz v0, :cond_c
@@ -25994,6 +26041,30 @@
     goto :goto_1
 .end method
 
+.method public setAdditionalState(I)V
+    .locals 1
+    .parameter "state"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/view/View;->mAdditionalState:I
+
+    if-eq p1, v0, :cond_0
+
+    iput p1, p0, Landroid/view/View;->mAdditionalState:I
+
+    const/4 v0, 0x1
+
+    invoke-virtual {p0, v0}, Landroid/view/View;->invalidate(Z)V
+
+    invoke-virtual {p0}, Landroid/view/View;->refreshDrawableState()V
+
+    :cond_0
+    return-void
+.end method
+
 .method public setAlpha(F)V
     .locals 3
     .parameter "alpha"
--- a/framework.jar.out/smali/android/view/ViewConfiguration.smali
+++ b/framework.jar.out/smali/android/view/ViewConfiguration.smali
@@ -3,6 +3,15 @@
 .source "ViewConfiguration.java"
 
 
+# annotations
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Landroid/view/ViewConfiguration$1;,
+        Landroid/view/ViewConfiguration$Injector;
+    }
+.end annotation
+
+
 # static fields
 .field public static final ALPHA_THRESHOLD:F = 0.020833334f
 
@@ -193,6 +202,9 @@
 .method private constructor <init>(Landroid/content/Context;)V
     .locals 13
     .parameter "context"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v8, 0x1
@@ -334,6 +346,10 @@
 
     float-to-int v10, v10
 
+    invoke-static {p1, v10}, Landroid/view/ViewConfiguration$Injector;->getOverScrollDistance(Landroid/content/Context;I)I
+
+    move-result v10
+
     iput v10, p0, Landroid/view/ViewConfiguration;->mOverscrollDistance:I
 
     const/high16 v10, 0x40c0
@@ -344,6 +360,10 @@
 
     float-to-int v10, v10
 
+    invoke-static {p1, v10}, Landroid/view/ViewConfiguration$Injector;->getOverFlingDistance(Landroid/content/Context;I)I
+
+    move-result v10
+
     iput v10, p0, Landroid/view/ViewConfiguration;->mOverflingDistance:I
 
     iget-boolean v10, p0, Landroid/view/ViewConfiguration;->sHasPermanentMenuKeySet:Z
@@ -432,52 +452,81 @@
     goto :goto_2
 .end method
 
+.method synthetic constructor <init>(Landroid/content/Context;Landroid/view/ViewConfiguration$1;)V
+    .locals 0
+    .parameter "x0"
+    .parameter "x1"
+
+    .prologue
+    invoke-direct {p0, p1}, Landroid/view/ViewConfiguration;-><init>(Landroid/content/Context;)V
+
+    return-void
+.end method
+
 .method public static get(Landroid/content/Context;)Landroid/view/ViewConfiguration;
-    .locals 5
+    .locals 6
     .parameter "context"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
+    invoke-static {p0}, Landroid/view/ViewConfiguration$Injector;->get(Landroid/content/Context;)Landroid/view/ViewConfiguration;
+
+    move-result-object v0
+
+    .local v0, cfg:Landroid/view/ViewConfiguration;
+    if-eqz v0, :cond_0
+
+    .end local v0           #cfg:Landroid/view/ViewConfiguration;
+    :goto_0
+    return-object v0
+
+    .restart local v0       #cfg:Landroid/view/ViewConfiguration;
+    :cond_0
     invoke-virtual {p0}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
 
-    move-result-object v3
+    move-result-object v4
 
-    invoke-virtual {v3}, Landroid/content/res/Resources;->getDisplayMetrics()Landroid/util/DisplayMetrics;
+    invoke-virtual {v4}, Landroid/content/res/Resources;->getDisplayMetrics()Landroid/util/DisplayMetrics;
 
-    move-result-object v2
+    move-result-object v3
 
-    .local v2, metrics:Landroid/util/DisplayMetrics;
-    const/high16 v3, 0x42c8
+    .local v3, metrics:Landroid/util/DisplayMetrics;
+    const/high16 v4, 0x42c8
 
-    iget v4, v2, Landroid/util/DisplayMetrics;->density:F
+    iget v5, v3, Landroid/util/DisplayMetrics;->density:F
 
-    mul-float/2addr v3, v4
+    mul-float/2addr v4, v5
 
-    float-to-int v1, v3
+    float-to-int v2, v4
 
-    .local v1, density:I
-    sget-object v3, Landroid/view/ViewConfiguration;->sConfigurations:Landroid/util/SparseArray;
+    .local v2, density:I
+    sget-object v4, Landroid/view/ViewConfiguration;->sConfigurations:Landroid/util/SparseArray;
 
-    invoke-virtual {v3, v1}, Landroid/util/SparseArray;->get(I)Ljava/lang/Object;
+    invoke-virtual {v4, v2}, Landroid/util/SparseArray;->get(I)Ljava/lang/Object;
 
-    move-result-object v0
+    move-result-object v1
 
-    check-cast v0, Landroid/view/ViewConfiguration;
+    check-cast v1, Landroid/view/ViewConfiguration;
 
-    .local v0, configuration:Landroid/view/ViewConfiguration;
-    if-nez v0, :cond_0
+    .local v1, configuration:Landroid/view/ViewConfiguration;
+    if-nez v1, :cond_1
 
-    new-instance v0, Landroid/view/ViewConfiguration;
+    new-instance v1, Landroid/view/ViewConfiguration;
 
-    .end local v0           #configuration:Landroid/view/ViewConfiguration;
-    invoke-direct {v0, p0}, Landroid/view/ViewConfiguration;-><init>(Landroid/content/Context;)V
+    .end local v1           #configuration:Landroid/view/ViewConfiguration;
+    invoke-direct {v1, p0}, Landroid/view/ViewConfiguration;-><init>(Landroid/content/Context;)V
 
-    .restart local v0       #configuration:Landroid/view/ViewConfiguration;
-    sget-object v3, Landroid/view/ViewConfiguration;->sConfigurations:Landroid/util/SparseArray;
+    .restart local v1       #configuration:Landroid/view/ViewConfiguration;
+    sget-object v4, Landroid/view/ViewConfiguration;->sConfigurations:Landroid/util/SparseArray;
 
-    invoke-virtual {v3, v1, v0}, Landroid/util/SparseArray;->put(ILjava/lang/Object;)V
+    invoke-virtual {v4, v2, v1}, Landroid/util/SparseArray;->put(ILjava/lang/Object;)V
 
-    :cond_0
-    return-object v0
+    :cond_1
+    move-object v0, v1
+
+    goto :goto_0
 .end method
 
 .method public static getDoubleTapSlop()I
--- a/framework.jar.out/smali/android/view/ViewGroup.smali
+++ b/framework.jar.out/smali/android/view/ViewGroup.smali
@@ -16,7 +16,9 @@
         Landroid/view/ViewGroup$TouchTarget;,
         Landroid/view/ViewGroup$MarginLayoutParams;,
         Landroid/view/ViewGroup$LayoutParams;,
-        Landroid/view/ViewGroup$OnHierarchyChangeListener;
+        Landroid/view/ViewGroup$OnHierarchyChangeListener;,
+        Landroid/view/ViewGroup$Injector;,
+        Landroid/view/ViewGroup$ChildSequenceStateTaggingListener;
     }
 .end annotation
 
@@ -116,6 +118,12 @@
     .end annotation
 .end field
 
+.field mChildSequenceStateTaggingListener:Landroid/view/ViewGroup$ChildSequenceStateTaggingListener;
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field final mChildTransformation:Landroid/view/animation/Transformation;
 
 .field private mChildren:[Landroid/view/View;
@@ -206,6 +214,12 @@
 
 .field protected mPersistentDrawingCache:I
 
+.field mTagChildrenSequenceState:Z
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mTransition:Landroid/animation/LayoutTransition;
 
 .field private mTransitioningViews:Ljava/util/ArrayList;
@@ -505,6 +519,9 @@
     .locals 6
     .parameter "child"
     .parameter "index"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v4, 0x0
@@ -545,6 +562,8 @@
 
     :cond_1
     :goto_0
+    invoke-static {p0}, Landroid/view/ViewGroup$Injector;->tagChildSequenceState(Landroid/view/ViewGroup;)V
+
     return-void
 
     :cond_2
@@ -2515,6 +2534,9 @@
     .locals 10
     .parameter "context"
     .parameter "attrs"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v9, 0x1
@@ -2670,6 +2692,12 @@
     .end local v2           #animateLayoutChanges:Z
     .end local v3           #attr:I
     :cond_1
+    invoke-static {p1, p2}, Landroid/view/ViewGroup$Injector;->initTagChildSequenceState(Landroid/content/Context;Landroid/util/AttributeSet;)Z
+
+    move-result v6
+
+    iput-boolean v6, p0, Landroid/view/ViewGroup;->mTagChildrenSequenceState:Z
+
     invoke-virtual {v1}, Landroid/content/res/TypedArray;->recycle()V
 
     return-void
@@ -2960,6 +2988,9 @@
 .method private removeFromArray(I)V
     .locals 5
     .parameter "index"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v4, 0x0
@@ -3017,6 +3048,8 @@
 
     :cond_2
     :goto_1
+    invoke-static {p0}, Landroid/view/ViewGroup$Injector;->tagChildSequenceState(Landroid/view/ViewGroup;)V
+
     return-void
 
     :cond_3
@@ -3067,6 +3100,9 @@
     .locals 6
     .parameter "start"
     .parameter "count"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v5, 0x0
@@ -3157,6 +3193,8 @@
 
     iput v4, p0, Landroid/view/ViewGroup;->mChildrenCount:I
 
+    invoke-static {p0}, Landroid/view/ViewGroup$Injector;->tagChildSequenceState(Landroid/view/ViewGroup;)V
+
     goto :goto_0
 .end method
 
@@ -4522,6 +4560,9 @@
 
 .method protected detachAllViewsFromParent()V
     .locals 5
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v4, 0x0
@@ -11560,6 +11601,9 @@
     .parameter "child"
     .parameter "oldVisibility"
     .parameter "newVisibility"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v0, p0, Landroid/view/ViewGroup;->mTransition:Landroid/animation/LayoutTransition;
@@ -11583,6 +11627,8 @@
     invoke-virtual {p0, p1}, Landroid/view/ViewGroup;->notifyChildOfDrag(Landroid/view/View;)Z
 
     :cond_1
+    invoke-static {p0}, Landroid/view/ViewGroup$Injector;->tagChildSequenceState(Landroid/view/ViewGroup;)V
+
     return-void
 
     :cond_2
@@ -12294,6 +12340,9 @@
 
 .method public removeAllViewsInLayout()V
     .locals 10
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v9, 0x0
@@ -12984,6 +13033,19 @@
 
     return-void
 .end method
+
+.method public setChildSequenceStateTaggingListener(Landroid/view/ViewGroup$ChildSequenceStateTaggingListener;)V
+    .locals 0
+    .parameter "listener"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-object p1, p0, Landroid/view/ViewGroup;->mChildSequenceStateTaggingListener:Landroid/view/ViewGroup$ChildSequenceStateTaggingListener;
+
+    return-void
+.end method
 
 .method protected setChildrenDrawingCacheEnabled(Z)V
     .locals 5
--- a/framework.jar.out/smali/android/webkit/WebViewClassic.smali
+++ b/framework.jar.out/smali/android/webkit/WebViewClassic.smali
@@ -31372,8 +31372,11 @@
     goto :goto_0
 .end method
 
-.method sendOurVisibleRect()Landroid/graphics/Rect;
+.method public sendOurVisibleRect()Landroid/graphics/Rect;
     .locals 4
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/16 v3, 0x6b
--- a/framework.jar.out/smali/com/android/internal/app/ActionBarImpl.smali
+++ b/framework.jar.out/smali/com/android/internal/app/ActionBarImpl.smali
@@ -7,7 +7,8 @@
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
         Lcom/android/internal/app/ActionBarImpl$TabImpl;,
-        Lcom/android/internal/app/ActionBarImpl$ActionModeImpl;
+        Lcom/android/internal/app/ActionBarImpl$ActionModeImpl;,
+        Lcom/android/internal/app/ActionBarImpl$Injector;
     }
 .end annotation
 
@@ -534,6 +535,9 @@
 
 .method private ensureTabsExist()V
     .locals 4
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v3, 0x0
@@ -546,11 +550,11 @@
     return-void
 
     :cond_0
-    new-instance v0, Lcom/android/internal/widget/ScrollingTabContainerView;
-
     iget-object v1, p0, Lcom/android/internal/app/ActionBarImpl;->mContext:Landroid/content/Context;
 
-    invoke-direct {v0, v1}, Lcom/android/internal/widget/ScrollingTabContainerView;-><init>(Landroid/content/Context;)V
+    invoke-static {v1}, Lcom/android/internal/app/ActionBarImpl$Injector;->getScrollingTabContainerView(Landroid/content/Context;)Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    move-result-object v0
 
     .local v0, tabScroller:Lcom/android/internal/widget/ScrollingTabContainerView;
     iget-boolean v1, p0, Lcom/android/internal/app/ActionBarImpl;->mHasEmbeddedTabs:Z
@@ -839,7 +843,7 @@
 
     move-result v3
 
-    invoke-direct {p0, v3}, Lcom/android/internal/app/ActionBarImpl;->setHasEmbeddedTabs(Z)V
+    invoke-direct {p0, v3}, Lcom/android/internal/app/ActionBarImpl;->setHasEmbeddedTabsWrap(Z)V
 
     return-void
 
@@ -1014,6 +1018,26 @@
     goto :goto_4
 .end method
 
+.method private setHasEmbeddedTabsWrap(Z)V
+    .locals 1
+    .parameter "hasEmbeddedTabs"
+
+    .prologue
+    invoke-virtual {p0, p1}, Lcom/android/internal/app/ActionBarImpl;->miuiSetHasEmbeddedTabs(Z)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    :goto_0
+    return-void
+
+    :cond_0
+    invoke-direct {p0, p1}, Lcom/android/internal/app/ActionBarImpl;->setHasEmbeddedTabs(Z)V
+
+    goto :goto_0
+.end method
+
 .method private showForActionMode()V
     .locals 2
 
@@ -1788,6 +1812,66 @@
     .end array-data
 .end method
 
+.method protected getActionBarOverlayLayout()Lcom/android/internal/widget/ActionBarOverlayLayout;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/app/ActionBarImpl;->mOverlayLayout:Lcom/android/internal/widget/ActionBarOverlayLayout;
+
+    return-object v0
+.end method
+
+.method protected getActionView()Lcom/android/internal/widget/ActionBarView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/app/ActionBarImpl;->mActionView:Lcom/android/internal/widget/ActionBarView;
+
+    return-object v0
+.end method
+
+.method protected getContainerView()Lcom/android/internal/widget/ActionBarContainer;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/app/ActionBarImpl;->mContainerView:Lcom/android/internal/widget/ActionBarContainer;
+
+    return-object v0
+.end method
+
+.method protected getContextDisplayMode()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Lcom/android/internal/app/ActionBarImpl;->mContextDisplayMode:I
+
+    return v0
+.end method
+
+.method protected getContextView()Lcom/android/internal/widget/ActionBarContextView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/app/ActionBarImpl;->mContextView:Lcom/android/internal/widget/ActionBarContextView;
+
+    return-object v0
+.end method
+
 .method public getCustomView()Landroid/view/View;
     .locals 1
 
@@ -1950,6 +2034,18 @@
     return-object v0
 .end method
 
+.method protected getSplitView()Lcom/android/internal/widget/ActionBarContainer;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/app/ActionBarImpl;->mSplitView:Lcom/android/internal/widget/ActionBarContainer;
+
+    return-object v0
+.end method
+
 .method public getSubtitle()Ljava/lang/CharSequence;
     .locals 1
 
@@ -1992,6 +2088,18 @@
     return v0
 .end method
 
+.method protected getTabScrollView()Lcom/android/internal/widget/ScrollingTabContainerView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/app/ActionBarImpl;->mTabScrollView:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    return-object v0
+.end method
+
 .method public getThemedContext()Landroid/content/Context;
     .locals 5
 
@@ -2165,6 +2273,164 @@
     goto :goto_0
 .end method
 
+.method protected miuiSetHasEmbeddedTabs(Z)Z
+    .locals 6
+    .parameter "hasEmbeddedTabs"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v5, 0x0
+
+    const/4 v2, 0x1
+
+    const/4 v3, 0x0
+
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mContext:Landroid/content/Context;
+
+    invoke-static {v4}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v4
+
+    if-nez v4, :cond_0
+
+    :goto_0
+    return v3
+
+    :cond_0
+    invoke-virtual {p0}, Lcom/android/internal/app/ActionBarImpl;->getDisplayOptions()I
+
+    move-result v4
+
+    and-int/lit8 v4, v4, 0xa
+
+    if-eqz v4, :cond_4
+
+    move v1, v2
+
+    .local v1, showTitleOrHome:Z
+    :goto_1
+    if-eqz p1, :cond_5
+
+    if-nez v1, :cond_5
+
+    move p1, v2
+
+    :goto_2
+    iget-boolean v4, p0, Lcom/android/internal/app/ActionBarImpl;->mHasEmbeddedTabs:Z
+
+    if-eq v4, p1, :cond_3
+
+    iput-boolean p1, p0, Lcom/android/internal/app/ActionBarImpl;->mHasEmbeddedTabs:Z
+
+    iget-boolean v4, p0, Lcom/android/internal/app/ActionBarImpl;->mHasEmbeddedTabs:Z
+
+    if-nez v4, :cond_6
+
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mActionView:Lcom/android/internal/widget/ActionBarView;
+
+    invoke-virtual {v4, v5}, Lcom/android/internal/widget/ActionBarView;->setEmbeddedTabView(Lcom/android/internal/widget/ScrollingTabContainerView;)V
+
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mContainerView:Lcom/android/internal/widget/ActionBarContainer;
+
+    iget-object v5, p0, Lcom/android/internal/app/ActionBarImpl;->mTabScrollView:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    invoke-virtual {v4, v5}, Lcom/android/internal/widget/ActionBarContainer;->setTabContainer(Lcom/android/internal/widget/ScrollingTabContainerView;)V
+
+    :goto_3
+    invoke-virtual {p0}, Lcom/android/internal/app/ActionBarImpl;->getNavigationMode()I
+
+    move-result v4
+
+    const/4 v5, 0x2
+
+    if-ne v4, v5, :cond_7
+
+    move v0, v2
+
+    .local v0, isInTabMode:Z
+    :goto_4
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mTabScrollView:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    if-eqz v4, :cond_1
+
+    if-eqz v0, :cond_8
+
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mTabScrollView:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    invoke-virtual {v4, v3}, Lcom/android/internal/widget/ScrollingTabContainerView;->setVisibility(I)V
+
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mOverlayLayout:Lcom/android/internal/widget/ActionBarOverlayLayout;
+
+    if-eqz v4, :cond_1
+
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mOverlayLayout:Lcom/android/internal/widget/ActionBarOverlayLayout;
+
+    invoke-virtual {v4}, Lcom/android/internal/widget/ActionBarOverlayLayout;->requestFitSystemWindows()V
+
+    :cond_1
+    :goto_5
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mActionView:Lcom/android/internal/widget/ActionBarView;
+
+    iget-boolean v5, p0, Lcom/android/internal/app/ActionBarImpl;->mHasEmbeddedTabs:Z
+
+    if-nez v5, :cond_2
+
+    if-eqz v0, :cond_2
+
+    move v3, v2
+
+    :cond_2
+    invoke-virtual {v4, v3}, Lcom/android/internal/widget/ActionBarView;->setCollapsable(Z)V
+
+    .end local v0           #isInTabMode:Z
+    :cond_3
+    move v3, v2
+
+    goto :goto_0
+
+    .end local v1           #showTitleOrHome:Z
+    :cond_4
+    move v1, v3
+
+    goto :goto_1
+
+    .restart local v1       #showTitleOrHome:Z
+    :cond_5
+    move p1, v3
+
+    goto :goto_2
+
+    :cond_6
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mContainerView:Lcom/android/internal/widget/ActionBarContainer;
+
+    invoke-virtual {v4, v5}, Lcom/android/internal/widget/ActionBarContainer;->setTabContainer(Lcom/android/internal/widget/ScrollingTabContainerView;)V
+
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mActionView:Lcom/android/internal/widget/ActionBarView;
+
+    iget-object v5, p0, Lcom/android/internal/app/ActionBarImpl;->mTabScrollView:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    invoke-virtual {v4, v5}, Lcom/android/internal/widget/ActionBarView;->setEmbeddedTabView(Lcom/android/internal/widget/ScrollingTabContainerView;)V
+
+    goto :goto_3
+
+    :cond_7
+    move v0, v3
+
+    goto :goto_4
+
+    .restart local v0       #isInTabMode:Z
+    :cond_8
+    iget-object v4, p0, Lcom/android/internal/app/ActionBarImpl;->mTabScrollView:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    const/16 v5, 0x8
+
+    invoke-virtual {v4, v5}, Lcom/android/internal/widget/ScrollingTabContainerView;->setVisibility(I)V
+
+    goto :goto_5
+.end method
+
 .method public newTab()Landroid/app/ActionBar$Tab;
     .locals 1
 
@@ -2191,7 +2457,7 @@
 
     move-result v0
 
-    invoke-direct {p0, v0}, Lcom/android/internal/app/ActionBarImpl;->setHasEmbeddedTabs(Z)V
+    invoke-direct {p0, v0}, Lcom/android/internal/app/ActionBarImpl;->setHasEmbeddedTabsWrap(Z)V
 
     return-void
 .end method
@@ -3214,18 +3480,3 @@
 
     goto :goto_0
 .end method
-
-.method public setHomeViewBackground(I)V
-    .locals 1
-    .parameter "resId"
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    iget-object v0, p0, Lcom/android/internal/app/ActionBarImpl;->mActionView:Lcom/android/internal/widget/ActionBarView;
-
-    invoke-virtual {v0, p1}, Lcom/android/internal/widget/ActionBarView;->setHomeViewBackground(I)V
-
-    return-void
-.end method
--- a/framework.jar.out/smali/com/android/internal/app/ResolverActivity$ResolveListAdapter.smali
+++ b/framework.jar.out/smali/com/android/internal/app/ResolverActivity$ResolveListAdapter.smali
@@ -208,6 +208,16 @@
 
     invoke-virtual {v0, v3}, Landroid/widget/ImageView;->setImageDrawable(Landroid/graphics/drawable/Drawable;)V
 
+    iget-object v3, p0, Lcom/android/internal/app/ResolverActivity$ResolveListAdapter;->this$0:Lcom/android/internal/app/ResolverActivity;
+
+    iget-object v4, p0, Lcom/android/internal/app/ResolverActivity$ResolveListAdapter;->mList:Ljava/util/List;
+
+    invoke-interface {v4, p2}, Ljava/util/List;->indexOf(Ljava/lang/Object;)I
+
+    move-result v4
+
+    invoke-static {v0, v3, p0, v4}, Lcom/android/internal/app/ResolverActivity$Injector;->addListener(Landroid/view/View;Lcom/android/internal/app/ResolverActivity;Lcom/android/internal/app/ResolverActivity$ResolveListAdapter;I)V
+
     return-void
 
     :cond_1
@@ -1126,9 +1136,12 @@
     .parameter "position"
     .parameter "convertView"
     .parameter "parent"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
-    if-nez p2, :cond_0
+    if-nez p2, :cond_2
 
     iget-object v3, p0, Lcom/android/internal/app/ResolverActivity$ResolveListAdapter;->mInflater:Landroid/view/LayoutInflater;
 
@@ -1155,6 +1168,15 @@
     move-result-object v1
 
     .local v1, lp:Landroid/view/ViewGroup$LayoutParams;
+    iget v3, v1, Landroid/view/ViewGroup$LayoutParams;->width:I
+
+    if-eqz v3, :cond_0
+
+    iget v3, v1, Landroid/view/ViewGroup$LayoutParams;->height:I
+
+    if-nez v3, :cond_1
+
+    :cond_0
     iget-object v3, p0, Lcom/android/internal/app/ResolverActivity$ResolveListAdapter;->this$0:Lcom/android/internal/app/ResolverActivity;
 
     #getter for: Lcom/android/internal/app/ResolverActivity;->mIconSize:I
@@ -1168,6 +1190,7 @@
 
     .end local v0           #icon:Landroid/widget/ImageView;
     .end local v1           #lp:Landroid/view/ViewGroup$LayoutParams;
+    :cond_1
     :goto_0
     iget-object v3, p0, Lcom/android/internal/app/ResolverActivity$ResolveListAdapter;->mList:Ljava/util/List;
 
@@ -1182,7 +1205,7 @@
     return-object v2
 
     .end local v2           #view:Landroid/view/View;
-    :cond_0
+    :cond_2
     move-object v2, p2
 
     .restart local v2       #view:Landroid/view/View;
--- a/framework.jar.out/smali/com/android/internal/app/ResolverActivity.smali
+++ b/framework.jar.out/smali/com/android/internal/app/ResolverActivity.smali
@@ -383,6 +383,10 @@
     .parameter "initialIntents"
     .parameter
     .parameter "alwaysUseOption"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
     .annotation system Ldalvik/annotation/Signature;
         value = {
             "(",
@@ -400,7 +404,7 @@
 
     .prologue
     .local p5, rList:Ljava/util/List;,"Ljava/util/List<Landroid/content/pm/ResolveInfo;>;"
-    const v2, 0x103031a
+    const v2, 0x60d003e
 
     move-object/from16 v0, p0
 
@@ -442,13 +446,7 @@
 
     iput-boolean v0, v1, Lcom/android/internal/app/ResolverActivity;->mAlwaysUseOption:Z
 
-    invoke-virtual/range {p0 .. p0}, Lcom/android/internal/app/ResolverActivity;->getResources()Landroid/content/res/Resources;
-
-    move-result-object v2
-
-    const v3, 0x10e0034
-
-    invoke-virtual {v2, v3}, Landroid/content/res/Resources;->getInteger(I)I
+    invoke-static/range {p0 .. p0}, Lcom/android/internal/app/ResolverActivity$Injector;->getMaxColumns(Lcom/android/internal/app/ResolverActivity;)I
 
     move-result v2
 
@@ -506,7 +504,7 @@
 
     if-lt v2, v3, :cond_3
 
-    const v2, 0x103031a
+    const v2, 0x60d003e
 
     move-object/from16 v0, p0
 
@@ -621,6 +619,11 @@
 
     :cond_1
     :goto_3
+
+    move-object/from16 v0, p0
+    move/from16 v2, p6
+
+    invoke-static {v0, v2}, Lcom/android/internal/app/ResolverActivity$Injector;->initialize(Lcom/android/internal/app/ResolverActivity;Z)V
     return-void
 
     .end local v9           #am:Landroid/app/ActivityManager;
@@ -651,7 +654,7 @@
     goto/16 :goto_1
 
     :cond_3
-    const v2, 0x1030319
+    const v2, 0x60d003e
 
     move-object/from16 v0, p0
 
@@ -788,6 +791,12 @@
 
     if-eqz p6, :cond_7
 
+    invoke-static/range {p0 .. p0}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v1
+
+    if-nez v1, :cond_7
+
     const v2, 0x1020294
 
     move-object/from16 v0, p0
@@ -1813,6 +1822,19 @@
 
     return-void
 .end method
+
+.method setAlwaysUseOption(Z)V
+    .locals 0
+    .parameter "alwaysUseOption"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-boolean p1, p0, Lcom/android/internal/app/ResolverActivity;->mAlwaysUseOption:Z
+
+    return-void
+.end method
 
 .method showAppDetails(Landroid/content/pm/ResolveInfo;)V
     .locals 5
--- a/framework.jar.out/smali/com/android/internal/statusbar/IStatusBar$Stub$Proxy.smali
+++ b/framework.jar.out/smali/com/android/internal/statusbar/IStatusBar$Stub$Proxy.smali
@@ -755,6 +755,77 @@
     throw v1
 .end method
 
+.method public setStatus(ILjava/lang/String;Landroid/os/Bundle;)V
+    .locals 5
+    .parameter "what"
+    .parameter "action"
+    .parameter "ext"
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Landroid/os/RemoteException;
+        }
+    .end annotation
+
+    .prologue
+    invoke-static {}, Landroid/os/Parcel;->obtain()Landroid/os/Parcel;
+
+    move-result-object v0
+
+    .local v0, _data:Landroid/os/Parcel;
+    :try_start_0
+    const-string v1, "com.android.internal.statusbar.IStatusBar"
+
+    invoke-virtual {v0, v1}, Landroid/os/Parcel;->writeInterfaceToken(Ljava/lang/String;)V
+
+    invoke-virtual {v0, p1}, Landroid/os/Parcel;->writeInt(I)V
+
+    invoke-virtual {v0, p2}, Landroid/os/Parcel;->writeString(Ljava/lang/String;)V
+
+    if-eqz p3, :cond_0
+
+    const/4 v1, 0x1
+
+    invoke-virtual {v0, v1}, Landroid/os/Parcel;->writeInt(I)V
+
+    const/4 v1, 0x0
+
+    invoke-virtual {p3, v0, v1}, Landroid/os/Bundle;->writeToParcel(Landroid/os/Parcel;I)V
+
+    :goto_0
+    iget-object v1, p0, Lcom/android/internal/statusbar/IStatusBar$Stub$Proxy;->mRemote:Landroid/os/IBinder;
+
+    const/16 v2, 0x10
+
+    const/4 v3, 0x0
+
+    const/4 v4, 0x1
+
+    invoke-interface {v1, v2, v0, v3, v4}, Landroid/os/IBinder;->transact(ILandroid/os/Parcel;Landroid/os/Parcel;I)Z
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    invoke-virtual {v0}, Landroid/os/Parcel;->recycle()V
+
+    return-void
+
+    :cond_0
+    const/4 v1, 0x0
+
+    :try_start_1
+    invoke-virtual {v0, v1}, Landroid/os/Parcel;->writeInt(I)V
+    :try_end_1
+    .catchall {:try_start_1 .. :try_end_1} :catchall_0
+
+    goto :goto_0
+
+    :catchall_0
+    move-exception v1
+
+    invoke-virtual {v0}, Landroid/os/Parcel;->recycle()V
+
+    throw v1
+.end method
+
 .method public setSystemUiVisibility(II)V
     .locals 5
     .parameter "vis"
--- a/framework.jar.out/smali/com/android/internal/statusbar/IStatusBar.smali
+++ b/framework.jar.out/smali/com/android/internal/statusbar/IStatusBar.smali
@@ -127,6 +127,14 @@
     .end annotation
 .end method
 
+.method public abstract setStatus(ILjava/lang/String;Landroid/os/Bundle;)V
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Landroid/os/RemoteException;
+        }
+    .end annotation
+.end method
+
 .method public abstract setSystemUiVisibility(II)V
     .annotation system Ldalvik/annotation/Throws;
         value = {
--- a/framework.jar.out/smali/com/android/internal/statusbar/IStatusBarService$Stub$Proxy.smali
+++ b/framework.jar.out/smali/com/android/internal/statusbar/IStatusBarService$Stub$Proxy.smali
@@ -1284,6 +1284,89 @@
     throw v2
 .end method
 
+.method public setStatus(ILandroid/os/IBinder;Ljava/lang/String;Landroid/os/Bundle;)V
+    .locals 5
+    .parameter "what"
+    .parameter "token"
+    .parameter "action"
+    .parameter "ext"
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Landroid/os/RemoteException;
+        }
+    .end annotation
+
+    .prologue
+    invoke-static {}, Landroid/os/Parcel;->obtain()Landroid/os/Parcel;
+
+    move-result-object v0
+
+    .local v0, _data:Landroid/os/Parcel;
+    invoke-static {}, Landroid/os/Parcel;->obtain()Landroid/os/Parcel;
+
+    move-result-object v1
+
+    .local v1, _reply:Landroid/os/Parcel;
+    :try_start_0
+    const-string v2, "com.android.internal.statusbar.IStatusBarService"
+
+    invoke-virtual {v0, v2}, Landroid/os/Parcel;->writeInterfaceToken(Ljava/lang/String;)V
+
+    invoke-virtual {v0, p1}, Landroid/os/Parcel;->writeInt(I)V
+
+    invoke-virtual {v0, p2}, Landroid/os/Parcel;->writeStrongBinder(Landroid/os/IBinder;)V
+
+    invoke-virtual {v0, p3}, Landroid/os/Parcel;->writeString(Ljava/lang/String;)V
+
+    if-eqz p4, :cond_0
+
+    const/4 v2, 0x1
+
+    invoke-virtual {v0, v2}, Landroid/os/Parcel;->writeInt(I)V
+
+    const/4 v2, 0x0
+
+    invoke-virtual {p4, v0, v2}, Landroid/os/Bundle;->writeToParcel(Landroid/os/Parcel;I)V
+
+    :goto_0
+    iget-object v2, p0, Lcom/android/internal/statusbar/IStatusBarService$Stub$Proxy;->mRemote:Landroid/os/IBinder;
+
+    const/16 v3, 0x14
+
+    const/4 v4, 0x0
+
+    invoke-interface {v2, v3, v0, v1, v4}, Landroid/os/IBinder;->transact(ILandroid/os/Parcel;Landroid/os/Parcel;I)Z
+
+    invoke-virtual {v1}, Landroid/os/Parcel;->readException()V
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    invoke-virtual {v1}, Landroid/os/Parcel;->recycle()V
+
+    invoke-virtual {v0}, Landroid/os/Parcel;->recycle()V
+
+    return-void
+
+    :cond_0
+    const/4 v2, 0x0
+
+    :try_start_1
+    invoke-virtual {v0, v2}, Landroid/os/Parcel;->writeInt(I)V
+    :try_end_1
+    .catchall {:try_start_1 .. :try_end_1} :catchall_0
+
+    goto :goto_0
+
+    :catchall_0
+    move-exception v2
+
+    invoke-virtual {v1}, Landroid/os/Parcel;->recycle()V
+
+    invoke-virtual {v0}, Landroid/os/Parcel;->recycle()V
+
+    throw v2
+.end method
+
 .method public setSystemUiVisibility(II)V
     .locals 5
     .parameter "vis"
--- a/framework.jar.out/smali/com/android/internal/statusbar/IStatusBarService.smali
+++ b/framework.jar.out/smali/com/android/internal/statusbar/IStatusBarService.smali
@@ -195,6 +195,14 @@
     .end annotation
 .end method
 
+.method public abstract setStatus(ILandroid/os/IBinder;Ljava/lang/String;Landroid/os/Bundle;)V
+    .annotation system Ldalvik/annotation/Throws;
+        value = {
+            Landroid/os/RemoteException;
+        }
+    .end annotation
+.end method
+
 .method public abstract setSystemUiVisibility(II)V
     .annotation system Ldalvik/annotation/Throws;
         value = {
--- a/framework.jar.out/smali/com/android/internal/telephony/TelephonyCapabilities.smali
+++ b/framework.jar.out/smali/com/android/internal/telephony/TelephonyCapabilities.smali
@@ -8,7 +8,7 @@
 
 
 # direct methods
-.method private constructor <init>()V
+.method protected constructor <init>()V
     .locals 0
 
     .prologue
--- a/framework2.jar.out/smali/android/preference/CheckBoxPreference.smali
+++ b/framework2.jar.out/smali/android/preference/CheckBoxPreference.smali
@@ -95,7 +95,7 @@
     .local v0, slidingButton:Lmiui/widget/SlidingButton;
     new-instance v1, Landroid/preference/CheckBoxPreference$1;
 
-    invoke-direct {v1, p0, v0}, Landroid/preference/CheckBoxPreference$1;-><init>(Landroid/preference/CheckBoxPreference;Lmiui/widget/SlidingButton;)V
+    invoke-direct {v1, p0}, Landroid/preference/CheckBoxPreference$1;-><init>(Landroid/preference/CheckBoxPreference;)V
 
     invoke-virtual {v0, v1}, Lmiui/widget/SlidingButton;->setOnCheckedChangedListener(Lmiui/widget/SlidingButton$OnCheckedChangedListener;)V
 
--- a/framework2.jar.out/smali/android/preference/Preference.smali
+++ b/framework2.jar.out/smali/android/preference/Preference.smali
@@ -11,6 +11,7 @@
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
         Landroid/preference/Preference$BaseSavedState;,
+        Landroid/preference/Preference$Injector;,
         Landroid/preference/Preference$OnPreferenceChangeInternalListener;,
         Landroid/preference/Preference$OnPreferenceClickListener;,
         Landroid/preference/Preference$OnPreferenceChangeListener;
@@ -87,6 +88,12 @@
 
 .field private mPreferenceManager:Landroid/preference/PreferenceManager;
 
+.field mPreferenceParent:Landroid/preference/PreferenceGroup;
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mRequiresKey:Z
 
 .field private mSelectable:Z
@@ -378,6 +385,26 @@
     .end packed-switch
 .end method
 
+.method static synthetic access$000(Landroid/preference/Preference;)Landroid/content/Context;
+    .locals 1
+    .parameter "x0"
+
+    .prologue
+    iget-object v0, p0, Landroid/preference/Preference;->mContext:Landroid/content/Context;
+
+    return-object v0
+.end method
+
+.method static synthetic access$100(Landroid/preference/Preference;)I
+    .locals 1
+    .parameter "x0"
+
+    .prologue
+    iget v0, p0, Landroid/preference/Preference;->mWidgetLayoutResId:I
+
+    return v0
+.end method
+
 .method private dispatchSetInitialValue()V
     .locals 3
 
@@ -1556,12 +1583,17 @@
 .method protected onBindView(Landroid/view/View;)V
     .locals 9
     .parameter "view"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/16 v6, 0x8
 
     const/4 v5, 0x0
 
+    invoke-static {p0, p1}, Landroid/preference/Preference$Injector;->onBindView(Landroid/preference/Preference;Landroid/view/View;)V
+
     const v7, 0x1020016
 
     invoke-virtual {p1, v7}, Landroid/view/View;->findViewById(I)Landroid/view/View;
@@ -2529,6 +2561,19 @@
     return-void
 .end method
 
+.method public setParent(Landroid/preference/PreferenceGroup;)V
+    .locals 0
+    .parameter "parent"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-object p1, p0, Landroid/preference/Preference;->mPreferenceParent:Landroid/preference/PreferenceGroup;
+
+    return-void
+.end method
+
 .method public setPersistent(Z)V
     .locals 0
     .parameter "persistent"
--- a/framework2.jar.out/smali/android/preference/PreferenceActivity$HeaderAdapter.smali
+++ b/framework2.jar.out/smali/android/preference/PreferenceActivity$HeaderAdapter.smali
@@ -161,11 +161,13 @@
 
     if-nez p2, :cond_1
 
-    iget-object v4, p0, Landroid/preference/PreferenceActivity$HeaderAdapter;->mInflater:Landroid/view/LayoutInflater;
+    invoke-virtual {p0}, Landroid/preference/PreferenceActivity$HeaderAdapter;->getContext()Landroid/content/Context;
+
+    move-result-object v4
 
-    iget v5, p0, Landroid/preference/PreferenceActivity$HeaderAdapter;->mHeaderItemLayoutResID:I
+    iget-object v5, p0, Landroid/preference/PreferenceActivity$HeaderAdapter;->mInflater:Landroid/view/LayoutInflater;
 
-    invoke-virtual {v4, v5, p3, v6}, Landroid/view/LayoutInflater;->inflate(ILandroid/view/ViewGroup;Z)Landroid/view/View;
+    invoke-static {v4, p3, v5}, Landroid/preference/PreferenceActivity$Injector;->getItemView(Landroid/content/Context;Landroid/view/ViewGroup;Landroid/view/LayoutInflater;)Landroid/view/View;
 
     move-result-object v3
 
@@ -223,6 +225,12 @@
 
     invoke-virtual {v4, v5}, Landroid/widget/ImageView;->setImageResource(I)V
 
+    iget-object v4, v1, Landroid/preference/PreferenceActivity$HeaderAdapter$HeaderViewHolder;->icon:Landroid/widget/ImageView;
+
+    iget v5, v0, Landroid/preference/PreferenceActivity$Header;->iconRes:I
+
+    invoke-static {v4, v5}, Landroid/preference/PreferenceActivity$Injector;->setIconVisible(Landroid/widget/ImageView;I)V
+
     iget-object v4, v1, Landroid/preference/PreferenceActivity$HeaderAdapter$HeaderViewHolder;->title:Landroid/widget/TextView;
 
     invoke-virtual {p0}, Landroid/preference/PreferenceActivity$HeaderAdapter;->getContext()Landroid/content/Context;
@@ -260,7 +268,9 @@
 
     iget-object v4, v1, Landroid/preference/PreferenceActivity$HeaderAdapter$HeaderViewHolder;->summary:Landroid/widget/TextView;
 
-    invoke-virtual {v4, v6}, Landroid/widget/TextView;->setVisibility(I)V
+    const/4 v5, 0x0
+
+    invoke-virtual {v4, v5}, Landroid/widget/TextView;->setVisibility(I)V
 
     iget-object v4, v1, Landroid/preference/PreferenceActivity$HeaderAdapter$HeaderViewHolder;->summary:Landroid/widget/TextView;
 
--- a/framework2.jar.out/smali/android/preference/PreferenceActivity.smali
+++ b/framework2.jar.out/smali/android/preference/PreferenceActivity.smali
@@ -11,6 +11,7 @@
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
         Landroid/preference/PreferenceActivity$Header;,
+        Landroid/preference/PreferenceActivity$Injector;,
         Landroid/preference/PreferenceActivity$HeaderAdapter;
     }
 .end annotation
@@ -2244,6 +2245,8 @@
 
     if-lez v22, :cond_e
 
+    invoke-static/range {p0 .. p0}, Landroid/preference/PreferenceActivity$Injector;->setListViewPadding(Landroid/preference/PreferenceActivity;)V
+
     new-instance v22, Landroid/preference/PreferenceActivity$HeaderAdapter;
 
     move-object/from16 v0, p0
--- a/framework2.jar.out/smali/android/preference/PreferenceGroup.smali
+++ b/framework2.jar.out/smali/android/preference/PreferenceGroup.smali
@@ -154,6 +154,9 @@
 .method public addPreference(Landroid/preference/Preference;)Z
     .locals 4
     .parameter "preference"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v2, 0x1
@@ -257,6 +260,8 @@
     :cond_5
     invoke-virtual {p0}, Landroid/preference/PreferenceGroup;->notifyHierarchyChanged()V
 
+    invoke-virtual {p1, p0}, Landroid/preference/Preference;->setParent(Landroid/preference/PreferenceGroup;)V
+
     move v1, v2
 
     goto :goto_0
--- a/framework2.jar.out/smali/android/preference/PreferenceScreen.smali
+++ b/framework2.jar.out/smali/android/preference/PreferenceScreen.smali
@@ -10,6 +10,7 @@
 # annotations
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
+        Landroid/preference/PreferenceScreen$Injector;,
         Landroid/preference/PreferenceScreen$SavedState;
     }
 .end annotation
@@ -207,6 +208,9 @@
 .method public bind(Landroid/widget/ListView;)V
     .locals 1
     .parameter "listView"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     invoke-virtual {p1, p0}, Landroid/widget/ListView;->setOnItemClickListener(Landroid/widget/AdapterView$OnItemClickListener;)V
@@ -215,8 +219,16 @@
 
     move-result-object v0
 
+    invoke-static {p1, v0}, Landroid/preference/PreferenceScreen$Injector;->addHeaderView(Landroid/widget/ListView;Landroid/widget/ListAdapter;)V
+
+    invoke-virtual {p0}, Landroid/preference/PreferenceScreen;->getRootAdapter()Landroid/widget/ListAdapter;
+
+    move-result-object v0
+
     invoke-virtual {p1, v0}, Landroid/widget/ListView;->setAdapter(Landroid/widget/ListAdapter;)V
 
+    invoke-static {p1}, Landroid/preference/PreferenceScreen$Injector;->bind(Landroid/widget/ListView;)V
+
     invoke-virtual {p0}, Landroid/preference/PreferenceScreen;->onAttachedToActivity()V
 
     return-void
--- a/framework2.jar.out/smali/android/speech/tts/TextToSpeech$Connection.smali
+++ b/framework2.jar.out/smali/android/speech/tts/TextToSpeech$Connection.smali
@@ -82,6 +82,36 @@
     return-object v0
 .end method
 
+.method public isConnected()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/speech/tts/TextToSpeech$Connection;->mService:Landroid/speech/tts/ITextToSpeechService;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Landroid/speech/tts/TextToSpeech$Connection;->mService:Landroid/speech/tts/ITextToSpeechService;
+
+    invoke-interface {v0}, Landroid/speech/tts/ITextToSpeechService;->asBinder()Landroid/os/IBinder;
+
+    move-result-object v0
+
+    invoke-interface {v0}, Landroid/os/IBinder;->isBinderAlive()Z
+
+    move-result v0
+
+    :goto_0
+    return v0
+
+    :cond_0
+    const/4 v0, 0x0
+
+    goto :goto_0
+.end method
+
 .method public onServiceConnected(Landroid/content/ComponentName;Landroid/os/IBinder;)V
     .locals 5
     .parameter "name"
--- a/framework2.jar.out/smali/android/speech/tts/TextToSpeech.smali
+++ b/framework2.jar.out/smali/android/speech/tts/TextToSpeech.smali
@@ -1816,3 +1816,30 @@
 
     return v0
 .end method
+
+.method public tryReconnectIfDead()V
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/speech/tts/TextToSpeech;->mServiceConnection:Landroid/speech/tts/TextToSpeech$Connection;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Landroid/speech/tts/TextToSpeech;->mServiceConnection:Landroid/speech/tts/TextToSpeech$Connection;
+
+    invoke-virtual {v0}, Landroid/speech/tts/TextToSpeech$Connection;->isConnected()Z
+
+    move-result v0
+
+    if-nez v0, :cond_0
+
+    invoke-virtual {p0}, Landroid/speech/tts/TextToSpeech;->shutdown()V
+
+    invoke-direct {p0}, Landroid/speech/tts/TextToSpeech;->initTts()I
+
+    :cond_0
+    return-void
+.end method
--- a/framework2.jar.out/smali/android/widget/CompoundButton.smali
+++ b/framework2.jar.out/smali/android/widget/CompoundButton.smali
@@ -207,8 +207,22 @@
 .method protected onDraw(Landroid/graphics/Canvas;)V
     .locals 7
     .parameter "canvas"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
+    invoke-virtual {p0, p1}, Landroid/widget/CompoundButton;->onDrawMiui(Landroid/graphics/Canvas;)Z
+
+    move-result v4
+
+    if-eqz v4, :cond_1
+
+    :cond_0
+    :goto_0
+    return-void
+
+    :cond_1
     invoke-super {p0, p1}, Landroid/widget/Button;->onDraw(Landroid/graphics/Canvas;)V
 
     iget-object v0, p0, Landroid/widget/CompoundButton;->mButtonDrawable:Landroid/graphics/drawable/Drawable;
@@ -233,7 +247,7 @@
     .local v3, y:I
     sparse-switch v2, :sswitch_data_0
 
-    :goto_0
+    :goto_1
     const/4 v4, 0x0
 
     invoke-virtual {v0}, Landroid/graphics/drawable/Drawable;->getIntrinsicWidth()I
@@ -246,15 +260,8 @@
 
     invoke-virtual {v0, p1}, Landroid/graphics/drawable/Drawable;->draw(Landroid/graphics/Canvas;)V
 
-    .end local v1           #height:I
-    .end local v2           #verticalGravity:I
-    .end local v3           #y:I
-    :cond_0
-    return-void
+    goto :goto_0
 
-    .restart local v1       #height:I
-    .restart local v2       #verticalGravity:I
-    .restart local v3       #y:I
     :sswitch_0
     invoke-virtual {p0}, Landroid/widget/CompoundButton;->getHeight()I
 
@@ -262,7 +269,7 @@
 
     sub-int v3, v4, v1
 
-    goto :goto_0
+    goto :goto_1
 
     :sswitch_1
     invoke-virtual {p0}, Landroid/widget/CompoundButton;->getHeight()I
@@ -273,7 +280,9 @@
 
     div-int/lit8 v3, v4, 0x2
 
-    goto :goto_0
+    goto :goto_1
+
+    nop
 
     :sswitch_data_0
     .sparse-switch
@@ -282,6 +291,144 @@
     .end sparse-switch
 .end method
 
+.method onDrawMiui(Landroid/graphics/Canvas;)Z
+    .locals 6
+    .parameter "canvas"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/widget/CompoundButton;->mButtonDrawable:Landroid/graphics/drawable/Drawable;
+
+    .local v0, buttonDrawable:Landroid/graphics/drawable/Drawable;
+    if-eqz v0, :cond_0
+
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getContext()Landroid/content/Context;
+
+    move-result-object v4
+
+    invoke-static {v4}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v4
+
+    if-nez v4, :cond_1
+
+    :cond_0
+    const/4 v4, 0x0
+
+    :goto_0
+    return v4
+
+    :cond_1
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getPaddingLeft()I
+
+    move-result v2
+
+    .local v2, x:I
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getPaddingTop()I
+
+    move-result v3
+
+    .local v3, y:I
+    invoke-virtual {v0}, Landroid/graphics/drawable/Drawable;->getIntrinsicHeight()I
+
+    move-result v1
+
+    .local v1, height:I
+    invoke-virtual {v0}, Landroid/graphics/drawable/Drawable;->getCurrent()Landroid/graphics/drawable/Drawable;
+
+    move-result-object v4
+
+    instance-of v4, v4, Landroid/graphics/drawable/NinePatchDrawable;
+
+    if-eqz v4, :cond_2
+
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getHeight()I
+
+    move-result v4
+
+    sub-int/2addr v4, v3
+
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getPaddingBottom()I
+
+    move-result v5
+
+    sub-int v1, v4, v5
+
+    :goto_1
+    invoke-virtual {v0}, Landroid/graphics/drawable/Drawable;->getIntrinsicWidth()I
+
+    move-result v4
+
+    add-int/2addr v4, v2
+
+    add-int v5, v3, v1
+
+    invoke-virtual {v0, v2, v3, v4, v5}, Landroid/graphics/drawable/Drawable;->setBounds(IIII)V
+
+    invoke-virtual {v0, p1}, Landroid/graphics/drawable/Drawable;->draw(Landroid/graphics/Canvas;)V
+
+    invoke-virtual {p1}, Landroid/graphics/Canvas;->save()I
+
+    invoke-virtual {v0}, Landroid/graphics/drawable/Drawable;->getIntrinsicWidth()I
+
+    move-result v4
+
+    int-to-float v4, v4
+
+    const/4 v5, 0x0
+
+    invoke-virtual {p1, v4, v5}, Landroid/graphics/Canvas;->translate(FF)V
+
+    invoke-super {p0, p1}, Landroid/widget/Button;->onDraw(Landroid/graphics/Canvas;)V
+
+    invoke-virtual {p1}, Landroid/graphics/Canvas;->restore()V
+
+    const/4 v4, 0x1
+
+    goto :goto_0
+
+    :cond_2
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getGravity()I
+
+    move-result v4
+
+    and-int/lit8 v4, v4, 0x70
+
+    sparse-switch v4, :sswitch_data_0
+
+    goto :goto_1
+
+    :sswitch_0
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getHeight()I
+
+    move-result v4
+
+    sub-int/2addr v4, v1
+
+    div-int/lit8 v3, v4, 0x2
+
+    goto :goto_1
+
+    :sswitch_1
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getHeight()I
+
+    move-result v4
+
+    sub-int v3, v4, v1
+
+    goto :goto_1
+
+    nop
+
+    :sswitch_data_0
+    .sparse-switch
+        0x10 -> :sswitch_0
+        0x50 -> :sswitch_1
+    .end sparse-switch
+.end method
+
 .method public onInitializeAccessibilityEvent(Landroid/view/accessibility/AccessibilityEvent;)V
     .locals 1
     .parameter "event"
@@ -330,6 +477,70 @@
     return-void
 .end method
 
+.method protected onMeasure(II)V
+    .locals 5
+    .parameter "widthMeasureSpec"
+    .parameter "heightMeasureSpec"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-super {p0, p1, p2}, Landroid/widget/Button;->onMeasure(II)V
+
+    iget-object v0, p0, Landroid/widget/CompoundButton;->mButtonDrawable:Landroid/graphics/drawable/Drawable;
+
+    .local v0, buttonDrawable:Landroid/graphics/drawable/Drawable;
+    if-eqz v0, :cond_0
+
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getContext()Landroid/content/Context;
+
+    move-result-object v4
+
+    invoke-static {v4}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v4
+
+    if-nez v4, :cond_1
+
+    :cond_0
+    :goto_0
+    return-void
+
+    :cond_1
+    invoke-static {p1}, Landroid/view/View$MeasureSpec;->getMode(I)I
+
+    move-result v2
+
+    .local v2, widthMode:I
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getMeasuredWidth()I
+
+    move-result v3
+
+    .local v3, widthSize:I
+    move v1, v3
+
+    .local v1, width:I
+    const/high16 v4, 0x4000
+
+    if-eq v2, v4, :cond_2
+
+    invoke-virtual {v0}, Landroid/graphics/drawable/Drawable;->getIntrinsicWidth()I
+
+    move-result v4
+
+    add-int v1, v3, v4
+
+    :cond_2
+    invoke-virtual {p0}, Landroid/widget/CompoundButton;->getMeasuredHeight()I
+
+    move-result v4
+
+    invoke-virtual {p0, v1, v4}, Landroid/widget/CompoundButton;->setMeasuredDimension(II)V
+
+    goto :goto_0
+.end method
+
 .method public onRestoreInstanceState(Landroid/os/Parcelable;)V
     .locals 2
     .parameter "state"
--- a/framework2.jar.out/smali/android/widget/DatePicker.smali
+++ b/framework2.jar.out/smali/android/widget/DatePicker.smali
@@ -70,6 +70,12 @@
 
 .field private mIsEnabled:Z
 
+.field private mLayoutResId:I
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mMaxDate:Ljava/util/Calendar;
 
 .field private mMinDate:Ljava/util/Calendar;
@@ -270,16 +276,6 @@
 
     iput-object v0, v1, Landroid/widget/DatePicker;->mEditorActionListener:Landroid/widget/TextView$OnEditorActionListener;
 
-    invoke-static {}, Ljava/util/Locale;->getDefault()Ljava/util/Locale;
-
-    move-result-object v17
-
-    move-object/from16 v0, p0
-
-    move-object/from16 v1, v17
-
-    invoke-direct {v0, v1}, Landroid/widget/DatePicker;->setCurrentLocale(Ljava/util/Locale;)V
-
     sget-object v17, Lcom/android/internal/R$styleable;->DatePicker:[I
 
     const/16 v18, 0x0
@@ -384,6 +380,20 @@
     .local v11, layoutResourceId:I
     invoke-virtual {v6}, Landroid/content/res/TypedArray;->recycle()V
 
+    move-object/from16 v0, p0
+
+    iput v11, v0, Landroid/widget/DatePicker;->mLayoutResId:I
+
+    invoke-static {}, Ljava/util/Locale;->getDefault()Ljava/util/Locale;
+
+    move-result-object v17
+
+    move-object/from16 v0, p0
+
+    move-object/from16 v1, v17
+
+    invoke-direct {v0, v1}, Landroid/widget/DatePicker;->setCurrentLocale(Ljava/util/Locale;)V
+
     const-string v17, "layout_inflater"
 
     move-object/from16 v0, p1
@@ -1750,6 +1760,10 @@
     throw v4
 
     :sswitch_0
+    iget-object v4, p0, Landroid/widget/DatePicker;->mDaySpinner:Landroid/widget/NumberPicker;
+
+    invoke-direct {p0, v4, v1, v3}, Landroid/widget/DatePicker;->setPosState(Landroid/widget/NumberPicker;II)V
+
     iget-object v4, p0, Landroid/widget/DatePicker;->mSpinners:Landroid/widget/LinearLayout;
 
     iget-object v5, p0, Landroid/widget/DatePicker;->mDaySpinner:Landroid/widget/NumberPicker;
@@ -1766,6 +1780,11 @@
     goto :goto_0
 
     :sswitch_1
+
+    iget-object v4, p0, Landroid/widget/DatePicker;->mMonthSpinner:Landroid/widget/NumberPicker;
+
+    invoke-direct {p0, v4, v1, v3}, Landroid/widget/DatePicker;->setPosState(Landroid/widget/NumberPicker;II)V
+
     iget-object v4, p0, Landroid/widget/DatePicker;->mSpinners:Landroid/widget/LinearLayout;
 
     iget-object v5, p0, Landroid/widget/DatePicker;->mMonthSpinner:Landroid/widget/NumberPicker;
@@ -1779,6 +1798,10 @@
     goto :goto_1
 
     :sswitch_2
+    iget-object v4, p0, Landroid/widget/DatePicker;->mYearSpinner:Landroid/widget/NumberPicker;
+
+    invoke-direct {p0, v4, v1, v3}, Landroid/widget/DatePicker;->setPosState(Landroid/widget/NumberPicker;II)V
+
     iget-object v4, p0, Landroid/widget/DatePicker;->mSpinners:Landroid/widget/LinearLayout;
 
     iget-object v5, p0, Landroid/widget/DatePicker;->mYearSpinner:Landroid/widget/NumberPicker;
@@ -1835,6 +1858,66 @@
     .end sparse-switch
 .end method
 
+.method private resetShortMonths()V
+    .locals 3
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v1, p0, Landroid/widget/DatePicker;->mCurrentLocale:Ljava/util/Locale;
+
+    invoke-virtual {v1}, Ljava/util/Locale;->getCountry()Ljava/lang/String;
+
+    move-result-object v1
+
+    invoke-virtual {v1}, Ljava/lang/String;->toUpperCase()Ljava/lang/String;
+
+    move-result-object v1
+
+    const-string v2, "CN"
+
+    invoke-virtual {v1, v2}, Ljava/lang/String;->equals(Ljava/lang/Object;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_0
+
+    iget v1, p0, Landroid/widget/DatePicker;->mLayoutResId:I
+
+    const v2, 0x6030024
+
+    if-ne v1, v2, :cond_0
+
+    const/4 v0, 0x0
+
+    .local v0, i:I
+    :goto_0
+    iget-object v1, p0, Landroid/widget/DatePicker;->mShortMonths:[Ljava/lang/String;
+
+    array-length v1, v1
+
+    if-ge v0, v1, :cond_0
+
+    iget-object v1, p0, Landroid/widget/DatePicker;->mShortMonths:[Ljava/lang/String;
+
+    add-int/lit8 v2, v0, 0x1
+
+    invoke-static {v2}, Ljava/lang/String;->valueOf(I)Ljava/lang/String;
+
+    move-result-object v2
+
+    aput-object v2, v1, v0
+
+    add-int/lit8 v0, v0, 0x1
+
+    goto :goto_0
+
+    .end local v0           #i:I
+    :cond_0
+    return-void
+.end method
+
 .method private setContentDescriptions()V
     .locals 4
 
@@ -1885,6 +1968,9 @@
 .method private setCurrentLocale(Ljava/util/Locale;)V
     .locals 4
     .parameter "locale"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v1, p0, Landroid/widget/DatePicker;->mCurrentLocale:Ljava/util/Locale;
@@ -1893,12 +1979,12 @@
 
     move-result v1
 
-    if-eqz v1, :cond_1
+    if-eqz v1, :cond_0
 
-    :cond_0
+    :goto_0
     return-void
 
-    :cond_1
+    :cond_0
     iput-object p1, p0, Landroid/widget/DatePicker;->mCurrentLocale:Ljava/util/Locale;
 
     iget-object v1, p0, Landroid/widget/DatePicker;->mTempDate:Ljava/util/Calendar;
@@ -1954,10 +2040,10 @@
     const/4 v0, 0x0
 
     .local v0, i:I
-    :goto_0
+    :goto_1
     iget v1, p0, Landroid/widget/DatePicker;->mNumberOfMonths:I
 
-    if-ge v0, v1, :cond_0
+    if-ge v0, v1, :cond_1
 
     iget-object v1, p0, Landroid/widget/DatePicker;->mShortMonths:[Ljava/lang/String;
 
@@ -1973,6 +2059,11 @@
 
     add-int/lit8 v0, v0, 0x1
 
+    goto :goto_1
+
+    :cond_1
+    invoke-direct {p0}, Landroid/widget/DatePicker;->resetShortMonths()V
+
     goto :goto_0
 .end method
 
@@ -3719,3 +3810,51 @@
 
     goto :goto_0
 .end method
+
+.method private setPosState(Landroid/widget/NumberPicker;II)V
+    .locals 2
+    .parameter "v"
+    .parameter "pos"
+    .parameter "count"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    instance-of v1, p1, Lmiui/widget/NumberPicker;
+
+    if-eqz v1, :cond_0
+
+    if-nez p2, :cond_1
+
+    const/4 v0, 0x0
+
+    .local v0, state:I
+    :goto_0
+    check-cast p1, Lmiui/widget/NumberPicker;
+
+    .end local p1
+    invoke-virtual {p1, v0}, Lmiui/widget/NumberPicker;->setPositionState(I)V
+
+    .end local v0           #state:I
+    :cond_0
+    return-void
+
+    .restart local p1
+    :cond_1
+    add-int/lit8 v1, p3, -0x1
+
+    if-ne p2, v1, :cond_2
+
+    const/4 v0, 0x1
+
+    .restart local v0       #state:I
+    goto :goto_0
+
+    .end local v0           #state:I
+    :cond_2
+    const/4 v0, 0x3
+
+    .restart local v0       #state:I
+    goto :goto_0
+.end method
--- a/framework2.jar.out/smali/android/widget/EdgeEffect.smali
+++ b/framework2.jar.out/smali/android/widget/EdgeEffect.smali
@@ -3,6 +3,14 @@
 .source "EdgeEffect.java"
 
 
+# annotations
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Landroid/widget/EdgeEffect$Injector;
+    }
+.end annotation
+
+
 # static fields
 .field private static final EPSILON:F = 0.0010f
 
@@ -140,6 +148,8 @@
 
     invoke-virtual {v0, v1}, Landroid/content/res/Resources;->getDrawable(I)Landroid/graphics/drawable/Drawable;
 
+    invoke-static {p1}, Landroid/widget/EdgeEffect$Injector;->getOverScrollEdge(Landroid/content/Context;)Landroid/graphics/drawable/Drawable;
+
     move-result-object v1
 
     iput-object v1, p0, Landroid/widget/EdgeEffect;->mEdge:Landroid/graphics/drawable/Drawable;
@@ -148,6 +158,8 @@
 
     invoke-virtual {v0, v1}, Landroid/content/res/Resources;->getDrawable(I)Landroid/graphics/drawable/Drawable;
 
+    invoke-static {p1}, Landroid/widget/EdgeEffect$Injector;->getOverScrollGlow(Landroid/content/Context;)Landroid/graphics/drawable/Drawable;
+
     move-result-object v1
 
     iput-object v1, p0, Landroid/widget/EdgeEffect;->mGlow:Landroid/graphics/drawable/Drawable;
--- a/framework2.jar.out/smali/android/widget/Editor.smali
+++ b/framework2.jar.out/smali/android/widget/Editor.smali
@@ -7189,6 +7189,9 @@
 
 .method protected stopSelectionActionMode()V
     .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v0, p0, Landroid/widget/Editor;->mSelectionActionMode:Landroid/view/ActionMode;
@@ -7200,6 +7203,8 @@
     invoke-virtual {v0}, Landroid/view/ActionMode;->finish()V
 
     :cond_0
+    #invoke-virtual {p0}, Landroid/widget/Editor;->stopTextSelectionMode()V
+
     return-void
 .end method
 
--- a/framework2.jar.out/smali/android/widget/NumberPicker.smali
+++ b/framework2.jar.out/smali/android/widget/NumberPicker.smali
@@ -31,10 +31,6 @@
 
 .field private static final SELECTOR_MAX_FLING_VELOCITY_ADJUSTMENT:I = 0x8
 
-.field private static final SELECTOR_MIDDLE_ITEM_INDEX:I = 0x1
-
-.field private static final SELECTOR_WHEEL_ITEM_COUNT:I = 0x3
-
 .field private static final SIZE_UNSPECIFIED:I = -0x1
 
 .field private static final SNAP_SCROLL_DURATION:I = 0x12c
@@ -53,6 +49,18 @@
 
 
 # instance fields
+.field private SELECTOR_MIDDLE_ITEM_INDEX:I
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
+.field private SELECTOR_WHEEL_ITEM_COUNT:I
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mAccessibilityNodeProvider:Landroid/widget/NumberPicker$AccessibilityNodeProviderImpl;
 
 .field private final mAdjustScroller:Landroid/widget/Scroller;
@@ -99,7 +107,11 @@
 
 .field private mLongPressUpdateInterval:J
 
-.field private final mMaxHeight:I
+.field private mMaxHeight:I
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
 
 .field private mMaxValue:I
 
@@ -115,6 +127,12 @@
 
 .field private mMinimumFlingVelocity:I
 
+.field private mNeedSoftInput:Z
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mOnScrollListener:Landroid/widget/NumberPicker$OnScrollListener;
 
 .field private mOnValueChangeListener:Landroid/widget/NumberPicker$OnValueChangeListener;
@@ -129,7 +147,11 @@
 
 .field private final mSelectionDividerHeight:I
 
-.field private final mSelectionDividersDistance:I
+.field private mSelectionDividersDistance:I
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
 
 .field private mSelectorElementHeight:I
 
@@ -144,7 +166,11 @@
     .end annotation
 .end field
 
-.field private final mSelectorIndices:[I
+.field private mSelectorIndices:[I
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
 
 .field private mSelectorTextGapHeight:I
 
@@ -243,6 +269,28 @@
     .prologue
     invoke-direct/range {p0 .. p3}, Landroid/widget/LinearLayout;-><init>(Landroid/content/Context;Landroid/util/AttributeSet;I)V
 
+    const/4 v14, 0x3
+
+    move-object/from16 v0, p0
+
+    iput v14, v0, Landroid/widget/NumberPicker;->SELECTOR_WHEEL_ITEM_COUNT:I
+
+    move-object/from16 v0, p0
+
+    iget v14, v0, Landroid/widget/NumberPicker;->SELECTOR_WHEEL_ITEM_COUNT:I
+
+    div-int/lit8 v14, v14, 0x2
+
+    move-object/from16 v0, p0
+
+    iput v14, v0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    const/4 v14, 0x1
+
+    move-object/from16 v0, p0
+
+    iput-boolean v14, v0, Landroid/widget/NumberPicker;->mNeedSoftInput:Z
+
     const-wide/16 v14, 0x12c
 
     move-object/from16 v0, p0
@@ -257,7 +305,9 @@
 
     iput-object v14, v0, Landroid/widget/NumberPicker;->mSelectorIndexToStringCache:Landroid/util/SparseArray;
 
-    const/4 v14, 0x3
+    move-object/from16 v0, p0
+
+    iget v14, v0, Landroid/widget/NumberPicker;->SELECTOR_WHEEL_ITEM_COUNT:I
 
     new-array v14, v14, [I
 
@@ -2309,7 +2359,9 @@
     .local v0, editTextTextPosition:I
     iget v5, p0, Landroid/widget/NumberPicker;->mSelectorElementHeight:I
 
-    mul-int/lit8 v5, v5, 0x1
+    iget v6, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    mul-int/2addr v5, v6
 
     sub-int v5, v0, v5
 
@@ -2350,7 +2402,9 @@
 
     if-ge v1, v4, :cond_1
 
-    add-int/lit8 v4, v1, -0x1
+    iget v4, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    sub-int v4, v1, v4
 
     add-int v2, v0, v4
 
@@ -2891,26 +2945,38 @@
 
 .method private showSoftInput()V
     .locals 3
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v2, 0x0
 
+    iget-boolean v1, p0, Landroid/widget/NumberPicker;->mNeedSoftInput:Z
+
+    if-nez v1, :cond_1
+
+    :cond_0
+    :goto_0
+    return-void
+
+    :cond_1
     invoke-static {}, Landroid/view/inputmethod/InputMethodManager;->peekInstance()Landroid/view/inputmethod/InputMethodManager;
 
     move-result-object v0
 
     .local v0, inputMethodManager:Landroid/view/inputmethod/InputMethodManager;
-    if-eqz v0, :cond_1
+    if-eqz v0, :cond_0
 
     iget-boolean v1, p0, Landroid/widget/NumberPicker;->mHasSelectorWheel:Z
 
-    if-eqz v1, :cond_0
+    if-eqz v1, :cond_2
 
     iget-object v1, p0, Landroid/widget/NumberPicker;->mInputText:Landroid/widget/EditText;
 
     invoke-virtual {v1, v2}, Landroid/widget/EditText;->setVisibility(I)V
 
-    :cond_0
+    :cond_2
     iget-object v1, p0, Landroid/widget/NumberPicker;->mInputText:Landroid/widget/EditText;
 
     invoke-virtual {v1}, Landroid/widget/EditText;->requestFocus()Z
@@ -2919,8 +2985,7 @@
 
     invoke-virtual {v0, v1, v2}, Landroid/view/inputmethod/InputMethodManager;->showSoftInput(Landroid/view/View;I)Z
 
-    :cond_1
-    return-void
+    goto :goto_0
 .end method
 
 .method private tryComputeMaxWidth()V
@@ -3627,6 +3692,42 @@
     return-object v0
 .end method
 
+.method protected getEditText()Landroid/widget/EditText;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/widget/NumberPicker;->mInputText:Landroid/widget/EditText;
+
+    return-object v0
+.end method
+
+.method protected getIncrementVirtualButtonPressed()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-boolean v0, p0, Landroid/widget/NumberPicker;->mIncrementVirtualButtonPressed:Z
+
+    return v0
+.end method
+
+.method protected getInitialScrollOffset()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mInitialScrollOffset:I
+
+    return v0
+.end method
+
 .method public getMaxValue()I
     .locals 1
 
@@ -3645,6 +3746,88 @@
     return v0
 .end method
 
+.method protected getMinWidth()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mMinWidth:I
+
+    return v0
+.end method
+
+.method protected getScrollState()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mScrollState:I
+
+    return v0
+.end method
+
+.method protected getSelectorElementHeight()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mSelectorElementHeight:I
+
+    return v0
+.end method
+
+.method protected getSelectorIndexToStringCache()Landroid/util/SparseArray;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "()",
+            "Landroid/util/SparseArray",
+            "<",
+            "Ljava/lang/String;",
+            ">;"
+        }
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/widget/NumberPicker;->mSelectorIndexToStringCache:Landroid/util/SparseArray;
+
+    return-object v0
+.end method
+
+.method protected getSelectorIndices()[I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/widget/NumberPicker;->mSelectorIndices:[I
+
+    return-object v0
+.end method
+
+.method protected getSelectorWheelPaint()Landroid/graphics/Paint;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/widget/NumberPicker;->mSelectorWheelPaint:Landroid/graphics/Paint;
+
+    return-object v0
+.end method
+
 .method public getSolidColor()I
     .locals 1
 
@@ -3654,6 +3837,18 @@
     return v0
 .end method
 
+.method protected getTextSize()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mTextSize:I
+
+    return v0
+.end method
+
 .method protected getTopFadingEdgeStrength()F
     .locals 1
 
@@ -3663,6 +3858,18 @@
     return v0
 .end method
 
+.method protected getTopSelectionDividerTop()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mTopSelectionDividerTop:I
+
+    return v0
+.end method
+
 .method public getValue()I
     .locals 1
 
@@ -3672,6 +3879,18 @@
     return v0
 .end method
 
+.method protected getVirtualButtonPressedDrawable()Landroid/graphics/drawable/Drawable;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/widget/NumberPicker;->mVirtualButtonPressedDrawable:Landroid/graphics/drawable/Drawable;
+
+    return-object v0
+.end method
+
 .method public getWrapSelectorWheel()Z
     .locals 1
 
@@ -3681,6 +3900,18 @@
     return v0
 .end method
 
+.method protected hasSelectorWheel()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-boolean v0, p0, Landroid/widget/NumberPicker;->mHasSelectorWheel:Z
+
+    return v0
+.end method
+
 .method protected onDetachedFromWindow()V
     .locals 0
 
@@ -3853,7 +4084,9 @@
     check-cast v4, Ljava/lang/String;
 
     .local v4, scrollSelectorValue:Ljava/lang/String;
-    const/4 v11, 0x1
+    move-object/from16 v0, p0
+
+    iget v11, v0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
 
     if-ne v3, v11, :cond_4
 
@@ -4617,7 +4850,9 @@
 
     div-int v10, v6, v10
 
-    add-int/lit8 v8, v10, -0x1
+    iget v11, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    sub-int v8, v10, v11
 
     .local v8, selectorIndexOffset:I
     if-lez v8, :cond_9
@@ -4664,6 +4899,54 @@
     .end packed-switch
 .end method
 
+.method protected reInitiate(IIIZ)V
+    .locals 1
+    .parameter "selectorWheelItemCount"
+    .parameter "maxHeight"
+    .parameter "selectionDividersDistance"
+    .parameter "needSoftInput"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput p1, p0, Landroid/widget/NumberPicker;->SELECTOR_WHEEL_ITEM_COUNT:I
+
+    iget v0, p0, Landroid/widget/NumberPicker;->SELECTOR_WHEEL_ITEM_COUNT:I
+
+    div-int/lit8 v0, v0, 0x2
+
+    iput v0, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    iget v0, p0, Landroid/widget/NumberPicker;->SELECTOR_WHEEL_ITEM_COUNT:I
+
+    new-array v0, v0, [I
+
+    iput-object v0, p0, Landroid/widget/NumberPicker;->mSelectorIndices:[I
+
+    iput p2, p0, Landroid/widget/NumberPicker;->mMaxHeight:I
+
+    iput p3, p0, Landroid/widget/NumberPicker;->mSelectionDividersDistance:I
+
+    iput-boolean p4, p0, Landroid/widget/NumberPicker;->mNeedSoftInput:Z
+
+    return-void
+.end method
+
+.method protected remeasureMaxWidth()V
+    .locals 0
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-direct {p0}, Landroid/widget/NumberPicker;->tryComputeMaxWidth()V
+
+    invoke-virtual {p0}, Landroid/widget/NumberPicker;->invalidate()V
+
+    return-void
+.end method
+
 .method public scrollBy(II)V
     .locals 4
     .parameter "x"
@@ -4681,7 +4964,9 @@
 
     if-lez p2, :cond_1
 
-    aget v1, v0, v3
+    iget v1, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    aget v1, v0, v1
 
     iget v2, p0, Landroid/widget/NumberPicker;->mMinValue:I
 
@@ -4702,7 +4987,9 @@
 
     if-gez p2, :cond_2
 
-    aget v1, v0, v3
+    iget v1, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    aget v1, v0, v1
 
     iget v2, p0, Landroid/widget/NumberPicker;->mMaxValue:I
 
@@ -4743,7 +5030,9 @@
 
     invoke-direct {p0, v0}, Landroid/widget/NumberPicker;->decrementSelectorIndices([I)V
 
-    aget v1, v0, v3
+    iget v1, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    aget v1, v0, v1
 
     invoke-direct {p0, v1, v3}, Landroid/widget/NumberPicker;->setValueInternal(IZ)V
 
@@ -4751,7 +5040,9 @@
 
     if-nez v1, :cond_3
 
-    aget v1, v0, v3
+    iget v1, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    aget v1, v0, v1
 
     iget v2, p0, Landroid/widget/NumberPicker;->mMinValue:I
 
@@ -4787,7 +5078,9 @@
 
     invoke-direct {p0, v0}, Landroid/widget/NumberPicker;->incrementSelectorIndices([I)V
 
-    aget v1, v0, v3
+    iget v1, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    aget v1, v0, v1
 
     invoke-direct {p0, v1, v3}, Landroid/widget/NumberPicker;->setValueInternal(IZ)V
 
@@ -4795,7 +5088,9 @@
 
     if-nez v1, :cond_4
 
-    aget v1, v0, v3
+    iget v1, p0, Landroid/widget/NumberPicker;->SELECTOR_MIDDLE_ITEM_INDEX:I
+
+    aget v1, v0, v1
 
     iget v2, p0, Landroid/widget/NumberPicker;->mMaxValue:I
 
@@ -5222,3 +5517,39 @@
 
     return-void
 .end method
+
+.method protected getBottomSelectionDividerBottom()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mBottomSelectionDividerBottom:I
+
+    return v0
+.end method
+
+.method protected getCurrentScrollOffset()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Landroid/widget/NumberPicker;->mCurrentScrollOffset:I
+
+    return v0
+.end method
+
+.method protected getDecrementVirtualBUttonPressed()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-boolean v0, p0, Landroid/widget/NumberPicker;->mDecrementVirtualButtonPressed:Z
+
+    return v0
+.end method
--- a/framework2.jar.out/smali/android/widget/PopupWindow.smali
+++ b/framework2.jar.out/smali/android/widget/PopupWindow.smali
@@ -7,7 +7,8 @@
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
         Landroid/widget/PopupWindow$PopupViewContainer;,
-        Landroid/widget/PopupWindow$OnDismissListener;
+        Landroid/widget/PopupWindow$OnDismissListener;,
+        Landroid/widget/PopupWindow$Injector;
     }
 .end annotation
 
@@ -2476,8 +2477,11 @@
 .end method
 
 .method private preparePopup(Landroid/view/WindowManager$LayoutParams;)V
-    .locals 6
+    .locals 9
     .parameter "p"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v4, p0, Landroid/widget/PopupWindow;->mContentView:Landroid/view/View;
@@ -2541,16 +2545,24 @@
     invoke-direct {v2, v4, v0}, Landroid/widget/FrameLayout$LayoutParams;-><init>(II)V
 
     .local v2, listParams:Landroid/widget/FrameLayout$LayoutParams;
-    iget-object v4, p0, Landroid/widget/PopupWindow;->mBackground:Landroid/graphics/drawable/Drawable;
-
-    invoke-virtual {v3, v4}, Landroid/widget/PopupWindow$PopupViewContainer;->setBackgroundDrawable(Landroid/graphics/drawable/Drawable;)V
-
     iget-object v4, p0, Landroid/widget/PopupWindow;->mContentView:Landroid/view/View;
 
     invoke-virtual {v3, v4, v2}, Landroid/widget/PopupWindow$PopupViewContainer;->addView(Landroid/view/View;Landroid/view/ViewGroup$LayoutParams;)V
 
     iput-object v3, p0, Landroid/widget/PopupWindow;->mPopupView:Landroid/view/View;
 
+    iget-object v4, p0, Landroid/widget/PopupWindow;->mPopupView:Landroid/view/View;
+
+    iget-boolean v5, p0, Landroid/widget/PopupWindow;->mAboveAnchor:Z
+
+    iget-object v6, p0, Landroid/widget/PopupWindow;->mBackground:Landroid/graphics/drawable/Drawable;
+
+    iget-object v7, p0, Landroid/widget/PopupWindow;->mAboveAnchorBackgroundDrawable:Landroid/graphics/drawable/Drawable;
+
+    iget-object v8, p0, Landroid/widget/PopupWindow;->mBelowAnchorBackgroundDrawable:Landroid/graphics/drawable/Drawable;
+
+    invoke-static {v4, v5, v6, v7, v8}, Landroid/widget/PopupWindow$Injector;->updateBackground(Landroid/view/View;ZLandroid/graphics/drawable/Drawable;Landroid/graphics/drawable/Drawable;Landroid/graphics/drawable/Drawable;)V
+
     .end local v0           #height:I
     .end local v1           #layoutParams:Landroid/view/ViewGroup$LayoutParams;
     .end local v2           #listParams:Landroid/widget/FrameLayout$LayoutParams;
@@ -3401,10 +3413,19 @@
 .end method
 
 .method public getBackground()Landroid/graphics/drawable/Drawable;
-    .locals 1
+    .locals 2
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
-    iget-object v0, p0, Landroid/widget/PopupWindow;->mBackground:Landroid/graphics/drawable/Drawable;
+    iget-object v0, p0, Landroid/widget/PopupWindow;->mPopupView:Landroid/view/View;
+
+    iget-object v1, p0, Landroid/widget/PopupWindow;->mBackground:Landroid/graphics/drawable/Drawable;
+
+    invoke-static {v0, v1}, Landroid/widget/PopupWindow$Injector;->getBackground(Landroid/view/View;Landroid/graphics/drawable/Drawable;)Landroid/graphics/drawable/Drawable;
+
+    move-result-object v0
 
     return-object v0
 .end method
--- a/framework2.jar.out/smali/android/widget/QuickContactBadge.smali
+++ b/framework2.jar.out/smali/android/widget/QuickContactBadge.smali
@@ -512,6 +512,10 @@
 
     move-result v2
 
+    iget v3, p0, Landroid/widget/QuickContactBadge;->mPaddingLeft:I
+
+    sub-int/2addr v2, v3
+
     iget v3, p0, Landroid/widget/QuickContactBadge;->mPaddingRight:I
 
     sub-int/2addr v2, v3
@@ -520,6 +524,10 @@
 
     move-result v3
 
+    iget v4, p0, Landroid/widget/QuickContactBadge;->mPaddingTop:I
+
+    sub-int/2addr v3, v4
+
     iget v4, p0, Landroid/widget/QuickContactBadge;->mPaddingBottom:I
 
     sub-int/2addr v3, v4
--- a/framework2.jar.out/smali/android/widget/TimePicker.smali
+++ b/framework2.jar.out/smali/android/widget/TimePicker.smali
@@ -716,6 +716,40 @@
     return-object v0
 .end method
 
+.method private changePositionState(Z)V
+    .locals 2
+    .parameter "is24HourView"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Landroid/widget/TimePicker;->mMinuteSpinner:Landroid/widget/NumberPicker;
+
+    instance-of v0, v0, Lmiui/widget/NumberPicker;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Landroid/widget/TimePicker;->mMinuteSpinner:Landroid/widget/NumberPicker;
+
+    check-cast v0, Lmiui/widget/NumberPicker;
+
+    if-eqz p1, :cond_1
+
+    const/4 v1, 0x1
+
+    :goto_0
+    invoke-virtual {v0, v1}, Lmiui/widget/NumberPicker;->setPositionState(I)V
+
+    :cond_0
+    return-void
+
+    :cond_1
+    const/4 v1, 0x3
+
+    goto :goto_0
+.end method
+
 .method private onTimeChanged()V
     .locals 3
 
@@ -1687,6 +1721,9 @@
 .method public setIs24HourView(Ljava/lang/Boolean;)V
     .locals 3
     .parameter "is24HourView"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-boolean v1, p0, Landroid/widget/TimePicker;->mIs24HourView:Z
@@ -1707,6 +1744,12 @@
 
     iput-boolean v1, p0, Landroid/widget/TimePicker;->mIs24HourView:Z
 
+    invoke-virtual {p1}, Ljava/lang/Boolean;->booleanValue()Z
+
+    move-result v1
+
+    invoke-direct {p0, v1}, Landroid/widget/TimePicker;->changePositionState(Z)V
+
     invoke-virtual {p0}, Landroid/widget/TimePicker;->getCurrentHour()Ljava/lang/Integer;
 
     move-result-object v1
--- a/framework2.jar.out/smali/com/android/internal/view/menu/ListMenuItemView.smali
+++ b/framework2.jar.out/smali/com/android/internal/view/menu/ListMenuItemView.smali
@@ -6,6 +6,14 @@
 .implements Lcom/android/internal/view/menu/MenuView$ItemView;
 
 
+# annotations
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Lcom/android/internal/view/menu/ListMenuItemView$Injector;
+    }
+.end annotation
+
+
 # static fields
 .field private static final TAG:Ljava/lang/String; = "ListMenuItemView"
 
@@ -177,10 +185,20 @@
     iput-object v1, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mCheckBox:Landroid/widget/CheckBox;
 
     :goto_0
+
+    iget-object v1, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mCheckBox:Landroid/widget/CheckBox;
+
+    invoke-static {p0, v1}, Lcom/android/internal/view/menu/ListMenuItemView$Injector;->insertCheckBox(Lcom/android/internal/view/menu/ListMenuItemView;Landroid/widget/CheckBox;)Z
+
+    move-result v1
+
+    if-nez v1, :cond_miui_1
+
     iget-object v1, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mCheckBox:Landroid/widget/CheckBox;
 
     invoke-virtual {p0, v1}, Lcom/android/internal/view/menu/ListMenuItemView;->addView(Landroid/view/View;)V
 
+    :cond_miui_1
     return-void
 
     :cond_0
@@ -253,8 +271,17 @@
     :goto_0
     iget-object v1, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mRadioButton:Landroid/widget/RadioButton;
 
+    invoke-static {p0, v1}, Lcom/android/internal/view/menu/ListMenuItemView$Injector;->insertRadioButton(Lcom/android/internal/view/menu/ListMenuItemView;Landroid/widget/RadioButton;)Z
+
+    move-result v1
+
+    if-nez v1, :cond_miui_1
+
+    iget-object v1, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mRadioButton:Landroid/widget/RadioButton;
+
     invoke-virtual {p0, v1}, Lcom/android/internal/view/menu/ListMenuItemView;->addView(Landroid/view/View;)V
 
+    :cond_miui_1
     return-void
 
     :cond_0
@@ -473,8 +500,11 @@
 .end method
 
 .method public setCheckable(Z)V
-    .locals 5
+    .locals 6
     .parameter "checkable"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/16 v3, 0x8
@@ -526,6 +556,16 @@
 
     invoke-virtual {v0, v4}, Landroid/widget/CompoundButton;->setChecked(Z)V
 
+    iget-object v4, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mTitleView:Landroid/widget/TextView;
+
+    iget-object v5, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mItemData:Lcom/android/internal/view/menu/MenuItemImpl;
+
+    invoke-virtual {v5}, Lcom/android/internal/view/menu/MenuItemImpl;->isChecked()Z
+
+    move-result v5
+
+    invoke-static {v4, v5}, Lcom/android/internal/view/menu/ListMenuItemView$Injector;->checkTextColor(Landroid/widget/TextView;Z)V
+
     if-eqz p1, :cond_6
 
     const/4 v1, 0x0
@@ -601,6 +641,9 @@
 .method public setChecked(Z)V
     .locals 2
     .parameter "checked"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v1, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mItemData:Lcom/android/internal/view/menu/MenuItemImpl;
@@ -624,6 +667,10 @@
     :goto_0
     invoke-virtual {v0, p1}, Landroid/widget/CompoundButton;->setChecked(Z)V
 
+    iget-object v1, p0, Lcom/android/internal/view/menu/ListMenuItemView;->mTitleView:Landroid/widget/TextView;
+
+    invoke-static {v1, p1}, Lcom/android/internal/view/menu/ListMenuItemView$Injector;->checkTextColor(Landroid/widget/TextView;Z)V
+
     return-void
 
     .end local v0           #compoundButton:Landroid/widget/CompoundButton;
--- a/framework2.jar.out/smali/com/android/internal/view/menu/MenuBuilder.smali
+++ b/framework2.jar.out/smali/com/android/internal/view/menu/MenuBuilder.smali
@@ -2475,6 +2475,54 @@
     return v0
 .end method
 
+.method public miuiGetActionItems()Ljava/util/ArrayList;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "()",
+            "Ljava/util/ArrayList",
+            "<",
+            "Lcom/android/internal/view/menu/MenuItemImpl;",
+            ">;"
+        }
+    .end annotation
+
+    .prologue
+    invoke-virtual {p0}, Lcom/android/internal/view/menu/MenuBuilder;->getActionItems()Ljava/util/ArrayList;
+
+    move-result-object v0
+
+    return-object v0
+.end method
+
+.method public miuiGetVisibleItems()Ljava/util/ArrayList;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "()",
+            "Ljava/util/ArrayList",
+            "<",
+            "Lcom/android/internal/view/menu/MenuItemImpl;",
+            ">;"
+        }
+    .end annotation
+
+    .prologue
+    invoke-virtual {p0}, Lcom/android/internal/view/menu/MenuBuilder;->getVisibleItems()Ljava/util/ArrayList;
+
+    move-result-object v0
+
+    return-object v0
+.end method
+
 .method onItemActionRequestChanged(Lcom/android/internal/view/menu/MenuItemImpl;)V
     .locals 1
     .parameter "item"
--- a/framework2.jar.out/smali/com/android/internal/widget/ActionBarContainer.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ActionBarContainer.smali
@@ -150,7 +150,7 @@
     return-object v0
 .end method
 
-.method getActionBarView()Lcom/android/internal/widget/ActionBarView;
+.method protected getActionBarView()Lcom/android/internal/widget/ActionBarView;
     .locals 1
     .annotation build Landroid/annotation/MiuiHook;
         value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
@@ -183,6 +183,18 @@
     return-object v0
 .end method
 
+.method protected isSplit()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-boolean v0, p0, Lcom/android/internal/widget/ActionBarContainer;->mIsSplit:Z
+
+    return v0
+.end method
+
 .method public onDraw(Landroid/graphics/Canvas;)V
     .locals 1
     .parameter "canvas"
@@ -366,7 +378,7 @@
 
     move-result v8
 
-    and-int/lit8 v8, v8, 0x2
+    and-int/lit8 v8, v8, 0xa
 
     if-nez v8, :cond_7
 
--- a/framework2.jar.out/smali/com/android/internal/widget/ActionBarContextView.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ActionBarContextView.smali
@@ -481,6 +481,9 @@
 
 .method private initTitle()V
     .locals 9
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/16 v6, 0x8
@@ -489,9 +492,20 @@
 
     const/4 v5, 0x0
 
+    invoke-virtual {p0}, Lcom/android/internal/widget/ActionBarContextView;->miuiInitTitle()Z
+
+    move-result v3
+
+    if-eqz v3, :cond_1
+
+    :cond_0
+    :goto_0
+    return-void
+
+    :cond_1
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleLayout:Landroid/widget/LinearLayout;
 
-    if-nez v3, :cond_1
+    if-nez v3, :cond_3
 
     invoke-virtual {p0}, Lcom/android/internal/widget/ActionBarContextView;->getContext()Landroid/content/Context;
 
@@ -546,7 +560,7 @@
 
     iget v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleStyleRes:I
 
-    if-eqz v3, :cond_0
+    if-eqz v3, :cond_2
 
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleView:Landroid/widget/TextView;
 
@@ -556,10 +570,10 @@
 
     invoke-virtual {v3, v7, v8}, Landroid/widget/TextView;->setTextAppearance(Landroid/content/Context;I)V
 
-    :cond_0
+    :cond_2
     iget v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mSubtitleStyleRes:I
 
-    if-eqz v3, :cond_1
+    if-eqz v3, :cond_3
 
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mSubtitleView:Landroid/widget/TextView;
 
@@ -570,7 +584,7 @@
     invoke-virtual {v3, v7, v8}, Landroid/widget/TextView;->setTextAppearance(Landroid/content/Context;I)V
 
     .end local v2           #inflater:Landroid/view/LayoutInflater;
-    :cond_1
+    :cond_3
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleView:Landroid/widget/TextView;
 
     iget-object v7, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitle:Ljava/lang/CharSequence;
@@ -589,43 +603,43 @@
 
     move-result v3
 
-    if-nez v3, :cond_5
+    if-nez v3, :cond_6
 
     move v1, v4
 
     .local v1, hasTitle:Z
-    :goto_0
+    :goto_1
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mSubtitle:Ljava/lang/CharSequence;
 
     invoke-static {v3}, Landroid/text/TextUtils;->isEmpty(Ljava/lang/CharSequence;)Z
 
     move-result v3
 
-    if-nez v3, :cond_6
+    if-nez v3, :cond_7
 
     move v0, v4
 
     .local v0, hasSubtitle:Z
-    :goto_1
+    :goto_2
     iget-object v4, p0, Lcom/android/internal/widget/ActionBarContextView;->mSubtitleView:Landroid/widget/TextView;
 
-    if-eqz v0, :cond_7
+    if-eqz v0, :cond_8
 
     move v3, v5
 
-    :goto_2
+    :goto_3
     invoke-virtual {v4, v3}, Landroid/widget/TextView;->setVisibility(I)V
 
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleLayout:Landroid/widget/LinearLayout;
 
-    if-nez v1, :cond_2
+    if-nez v1, :cond_4
 
-    if-eqz v0, :cond_3
+    if-eqz v0, :cond_5
 
-    :cond_2
+    :cond_4
     move v6, v5
 
-    :cond_3
+    :cond_5
     invoke-virtual {v3, v6}, Landroid/widget/LinearLayout;->setVisibility(I)V
 
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleLayout:Landroid/widget/LinearLayout;
@@ -634,33 +648,32 @@
 
     move-result-object v3
 
-    if-nez v3, :cond_4
+    if-nez v3, :cond_0
 
     iget-object v3, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleLayout:Landroid/widget/LinearLayout;
 
     invoke-virtual {p0, v3}, Lcom/android/internal/widget/ActionBarContextView;->addView(Landroid/view/View;)V
 
-    :cond_4
-    return-void
+    goto/16 :goto_0
 
     .end local v0           #hasSubtitle:Z
     .end local v1           #hasTitle:Z
-    :cond_5
+    :cond_6
     move v1, v5
 
-    goto :goto_0
+    goto :goto_1
 
     .restart local v1       #hasTitle:Z
-    :cond_6
+    :cond_7
     move v0, v5
 
-    goto :goto_1
+    goto :goto_2
 
     .restart local v0       #hasSubtitle:Z
-    :cond_7
+    :cond_8
     move v3, v6
 
-    goto :goto_2
+    goto :goto_3
 .end method
 
 .method private makeInAnimation()Landroid/animation/Animator;
@@ -1004,6 +1017,18 @@
     return-object v0
 .end method
 
+.method protected getAnimationMode()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Lcom/android/internal/widget/ActionBarContextView;->mAnimationMode:I
+
+    return v0
+.end method
+
 .method public getSubtitle()Ljava/lang/CharSequence;
     .locals 1
 
@@ -1022,6 +1047,42 @@
     return-object v0
 .end method
 
+.method public getTitleLayout()Landroid/widget/LinearLayout;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleLayout:Landroid/widget/LinearLayout;
+
+    return-object v0
+.end method
+
+.method public getTitleStyleRes()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleStyleRes:I
+
+    return v0
+.end method
+
+.method public getTitleView()Landroid/widget/TextView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleView:Landroid/widget/TextView;
+
+    return-object v0
+.end method
+
 .method public hideOverflowMenu()Z
     .locals 1
 
@@ -1383,6 +1444,18 @@
     return-void
 .end method
 
+.method protected miuiInitTitle()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v0, 0x0
+
+    return v0
+.end method
+
 .method public onAnimationCancel(Landroid/animation/Animator;)V
     .locals 0
     .parameter "animation"
@@ -2405,6 +2478,19 @@
     goto :goto_9
 .end method
 
+.method protected setAnimationMode(I)V
+    .locals 0
+    .parameter "mode"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput p1, p0, Lcom/android/internal/widget/ActionBarContextView;->mAnimationMode:I
+
+    return-void
+.end method
+
 .method public setContentHeight(I)V
     .locals 0
     .parameter "height"
@@ -2622,6 +2708,19 @@
     return-void
 .end method
 
+.method public setTitleLayout(Landroid/widget/LinearLayout;)V
+    .locals 0
+    .parameter "titleLayout"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-object p1, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleLayout:Landroid/widget/LinearLayout;
+
+    return-void
+.end method
+
 .method public setTitleOptional(Z)V
     .locals 1
     .parameter "titleOptional"
@@ -2638,6 +2737,19 @@
 
     return-void
 .end method
+
+.method public setTitleView(Landroid/widget/TextView;)V
+    .locals 0
+    .parameter "titleView"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-object p1, p0, Lcom/android/internal/widget/ActionBarContextView;->mTitleView:Landroid/widget/TextView;
+
+    return-void
+.end method
 
 .method public shouldDelayChildPressedState()Z
     .locals 1
--- a/framework2.jar.out/smali/com/android/internal/widget/ActionBarView$ExpandedActionViewMenuPresenter.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ActionBarView$ExpandedActionViewMenuPresenter.smali
@@ -137,8 +137,8 @@
 
     iget-object v0, p0, Lcom/android/internal/widget/ActionBarView$ExpandedActionViewMenuPresenter;->this$0:Lcom/android/internal/widget/ActionBarView;
 
-    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
-    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/widget/LinearLayout;
+    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/view/ViewGroup;
 
     move-result-object v0
 
@@ -261,12 +261,12 @@
     :cond_6
     iget-object v0, p0, Lcom/android/internal/widget/ActionBarView$ExpandedActionViewMenuPresenter;->this$0:Lcom/android/internal/widget/ActionBarView;
 
-    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
-    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/widget/LinearLayout;
+    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/view/ViewGroup;
 
     move-result-object v0
 
-    invoke-virtual {v0, v2}, Landroid/widget/LinearLayout;->setVisibility(I)V
+    invoke-virtual {v0, v2}, Landroid/view/ViewGroup;->setVisibility(I)V
 
     goto :goto_0
 .end method
@@ -380,8 +380,8 @@
 
     iget-object v0, p0, Lcom/android/internal/widget/ActionBarView$ExpandedActionViewMenuPresenter;->this$0:Lcom/android/internal/widget/ActionBarView;
 
-    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
-    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/widget/LinearLayout;
+    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/view/ViewGroup;
 
     move-result-object v0
 
@@ -389,12 +389,12 @@
 
     iget-object v0, p0, Lcom/android/internal/widget/ActionBarView$ExpandedActionViewMenuPresenter;->this$0:Lcom/android/internal/widget/ActionBarView;
 
-    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
-    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/widget/LinearLayout;
+    #getter for: Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+    invoke-static {v0}, Lcom/android/internal/widget/ActionBarView;->access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/view/ViewGroup;
 
     move-result-object v0
 
-    invoke-virtual {v0, v3}, Landroid/widget/LinearLayout;->setVisibility(I)V
+    invoke-virtual {v0, v3}, Landroid/view/ViewGroup;->setVisibility(I)V
 
     :cond_2
     iget-object v0, p0, Lcom/android/internal/widget/ActionBarView$ExpandedActionViewMenuPresenter;->this$0:Lcom/android/internal/widget/ActionBarView;
--- a/framework2.jar.out/smali/com/android/internal/widget/ActionBarView.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ActionBarView.smali
@@ -75,6 +75,12 @@
 
 .field private mMaxHomeSlop:I
 
+.field mMenuPresenterCallback:Lcom/android/internal/view/menu/MenuPresenter$Callback;
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private final mNavItemSelectedListener:Landroid/widget/AdapterView$OnItemSelectedListener;
 
 .field private mNavigationMode:I
@@ -105,7 +111,11 @@
 
 .field private mTitle:Ljava/lang/CharSequence;
 
-.field private mTitleLayout:Landroid/widget/LinearLayout;
+.field private mTitleLayout:Landroid/view/ViewGroup;
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
 
 .field private mTitleStyleRes:I
 
@@ -824,12 +834,12 @@
     return-object v0
 .end method
 
-.method static synthetic access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/widget/LinearLayout;
+.method static synthetic access$800(Lcom/android/internal/widget/ActionBarView;)Landroid/view/ViewGroup;
     .locals 1
     .parameter "x0"
 
     .prologue
-    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     return-object v0
 .end method
@@ -900,7 +910,11 @@
 
     const/4 v10, 0x0
 
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    invoke-virtual {p0}, Lcom/android/internal/widget/ActionBarView;->miuiInitTitle()Z
+    move-result v8
+    if-nez v8, :cond_7
+
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-nez v8, :cond_5
 
@@ -940,10 +954,10 @@
 
     check-cast v8, Landroid/widget/LinearLayout;
 
-    iput-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     :goto_0
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     const v12, 0x1020260
 
@@ -955,7 +969,7 @@
 
     iput-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleView:Landroid/widget/TextView;
 
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     const v12, 0x1020261
 
@@ -967,7 +981,7 @@
 
     iput-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mSubtitleView:Landroid/widget/TextView;
 
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     const v12, 0x1020255
 
@@ -977,7 +991,7 @@
 
     iput-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleUpView:Landroid/view/View;
 
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     iget-object v12, p0, Lcom/android/internal/widget/ActionBarView;->mUpClickListener:Landroid/view/View$OnClickListener;
 
@@ -1115,7 +1129,7 @@
 
     :cond_4
     :goto_5
-    iget-object v12, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v12, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-eqz v0, :cond_10
 
@@ -1126,7 +1140,7 @@
     :goto_6
     invoke-virtual {v12, v8}, Landroid/widget/LinearLayout;->setEnabled(Z)V
 
-    iget-object v12, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v12, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-eqz v0, :cond_11
 
@@ -1137,7 +1151,7 @@
     :goto_7
     invoke-virtual {v12, v8}, Landroid/widget/LinearLayout;->setClickable(Z)V
 
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-eqz v0, :cond_12
 
@@ -1155,7 +1169,7 @@
     .end local v6           #titleLp:Landroid/view/ViewGroup$MarginLayoutParams;
     .end local v7           #titleUpLp:Landroid/view/ViewGroup$MarginLayoutParams;
     :cond_5
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     invoke-virtual {p0, v8}, Lcom/android/internal/widget/ActionBarView;->addView(Landroid/view/View;)V
 
@@ -1180,7 +1194,7 @@
     if-eqz v8, :cond_7
 
     :cond_6
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     invoke-virtual {v8, v11}, Landroid/widget/LinearLayout;->setVisibility(I)V
 
@@ -1198,7 +1212,7 @@
 
     check-cast v8, Landroid/widget/LinearLayout;
 
-    iput-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     goto/16 :goto_0
 
@@ -1335,12 +1349,12 @@
 
     .local v0, visible:Z
     :goto_0
-    iget-object v2, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v2, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-eqz v0, :cond_4
 
     :goto_1
-    invoke-virtual {v2, v1}, Landroid/widget/LinearLayout;->setVisibility(I)V
+    invoke-virtual {v2, v1}, Landroid/view/ViewGroup;->setVisibility(I)V
 
     .end local v0           #visible:Z
     :cond_1
@@ -1602,6 +1616,18 @@
     return v0
 .end method
 
+.method public getExpandedActionView()Landroid/view/View;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mExpandedActionView:Landroid/view/View;
+
+    return-object v0
+.end method
+
 .method public getNavigationMode()I
     .locals 1
 
@@ -1620,6 +1646,42 @@
     return-object v0
 .end method
 
+.method public getSubtitleStyleRes()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Lcom/android/internal/widget/ActionBarView;->mSubtitleStyleRes:I
+
+    return v0
+.end method
+
+.method public getSubtitleView()Landroid/widget/TextView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mSubtitleView:Landroid/widget/TextView;
+
+    return-object v0
+.end method
+
+.method public getTabScrollView()Lcom/android/internal/widget/ScrollingTabContainerView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mTabScrollView:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    return-object v0
+.end method
+
 .method public getTitle()Ljava/lang/CharSequence;
     .locals 1
 
@@ -1629,6 +1691,54 @@
     return-object v0
 .end method
 
+.method public getTitleLayout()Landroid/view/ViewGroup;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+
+    return-object v0
+.end method
+
+.method public getTitleStyleRes()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Lcom/android/internal/widget/ActionBarView;->mTitleStyleRes:I
+
+    return v0
+.end method
+
+.method public getTitleView()Landroid/widget/TextView;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mTitleView:Landroid/widget/TextView;
+
+    return-object v0
+.end method
+
+.method public getUpClickListener()Landroid/view/View$OnClickListener;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mUpClickListener:Landroid/view/View$OnClickListener;
+
+    return-object v0
+.end method
+
 .method public hasEmbeddedTabs()Z
     .locals 1
 
@@ -1761,6 +1871,22 @@
     return v0
 .end method
 
+.method protected miuiInitTitle()Z
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mContext:Landroid/content/Context;
+
+    invoke-static {v0}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v0
+
+    return v0
+.end method
+
 .method protected onConfigurationChanged(Landroid/content/res/Configuration;)V
     .locals 3
     .parameter "newConfig"
@@ -1776,24 +1902,24 @@
 
     iput-object v2, p0, Lcom/android/internal/widget/ActionBarView;->mTitleUpView:Landroid/view/View;
 
-    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-eqz v1, :cond_0
 
-    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
-    invoke-virtual {v1}, Landroid/widget/LinearLayout;->getParent()Landroid/view/ViewParent;
+    invoke-virtual {v1}, Landroid/view/ViewGroup;->getParent()Landroid/view/ViewParent;
 
     move-result-object v1
 
     if-ne v1, p0, :cond_0
 
-    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     invoke-virtual {p0, v1}, Lcom/android/internal/widget/ActionBarView;->removeView(Landroid/view/View;)V
 
     :cond_0
-    iput-object v2, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iput-object v2, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     iget v1, p0, Lcom/android/internal/widget/ActionBarView;->mDisplayOptions:I
 
@@ -2043,7 +2169,7 @@
 
     move-object/from16 v0, p0
 
-    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     move-object/from16 v30, v0
 
@@ -2051,11 +2177,11 @@
 
     move-object/from16 v0, p0
 
-    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     move-object/from16 v30, v0
 
-    invoke-virtual/range {v30 .. v30}, Landroid/widget/LinearLayout;->getVisibility()I
+    invoke-virtual/range {v30 .. v30}, Landroid/view/ViewGroup;->getVisibility()I
 
     move-result v30
 
@@ -2085,7 +2211,7 @@
 
     move-object/from16 v0, p0
 
-    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     move-object/from16 v30, v0
 
@@ -3441,7 +3567,7 @@
     :cond_9
     move-object/from16 v0, p0
 
-    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     move-object/from16 v40, v0
 
@@ -3449,11 +3575,11 @@
 
     move-object/from16 v0, p0
 
-    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     move-object/from16 v40, v0
 
-    invoke-virtual/range {v40 .. v40}, Landroid/widget/LinearLayout;->getVisibility()I
+    invoke-virtual/range {v40 .. v40}, Landroid/view/ViewGroup;->getVisibility()I
 
     move-result v40
 
@@ -3756,7 +3882,7 @@
 
     move-object/from16 v0, p0
 
-    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     move-object/from16 v40, v0
 
@@ -3790,11 +3916,11 @@
 
     move-object/from16 v0, p0
 
-    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v0, v0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     move-object/from16 v41, v0
 
-    invoke-virtual/range {v41 .. v41}, Landroid/widget/LinearLayout;->getMeasuredWidth()I
+    invoke-virtual/range {v41 .. v41}, Landroid/view/ViewGroup;->getMeasuredWidth()I
 
     move-result v41
 
@@ -4421,6 +4547,52 @@
     return-object v0
 .end method
 
+.method public onWindowHide()V
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mSplitView:Lcom/android/internal/widget/ActionBarContainer;
+
+    instance-of v0, v0, Lcom/miui/internal/v5/widget/ActionBarContainer;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mSplitView:Lcom/android/internal/widget/ActionBarContainer;
+
+    check-cast v0, Lcom/miui/internal/v5/widget/ActionBarContainer;
+
+    invoke-virtual {v0}, Lcom/miui/internal/v5/widget/ActionBarContainer;->onWindowHide()V
+
+    :cond_0
+    return-void
+.end method
+
+.method public onWindowShow()V
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mSplitView:Lcom/android/internal/widget/ActionBarContainer;
+
+    instance-of v0, v0, Lcom/miui/internal/v5/widget/ActionBarContainer;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mSplitView:Lcom/android/internal/widget/ActionBarContainer;
+
+    check-cast v0, Lcom/miui/internal/v5/widget/ActionBarContainer;
+
+    invoke-virtual {v0}, Lcom/miui/internal/v5/widget/ActionBarContainer;->onWindowShow()V
+
+    :cond_0
+    return-void
+.end method
+
 .method public setCallback(Landroid/app/ActionBar$OnNavigationListener;)V
     .locals 0
     .parameter "callback"
@@ -4441,6 +4613,19 @@
     return-void
 .end method
 
+.method protected setCollapsed(Z)V
+    .locals 0
+    .parameter "collapsed"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-boolean p1, p0, Lcom/android/internal/widget/ActionBarView;->mIsCollapsed:Z
+
+    return-void
+.end method
+
 .method public setContextView(Lcom/android/internal/widget/ActionBarContextView;)V
     .locals 0
     .parameter "view"
@@ -4605,7 +4790,7 @@
 
     :cond_2
     :goto_6
-    iget-object v10, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v10, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-eqz v10, :cond_4
 
@@ -4632,8 +4817,10 @@
     const/4 v10, 0x0
 
     :goto_8
+    if-eqz v11, :cond_miui_1
     invoke-virtual {v11, v10}, Landroid/view/View;->setVisibility(I)V
 
+    :cond_miui_1
     new-instance v3, Landroid/util/TypedValue;
 
     invoke-direct {v3}, Landroid/util/TypedValue;-><init>()V
@@ -4703,7 +4890,7 @@
     .end local v8           #titleUpLp:Landroid/view/ViewGroup$MarginLayoutParams;
     :cond_3
     :goto_9
-    iget-object v11, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v11, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-nez v5, :cond_12
 
@@ -4714,7 +4901,7 @@
     :goto_a
     invoke-virtual {v11, v10}, Landroid/widget/LinearLayout;->setEnabled(Z)V
 
-    iget-object v11, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v11, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-nez v5, :cond_13
 
@@ -4725,7 +4912,7 @@
     :goto_b
     invoke-virtual {v11, v10}, Landroid/widget/LinearLayout;->setClickable(Z)V
 
-    iget-object v11, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v11, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-nez v5, :cond_14
 
@@ -4818,7 +5005,7 @@
 
     .end local v2           #logoVis:Z
     :cond_c
-    iget-object v10, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v10, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     invoke-virtual {p0, v10}, Lcom/android/internal/widget/ActionBarView;->removeView(Landroid/view/View;)V
 
@@ -5251,6 +5438,9 @@
     .locals 8
     .parameter "menu"
     .parameter "cb"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v7, -0x1
@@ -5312,11 +5502,11 @@
 
     if-nez v4, :cond_3
 
-    new-instance v4, Lcom/android/internal/view/menu/ActionMenuPresenter;
+    iget-object v4, p0, Lcom/android/internal/widget/ActionBarView;->mContext:Landroid/content/Context;
 
-    iget-object v5, p0, Lcom/android/internal/widget/ActionBarView;->mContext:Landroid/content/Context;
+    invoke-static {v4}, Lcom/android/internal/widget/ActionBarView$Injector;->createActionMenuPresenter(Landroid/content/Context;)Lcom/android/internal/view/menu/ActionMenuPresenter;
 
-    invoke-direct {v4, v5}, Lcom/android/internal/view/menu/ActionMenuPresenter;-><init>(Landroid/content/Context;)V
+    move-result-object v4
 
     iput-object v4, p0, Lcom/android/internal/widget/AbsActionBarView;->mActionMenuPresenter:Lcom/android/internal/view/menu/ActionMenuPresenter;
 
@@ -5860,12 +6050,12 @@
 
     .local v0, visible:Z
     :goto_1
-    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/widget/LinearLayout;
+    iget-object v1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     if-eqz v0, :cond_4
 
     :goto_2
-    invoke-virtual {v1, v2}, Landroid/widget/LinearLayout;->setVisibility(I)V
+    invoke-virtual {v1, v2}, Landroid/view/ViewGroup;->setVisibility(I)V
 
     .end local v0           #visible:Z
     :cond_1
@@ -5888,6 +6078,19 @@
     goto :goto_2
 .end method
 
+.method public setSubtitleView(Landroid/widget/TextView;)V
+    .locals 0
+    .parameter "subTitleView"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-object p1, p0, Lcom/android/internal/widget/ActionBarView;->mSubtitleView:Landroid/widget/TextView;
+
+    return-void
+.end method
+
 .method public setTitle(Ljava/lang/CharSequence;)V
     .locals 1
     .parameter "title"
@@ -5902,6 +6105,32 @@
     return-void
 .end method
 
+.method public setTitleLayout(Landroid/view/ViewGroup;)V
+    .locals 0
+    .parameter "titleLayout"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-object p1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+
+    return-void
+.end method
+
+.method public setTitleView(Landroid/widget/TextView;)V
+    .locals 0
+    .parameter "titleView"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iput-object p1, p0, Lcom/android/internal/widget/ActionBarView;->mTitleView:Landroid/widget/TextView;
+
+    return-void
+.end method
+
 .method public setWindowCallback(Landroid/view/Window$Callback;)V
     .locals 0
     .parameter "cb"
@@ -5935,18 +6164,3 @@
 
     return v0
 .end method
-
-.method public setHomeViewBackground(I)V
-    .locals 1
-    .parameter "resId"
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    iget-object v0, p0, Lcom/android/internal/widget/ActionBarView;->mHomeLayout:Lcom/android/internal/widget/ActionBarView$HomeView;
-
-    invoke-virtual {v0, p1}, Lcom/android/internal/widget/ActionBarView$HomeView;->setBackgroundResource(I)V
-
-    return-void
-.end method
--- a/framework2.jar.out/smali/com/android/internal/widget/LockPatternUtils.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/LockPatternUtils.smali
@@ -266,11 +266,11 @@
 
     const-string v0, "lockscreen.password_type"
 
-    invoke-direct {p0, v0, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v0, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     const-string v0, "lockscreen.password_type_alternate"
 
-    invoke-direct {p0, v0, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v0, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     return-void
 .end method
@@ -590,7 +590,7 @@
 
     const-string v3, "lockscreen.password_salt"
 
-    invoke-direct {p0, v3, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v3, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     const-string v3, "LockPatternUtils"
 
@@ -877,61 +877,6 @@
     goto :goto_0
 .end method
 
-.method private setLong(Ljava/lang/String;J)V
-    .locals 4
-    .parameter "secureSettingKey"
-    .parameter "value"
-
-    .prologue
-    :try_start_0
-    invoke-direct {p0}, Lcom/android/internal/widget/LockPatternUtils;->getLockSettings()Lcom/android/internal/widget/ILockSettings;
-
-    move-result-object v1
-
-    invoke-direct {p0}, Lcom/android/internal/widget/LockPatternUtils;->getCurrentOrCallingUserId()I
-
-    move-result v2
-
-    invoke-interface {v1, p1, p2, p3, v2}, Lcom/android/internal/widget/ILockSettings;->setLong(Ljava/lang/String;JI)V
-    :try_end_0
-    .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
-
-    :goto_0
-    return-void
-
-    :catch_0
-    move-exception v0
-
-    .local v0, re:Landroid/os/RemoteException;
-    const-string v1, "LockPatternUtils"
-
-    new-instance v2, Ljava/lang/StringBuilder;
-
-    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
-
-    const-string v3, "Couldn\'t write long "
-
-    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v2
-
-    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
-
-    move-result-object v2
-
-    invoke-virtual {v2, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
-
-    move-result-object v2
-
-    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
-
-    move-result-object v2
-
-    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
-
-    goto :goto_0
-.end method
-
 .method private setString(Ljava/lang/String;Ljava/lang/String;)V
     .locals 4
     .parameter "secureSettingKey"
@@ -1596,7 +1541,7 @@
 
     const-wide/32 v1, 0x10000
 
-    invoke-direct {p0, v0, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v0, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     return-void
 .end method
@@ -3509,9 +3454,15 @@
 .end method
 
 .method public reportSuccessfulPasswordAttempt()V
-    .locals 1
+    .locals 3
 
     .prologue
+    const-string v0, "lockscreen.lockoutattemptdeadline"
+
+    const-wide/16 v1, 0x0
+
+    invoke-virtual {p0, v0, v1, v2}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+
     invoke-virtual {p0}, Lcom/android/internal/widget/LockPatternUtils;->getDevicePolicyManager()Landroid/app/admin/DevicePolicyManager;
 
     move-result-object v0
@@ -3728,7 +3679,7 @@
 
     move-object/from16 v0, p0
 
-    invoke-direct {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     if-eqz v21, :cond_6
 
@@ -3986,7 +3937,7 @@
 
     move-object/from16 v0, p0
 
-    invoke-direct {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     const-string v3, "lockscreen.password_type_alternate"
 
@@ -4002,7 +3953,7 @@
 
     move-object/from16 v0, p0
 
-    invoke-direct {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     invoke-direct/range {p0 .. p0}, Lcom/android/internal/widget/LockPatternUtils;->finishSignature()V
 
@@ -4035,7 +3986,7 @@
 
     move-object/from16 v0, p0
 
-    invoke-direct {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     const-string v3, "lockscreen.password_type_alternate"
 
@@ -4051,7 +4002,7 @@
 
     move-object/from16 v0, p0
 
-    invoke-direct {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {v0, v3, v11, v12}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     invoke-direct/range {p0 .. p0}, Lcom/android/internal/widget/LockPatternUtils;->finishBiometricWeak()V
 
@@ -4318,7 +4269,7 @@
 
     const-wide/32 v2, 0x10000
 
-    invoke-direct {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     const/high16 v1, 0x1
 
@@ -4360,13 +4311,13 @@
 
     const-wide/32 v2, 0x9000
 
-    invoke-direct {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     const-string v1, "lockscreen.password_type_alternate"
 
     const-wide/32 v2, 0x10000
 
-    invoke-direct {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     invoke-direct {p0}, Lcom/android/internal/widget/LockPatternUtils;->finishSignature()V
 
@@ -4431,13 +4382,13 @@
 
     const-wide/32 v2, 0x8000
 
-    invoke-direct {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     const-string v1, "lockscreen.password_type_alternate"
 
     const-wide/32 v2, 0x10000
 
-    invoke-direct {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v1, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     invoke-direct {p0}, Lcom/android/internal/widget/LockPatternUtils;->finishBiometricWeak()V
 
@@ -4557,7 +4508,7 @@
 
     const-wide/32 v4, 0x10000
 
-    invoke-direct {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     .end local v0           #a:I
     :cond_0
@@ -4574,7 +4525,7 @@
 
     const-wide/32 v4, 0x40000
 
-    invoke-direct {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
     :try_end_0
     .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
 
@@ -4621,7 +4572,7 @@
 
     const-wide/32 v4, 0x50000
 
-    invoke-direct {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     goto :goto_0
 
@@ -4634,7 +4585,7 @@
 
     const-wide/32 v4, 0x20000
 
-    invoke-direct {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v3, v4, v5}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
     :try_end_1
     .catch Landroid/os/RemoteException; {:try_start_1 .. :try_end_1} :catch_0
 
@@ -4808,7 +4759,7 @@
     :goto_0
     const-string v4, "lock_biometric_weak_flags"
 
-    invoke-direct {p0, v4, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v4, v2, v3}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     return-void
 
@@ -4873,7 +4824,7 @@
     const-wide/16 v0, 0x1
 
     :goto_0
-    invoke-direct {p0, v2, v0, v1}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v2, v0, v1}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     return-void
 
@@ -4898,11 +4849,69 @@
     .local v0, deadline:J
     const-string v2, "lockscreen.lockoutattemptdeadline"
 
-    invoke-direct {p0, v2, v0, v1}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
+    invoke-virtual {p0, v2, v0, v1}, Lcom/android/internal/widget/LockPatternUtils;->setLong(Ljava/lang/String;J)V
 
     return-wide v0
 .end method
 
+.method protected setLong(Ljava/lang/String;J)V
+    .locals 4
+    .parameter "secureSettingKey"
+    .parameter "value"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_ACCESS:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    :try_start_0
+    invoke-direct {p0}, Lcom/android/internal/widget/LockPatternUtils;->getLockSettings()Lcom/android/internal/widget/ILockSettings;
+
+    move-result-object v1
+
+    invoke-direct {p0}, Lcom/android/internal/widget/LockPatternUtils;->getCurrentOrCallingUserId()I
+
+    move-result v2
+
+    invoke-interface {v1, p1, p2, p3, v2}, Lcom/android/internal/widget/ILockSettings;->setLong(Ljava/lang/String;JI)V
+    :try_end_0
+    .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
+
+    :goto_0
+    return-void
+
+    :catch_0
+    move-exception v0
+
+    .local v0, re:Landroid/os/RemoteException;
+    const-string v1, "LockPatternUtils"
+
+    new-instance v2, Ljava/lang/StringBuilder;
+
+    invoke-direct {v2}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v3, "Couldn\'t write long "
+
+    invoke-virtual {v2, v3}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v2
+
+    invoke-virtual {v2, p1}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v2
+
+    invoke-virtual {v2, v0}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+
+    move-result-object v2
+
+    invoke-virtual {v2}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v2
+
+    invoke-static {v1, v2}, Landroid/util/Log;->e(Ljava/lang/String;Ljava/lang/String;)I
+
+    goto :goto_0
+.end method
+
 .method public setPermanentlyLocked(Z)V
     .locals 1
     .parameter "locked"
--- a/framework2.jar.out/smali/com/android/internal/widget/ScrollingTabContainerView$TabClickListener.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ScrollingTabContainerView$TabClickListener.smali
@@ -111,5 +111,9 @@
 
     .end local v0           #child:Landroid/view/View;
     :cond_1
+    iget-object v4, p0, Lcom/android/internal/widget/ScrollingTabContainerView$TabClickListener;->this$0:Lcom/android/internal/widget/ScrollingTabContainerView;
+
+    invoke-static {v4, p1}, Lcom/android/internal/widget/ScrollingTabContainerView$Injector;->onTabViewClick(Lcom/android/internal/widget/ScrollingTabContainerView;Landroid/view/View;)V
+
     return-void
 .end method
--- a/framework2.jar.out/smali/com/android/internal/widget/ScrollingTabContainerView.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ScrollingTabContainerView.smali
@@ -12,7 +12,8 @@
         Lcom/android/internal/widget/ScrollingTabContainerView$VisibilityAnimListener;,
         Lcom/android/internal/widget/ScrollingTabContainerView$TabClickListener;,
         Lcom/android/internal/widget/ScrollingTabContainerView$TabAdapter;,
-        Lcom/android/internal/widget/ScrollingTabContainerView$TabView;
+        Lcom/android/internal/widget/ScrollingTabContainerView$TabView;,
+        Lcom/android/internal/widget/ScrollingTabContainerView$Injector;
     }
 .end annotation
 
@@ -176,12 +177,9 @@
 
 .method private createTabLayout()Landroid/widget/LinearLayout;
     .locals 4
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
 
     .prologue
-    new-instance v0, Lcom/android/internal/widget/MiuiTabLayout;
+    new-instance v0, Landroid/widget/LinearLayout;
 
     invoke-virtual {p0}, Lcom/android/internal/widget/ScrollingTabContainerView;->getContext()Landroid/content/Context;
 
@@ -191,7 +189,7 @@
 
     const v3, 0x10102f4
 
-    invoke-direct {v0, v1, v2, v3}, Lcom/android/internal/widget/MiuiTabLayout;-><init>(Landroid/content/Context;Landroid/util/AttributeSet;I)V
+    invoke-direct {v0, v1, v2, v3}, Landroid/widget/LinearLayout;-><init>(Landroid/content/Context;Landroid/util/AttributeSet;I)V
 
     .local v0, tabLayout:Landroid/widget/LinearLayout;
     const/4 v1, 0x1
@@ -666,6 +664,30 @@
     goto :goto_0
 .end method
 
+.method protected getSelectedTabIndex()I
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget v0, p0, Lcom/android/internal/widget/ScrollingTabContainerView;->mSelectedTabIndex:I
+
+    return v0
+.end method
+
+.method protected getTabLayout()Landroid/widget/LinearLayout;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v0, p0, Lcom/android/internal/widget/ScrollingTabContainerView;->mTabLayout:Landroid/widget/LinearLayout;
+
+    return-object v0
+.end method
+
 .method public onAttachedToWindow()V
     .locals 1
 
--- a/services.jar.out/smali/com/android/server/InputMethodManagerService.smali
+++ b/services.jar.out/smali/com/android/server/InputMethodManagerService.smali
@@ -4478,6 +4478,8 @@
 
     invoke-virtual {v11, v0}, Landroid/widget/Switch;->setOnCheckedChangeListener(Landroid/widget/CompoundButton$OnCheckedChangeListener;)V
 
+    invoke-virtual/range {p0 .. p0}, Lcom/android/server/InputMethodManagerService;->removeCustomTitle()V
+
     invoke-virtual {v8}, Landroid/content/Context;->getResources()Landroid/content/res/Resources;
 
     move-result-object v24
@@ -8800,6 +8802,39 @@
     throw v0
 .end method
 
+.method removeCustomTitle()V
+    .locals 3
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v2, 0x0
+
+    iget-object v0, p0, Lcom/android/server/InputMethodManagerService;->mContext:Landroid/content/Context;
+
+    invoke-static {v0}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v0
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/server/InputMethodManagerService;->mDialogBuilder:Landroid/app/AlertDialog$Builder;
+
+    invoke-virtual {v0, v2}, Landroid/app/AlertDialog$Builder;->setCustomTitle(Landroid/view/View;)Landroid/app/AlertDialog$Builder;
+
+    iget-object v0, p0, Lcom/android/server/InputMethodManagerService;->mDialogBuilder:Landroid/app/AlertDialog$Builder;
+
+    const v1, 0x1040447
+
+    invoke-virtual {v0, v1}, Landroid/app/AlertDialog$Builder;->setTitle(I)Landroid/app/AlertDialog$Builder;
+
+    iput-object v2, p0, Lcom/android/server/InputMethodManagerService;->mSwitchingDialogTitleView:Landroid/view/View;
+
+    :cond_0
+    return-void
+.end method
+
 .method public setAdditionalInputMethodSubtypes(Ljava/lang/String;[Landroid/view/inputmethod/InputMethodSubtype;)V
     .locals 10
     .parameter "imiId"
--- a/services.jar.out/smali/com/android/server/StatusBarManagerService.smali
+++ b/services.jar.out/smali/com/android/server/StatusBarManagerService.smali
@@ -10,6 +10,7 @@
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
         Lcom/android/server/StatusBarManagerService$NotificationCallbacks;,
+        Lcom/android/server/StatusBarManagerService$StatusRecord;,
         Lcom/android/server/StatusBarManagerService$DisableRecord;
     }
 .end annotation
@@ -73,6 +74,21 @@
     .end annotation
 .end field
 
+.field mStatusRecords:Ljava/util/ArrayList;
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "Ljava/util/ArrayList",
+            "<",
+            "Lcom/android/server/StatusBarManagerService$StatusRecord;",
+            ">;"
+        }
+    .end annotation
+.end field
+
 .field mSysUiVisToken:Landroid/os/IBinder;
 
 .field mSystemUiVisibility:I
@@ -119,6 +135,12 @@
 
     iput-object v1, p0, Lcom/android/server/StatusBarManagerService;->mDisableRecords:Ljava/util/ArrayList;
 
+    new-instance v1, Ljava/util/ArrayList;
+
+    invoke-direct {v1}, Ljava/util/ArrayList;-><init>()V
+
+    iput-object v1, p0, Lcom/android/server/StatusBarManagerService;->mStatusRecords:Ljava/util/ArrayList;
+
     new-instance v1, Landroid/os/Binder;
 
     invoke-direct {v1}, Landroid/os/Binder;-><init>()V
@@ -1080,6 +1102,117 @@
     goto :goto_1
 .end method
 
+.method manageStatusListLocked(ILandroid/os/IBinder;Ljava/lang/String;)V
+    .locals 7
+    .parameter "what"
+    .parameter "token"
+    .parameter "pkg"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v6, 0x0
+
+    iget-object v5, p0, Lcom/android/server/StatusBarManagerService;->mStatusRecords:Ljava/util/ArrayList;
+
+    invoke-virtual {v5}, Ljava/util/ArrayList;->size()I
+
+    move-result v0
+
+    .local v0, N:I
+    const/4 v4, 0x0
+
+    .local v4, tok:Lcom/android/server/StatusBarManagerService$StatusRecord;
+    const/4 v2, 0x0
+
+    .local v2, i:I
+    :goto_0
+    if-ge v2, v0, :cond_0
+
+    iget-object v5, p0, Lcom/android/server/StatusBarManagerService;->mStatusRecords:Ljava/util/ArrayList;
+
+    invoke-virtual {v5, v2}, Ljava/util/ArrayList;->get(I)Ljava/lang/Object;
+
+    move-result-object v3
+
+    check-cast v3, Lcom/android/server/StatusBarManagerService$StatusRecord;
+
+    .local v3, t:Lcom/android/server/StatusBarManagerService$StatusRecord;
+    iget-object v5, v3, Lcom/android/server/StatusBarManagerService$StatusRecord;->token:Landroid/os/IBinder;
+
+    if-ne v5, p2, :cond_3
+
+    move-object v4, v3
+
+    .end local v3           #t:Lcom/android/server/StatusBarManagerService$StatusRecord;
+    :cond_0
+    if-eqz p1, :cond_1
+
+    invoke-interface {p2}, Landroid/os/IBinder;->isBinderAlive()Z
+
+    move-result v5
+
+    if-nez v5, :cond_4
+
+    :cond_1
+    if-eqz v4, :cond_2
+
+    iget-object v5, p0, Lcom/android/server/StatusBarManagerService;->mStatusRecords:Ljava/util/ArrayList;
+
+    invoke-virtual {v5, v2}, Ljava/util/ArrayList;->remove(I)Ljava/lang/Object;
+
+    iget-object v5, v4, Lcom/android/server/StatusBarManagerService$StatusRecord;->token:Landroid/os/IBinder;
+
+    invoke-interface {v5, v4, v6}, Landroid/os/IBinder;->unlinkToDeath(Landroid/os/IBinder$DeathRecipient;I)Z
+
+    :cond_2
+    :goto_1
+    return-void
+
+    .restart local v3       #t:Lcom/android/server/StatusBarManagerService$StatusRecord;
+    :cond_3
+    add-int/lit8 v2, v2, 0x1
+
+    goto :goto_0
+
+    .end local v3           #t:Lcom/android/server/StatusBarManagerService$StatusRecord;
+    :cond_4
+    if-nez v4, :cond_5
+
+    new-instance v4, Lcom/android/server/StatusBarManagerService$StatusRecord;
+
+    .end local v4           #tok:Lcom/android/server/StatusBarManagerService$StatusRecord;
+    const/4 v5, 0x0
+
+    invoke-direct {v4, p0, v5}, Lcom/android/server/StatusBarManagerService$StatusRecord;-><init>(Lcom/android/server/StatusBarManagerService;Lcom/android/server/StatusBarManagerService$1;)V
+
+    .restart local v4       #tok:Lcom/android/server/StatusBarManagerService$StatusRecord;
+    const/4 v5, 0x0
+
+    :try_start_0
+    invoke-interface {p2, v4, v5}, Landroid/os/IBinder;->linkToDeath(Landroid/os/IBinder$DeathRecipient;I)V
+    :try_end_0
+    .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_0
+
+    iget-object v5, p0, Lcom/android/server/StatusBarManagerService;->mStatusRecords:Ljava/util/ArrayList;
+
+    invoke-virtual {v5, v4}, Ljava/util/ArrayList;->add(Ljava/lang/Object;)Z
+
+    :cond_5
+    iput-object p2, v4, Lcom/android/server/StatusBarManagerService$StatusRecord;->token:Landroid/os/IBinder;
+
+    iput-object p3, v4, Lcom/android/server/StatusBarManagerService$StatusRecord;->pkg:Ljava/lang/String;
+
+    goto :goto_1
+
+    :catch_0
+    move-exception v1
+
+    .local v1, ex:Landroid/os/RemoteException;
+    goto :goto_1
+.end method
+
 .method public onClearAllNotifications()V
     .locals 1
 
@@ -1977,6 +2110,60 @@
     return-void
 .end method
 
+.method public setStatus(ILandroid/os/IBinder;Ljava/lang/String;Landroid/os/Bundle;)V
+    .locals 2
+    .parameter "what"
+    .parameter "token"
+    .parameter "action"
+    .parameter "ext"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    iget-object v1, p0, Lcom/android/server/StatusBarManagerService;->mLock:Ljava/lang/Object;
+
+    monitor-enter v1
+
+    :try_start_0
+    invoke-virtual {p0, p1, p2, p3}, Lcom/android/server/StatusBarManagerService;->manageStatusListLocked(ILandroid/os/IBinder;Ljava/lang/String;)V
+
+    iget-object v0, p0, Lcom/android/server/StatusBarManagerService;->mBar:Lcom/android/internal/statusbar/IStatusBar;
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    if-eqz v0, :cond_0
+
+    :try_start_1
+    iget-object v0, p0, Lcom/android/server/StatusBarManagerService;->mBar:Lcom/android/internal/statusbar/IStatusBar;
+
+    invoke-interface {v0, p1, p3, p4}, Lcom/android/internal/statusbar/IStatusBar;->setStatus(ILjava/lang/String;Landroid/os/Bundle;)V
+    :try_end_1
+    .catchall {:try_start_1 .. :try_end_1} :catchall_0
+    .catch Landroid/os/RemoteException; {:try_start_1 .. :try_end_1} :catch_0
+
+    :cond_0
+    :goto_0
+    :try_start_2
+    monitor-exit v1
+
+    return-void
+
+    :catchall_0
+    move-exception v0
+
+    monitor-exit v1
+    :try_end_2
+    .catchall {:try_start_2 .. :try_end_2} :catchall_0
+
+    throw v0
+
+    :catch_0
+    move-exception v0
+
+    goto :goto_0
+.end method
+
 .method public setSystemUiVisibility(II)V
     .locals 4
     .parameter "vis"
--- a/services.jar.out/smali/com/android/server/am/ActivityManagerService.smali
+++ b/services.jar.out/smali/com/android/server/am/ActivityManagerService.smali
@@ -5917,17 +5917,21 @@
     move-result-object v8
 
     .restart local v8       #queue:Lcom/android/server/am/BroadcastQueue;
+    move-object/from16 v0, p0
+
+    iget-object v3, v0, Lcom/android/server/am/ActivityManagerService;->mContext:Landroid/content/Context;
+
     invoke-virtual/range {p0 .. p0}, Lcom/android/server/am/ActivityManagerService;->getRunningAppProcesses()Ljava/util/List;
 
-    move-result-object v3
+    move-result-object v5
 
     invoke-virtual/range {v44 .. v44}, Landroid/content/Intent;->getAction()Ljava/lang/String;
 
-    move-result-object v5
+    move-result-object v9
 
     move-object/from16 v0, v24
 
-    invoke-static {v0, v3, v5}, Lcom/android/server/am/ExtraActivityManagerService;->adjustMediaButtonReceivers(Ljava/util/List;Ljava/util/List;Ljava/lang/String;)V
+    invoke-static {v3, v0, v5, v9}, Lcom/android/server/am/ExtraActivityManagerService;->adjustMediaButtonReceivers(Landroid/content/Context;Ljava/util/List;Ljava/util/List;Ljava/lang/String;)V
 
     new-instance v7, Lcom/android/server/am/BroadcastRecord;
 
@@ -20668,7 +20672,7 @@
     move-result-object v1
 
     .local v1, context:Landroid/content/Context;
-    const v4, 0x103006e
+    const v4, 0x60d003a
 
     invoke-virtual {v1, v4}, Landroid/content/Context;->setTheme(I)V
 
--- a/services.jar.out/smali/com/android/server/am/ActivityStack.smali
+++ b/services.jar.out/smali/com/android/server/am/ActivityStack.smali
@@ -6,6 +6,7 @@
 # annotations
 .annotation system Ldalvik/annotation/MemberClasses;
     value = {
+        Lcom/android/server/am/ActivityStack$CpuBooster;,
         Lcom/android/server/am/ActivityStack$ScheduleDestroyArgs;,
         Lcom/android/server/am/ActivityStack$ActivityState;
     }
@@ -96,6 +97,12 @@
 
 .field final mContext:Landroid/content/Context;
 
+.field private mCpuBooster:Lcom/android/server/am/ActivityStack$CpuBooster;
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
+
 .field private mCurrentUser:I
 
 .field mDismissKeyguardOnNextActivity:Z
@@ -391,6 +398,8 @@
 
     iput-object v1, p0, Lcom/android/server/am/ActivityStack;->mHandler:Landroid/os/Handler;
 
+    iput-object v3, p0, Lcom/android/server/am/ActivityStack;->mCpuBooster:Lcom/android/server/am/ActivityStack$CpuBooster;
+
     iput-object p1, p0, Lcom/android/server/am/ActivityStack;->mService:Lcom/android/server/am/ActivityManagerService;
 
     iput-object p2, p0, Lcom/android/server/am/ActivityStack;->mContext:Landroid/content/Context;
@@ -426,6 +435,8 @@
 
     invoke-virtual {v1, v3}, Landroid/os/PowerManager$WakeLock;->setReferenceCounted(Z)V
 
+    invoke-direct {p0}, Lcom/android/server/am/ActivityStack;->initCpuBooster()V
+
     iget-object v1, p0, Lcom/android/server/am/ActivityStack;->mContext:Landroid/content/Context;
 
     invoke-static {v1}, Landroid/sec/multiwindow/impl/MultiWindowManager;->isEnabled(Landroid/content/Context;)Z
@@ -9046,6 +9057,10 @@
 
     move-result v0
 
+    invoke-virtual {p0, v0}, Lcom/android/server/am/ActivityStack;->setForegroundProcess(Z)Z
+
+    move-result v0
+
     return v0
 .end method
 
@@ -13739,6 +13754,9 @@
 .method final resumeTopActivityLocked(Lcom/android/server/am/ActivityRecord;)Z
     .locals 1
     .parameter "prev"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v0, 0x0
@@ -16385,6 +16403,13 @@
     .parameter "outActivity"
 
     .prologue
+
+    move-object/from16 v0, p0
+
+    iget-object v3, v0, Lcom/android/server/am/ActivityStack;->mCpuBooster:Lcom/android/server/am/ActivityStack$CpuBooster;
+
+    invoke-virtual {v3}, Lcom/android/server/am/ActivityStack$CpuBooster;->start()V
+
     const/16 v28, 0x0
 
     .local v28, err:I
@@ -21289,3 +21314,49 @@
 
     return-void
 .end method
+
+.method setForegroundProcess(Z)Z
+    .locals 3
+    .parameter "resumed"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v1, 0x0
+
+    invoke-virtual {p0, v1}, Lcom/android/server/am/ActivityStack;->topRunningActivityLocked(Lcom/android/server/am/ActivityRecord;)Lcom/android/server/am/ActivityRecord;
+
+    move-result-object v0
+
+    .local v0, next:Lcom/android/server/am/ActivityRecord;
+    if-eqz v0, :cond_0
+
+    if-eqz p1, :cond_0
+
+    const-string v1, "sys.foreground_process"
+
+    iget-object v2, v0, Lcom/android/server/am/ActivityRecord;->processName:Ljava/lang/String;
+
+    invoke-static {v1, v2}, Landroid/os/SystemProperties;->set(Ljava/lang/String;Ljava/lang/String;)V
+
+    :cond_0
+    return p1
+.end method
+
+.method private initCpuBooster()V
+    .locals 3
+
+    .prologue
+    new-instance v0, Lcom/android/server/am/ActivityStack$CpuBooster;
+
+    iget-object v1, p0, Lcom/android/server/am/ActivityStack;->mService:Lcom/android/server/am/ActivityManagerService;
+
+    iget-object v2, p0, Lcom/android/server/am/ActivityStack;->mHandler:Landroid/os/Handler;
+
+    invoke-direct {v0, v1, v2}, Lcom/android/server/am/ActivityStack$CpuBooster;-><init>(Lcom/android/server/am/ActivityManagerService;Landroid/os/Handler;)V
+
+    iput-object v0, p0, Lcom/android/server/am/ActivityStack;->mCpuBooster:Lcom/android/server/am/ActivityStack$CpuBooster;
+
+    return-void
+.end method
--- a/services.jar.out/smali/com/android/server/am/BaseErrorDialog.smali
+++ b/services.jar.out/smali/com/android/server/am/BaseErrorDialog.smali
@@ -17,7 +17,7 @@
     .prologue
     const/high16 v2, 0x2
 
-    const v0, 0x60d0020
+    const v0, 0x60d003e
 
     invoke-direct {p0, p1, v0}, Landroid/app/AlertDialog;-><init>(Landroid/content/Context;I)V
 
--- a/services.jar.out/smali/com/android/server/am/UsageStatsService.smali
+++ b/services.jar.out/smali/com/android/server/am/UsageStatsService.smali
@@ -1692,6 +1692,7 @@
     .catchall {:try_start_0 .. :try_end_0} :catchall_1
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_0 .. :try_end_0} :catch_1
     .catch Ljava/io/IOException; {:try_start_0 .. :try_end_0} :catch_3
+    .catch Ljava/lang/IndexOutOfBoundsException; {:try_start_0 .. :try_end_0} :catch_5
 
     move-result-object v10
 
@@ -1709,7 +1710,7 @@
     :try_start_1
     invoke-virtual {v4}, Ljava/io/FileInputStream;->close()V
     :try_end_1
-    .catch Ljava/io/IOException; {:try_start_1 .. :try_end_1} :catch_5
+    .catch Ljava/io/IOException; {:try_start_1 .. :try_end_1} :catch_7
 
     .end local v3           #eventType:I
     .end local v9           #parser:Lorg/xmlpull/v1/XmlPullParser;
@@ -1757,6 +1758,7 @@
     .catchall {:try_start_2 .. :try_end_2} :catchall_1
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_2 .. :try_end_2} :catch_1
     .catch Ljava/io/IOException; {:try_start_2 .. :try_end_2} :catch_3
+    .catch Ljava/lang/IndexOutOfBoundsException; {:try_start_2 .. :try_end_2} :catch_5
 
     move-result-object v7
 
@@ -1779,6 +1781,7 @@
     .catch Ljava/lang/NumberFormatException; {:try_start_3 .. :try_end_3} :catch_0
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_3 .. :try_end_3} :catch_1
     .catch Ljava/io/IOException; {:try_start_3 .. :try_end_3} :catch_3
+    .catch Ljava/lang/IndexOutOfBoundsException; {:try_start_3 .. :try_end_3} :catch_5
 
     :try_start_4
     iget-object v12, p0, Lcom/android/server/am/UsageStatsService;->mLastResumeTimes:Ljava/util/Map;
@@ -1828,6 +1831,7 @@
     .catch Ljava/lang/NumberFormatException; {:try_start_5 .. :try_end_5} :catch_0
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_5 .. :try_end_5} :catch_1
     .catch Ljava/io/IOException; {:try_start_5 .. :try_end_5} :catch_3
+    .catch Ljava/lang/IndexOutOfBoundsException; {:try_start_5 .. :try_end_5} :catch_5
 
     .end local v5           #lastResumeTime:J
     :catch_0
@@ -1855,6 +1859,7 @@
     .catchall {:try_start_6 .. :try_end_6} :catchall_1
     .catch Lorg/xmlpull/v1/XmlPullParserException; {:try_start_6 .. :try_end_6} :catch_1
     .catch Ljava/io/IOException; {:try_start_6 .. :try_end_6} :catch_3
+    .catch Ljava/lang/IndexOutOfBoundsException; {:try_start_6 .. :try_end_6} :catch_5
 
     move-result v12
 
@@ -1956,15 +1961,59 @@
     goto/16 :goto_2
 
     .end local v2           #e:Ljava/io/IOException;
+    :catch_5
+    move-exception v2
+
+    .local v2, e:Ljava/lang/IndexOutOfBoundsException;
+    :try_start_b
+    const-string v12, "UsageStats"
+
+    new-instance v13, Ljava/lang/StringBuilder;
+
+    invoke-direct {v13}, Ljava/lang/StringBuilder;-><init>()V
+
+    const-string v14, "Error reading history stats: "
+
+    invoke-virtual {v13, v14}, Ljava/lang/StringBuilder;->append(Ljava/lang/String;)Ljava/lang/StringBuilder;
+
+    move-result-object v13
+
+    invoke-virtual {v13, v2}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+
+    move-result-object v13
+
+    invoke-virtual {v13}, Ljava/lang/StringBuilder;->toString()Ljava/lang/String;
+
+    move-result-object v13
+
+    invoke-static {v12, v13}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
+    :try_end_b
+    .catchall {:try_start_b .. :try_end_b} :catchall_1
+
+    if-eqz v4, :cond_4
+
+    :try_start_c
+    invoke-virtual {v4}, Ljava/io/FileInputStream;->close()V
+    :try_end_c
+    .catch Ljava/io/IOException; {:try_start_c .. :try_end_c} :catch_6
+
+    goto/16 :goto_2
+
+    :catch_6
+    move-exception v12
+
+    goto/16 :goto_2
+
+    .end local v2           #e:Ljava/lang/IndexOutOfBoundsException;
     :catchall_1
     move-exception v12
 
     if-eqz v4, :cond_8
 
-    :try_start_b
+    :try_start_d
     invoke-virtual {v4}, Ljava/io/FileInputStream;->close()V
-    :try_end_b
-    .catch Ljava/io/IOException; {:try_start_b .. :try_end_b} :catch_6
+    :try_end_d
+    .catch Ljava/io/IOException; {:try_start_d .. :try_end_d} :catch_8
 
     :cond_8
     :goto_3
@@ -1973,7 +2022,7 @@
     .restart local v3       #eventType:I
     .restart local v9       #parser:Lorg/xmlpull/v1/XmlPullParser;
     .restart local v11       #tagName:Ljava/lang/String;
-    :catch_5
+    :catch_7
     move-exception v12
 
     goto/16 :goto_2
@@ -1981,7 +2030,7 @@
     .end local v3           #eventType:I
     .end local v9           #parser:Lorg/xmlpull/v1/XmlPullParser;
     .end local v11           #tagName:Ljava/lang/String;
-    :catch_6
+    :catch_8
     move-exception v13
 
     goto :goto_3
--- a/services.jar.out/smali/com/android/server/net/NetworkPolicyManagerService.smali
+++ b/services.jar.out/smali/com/android/server/net/NetworkPolicyManagerService.smali
@@ -1343,9 +1343,6 @@
 
     .restart local v14       #title:Ljava/lang/CharSequence;
     :goto_2
-    const/4 v1, 0x1
-
-    invoke-virtual {v8, v1}, Landroid/app/Notification$Builder;->setOngoing(Z)Landroid/app/Notification$Builder;
 
     const v1, 0x108068c
 
@@ -1478,10 +1475,6 @@
 
     .restart local v14       #title:Ljava/lang/CharSequence;
     :goto_3
-    const/4 v1, 0x1
-
-    invoke-virtual {v8, v1}, Landroid/app/Notification$Builder;->setOngoing(Z)Landroid/app/Notification$Builder;
-
     const v1, 0x1080078
 
     invoke-virtual {v8, v1}, Landroid/app/Notification$Builder;->setSmallIcon(I)Landroid/app/Notification$Builder;
@@ -1705,7 +1698,7 @@
 .end method
 
 .method private enqueueValidNotification(Landroid/net/NetworkPolicy;IJ)V
-    .locals 1
+    .locals 2
     .parameter "policy"
     .parameter "type"
     .parameter "totalBytes"
@@ -1716,16 +1709,28 @@
     .prologue
     invoke-static {p2}, Lcom/android/server/net/NetworkPolicyManagerService$Injector;->isIntervalValid(I)Z
 
-    move-result v0
+    move-result v1
 
-    if-eqz v0, :cond_0
+    if-eqz v1, :cond_0
 
     invoke-static {p2}, Lcom/android/server/net/NetworkPolicyManagerService$Injector;->setInterval(I)V
 
     invoke-direct {p0, p1, p2, p3, p4}, Lcom/android/server/net/NetworkPolicyManagerService;->enqueueNotification(Landroid/net/NetworkPolicy;IJ)V
 
-    :cond_0
+    :goto_0
     return-void
+
+    :cond_0
+    invoke-direct {p0, p1, p2}, Lcom/android/server/net/NetworkPolicyManagerService;->buildNotificationTag(Landroid/net/NetworkPolicy;I)Ljava/lang/String;
+
+    move-result-object v0
+
+    .local v0, tag:Ljava/lang/String;
+    iget-object v1, p0, Lcom/android/server/net/NetworkPolicyManagerService;->mActiveNotifs:Ljava/util/HashSet;
+
+    invoke-virtual {v1, v0}, Ljava/util/HashSet;->add(Ljava/lang/Object;)Z
+
+    goto :goto_0
 .end method
 
 .method private ensureActiveMobilePolicyLocked()V
--- a/services.jar.out/smali/com/android/server/pm/PackageManagerService.smali
+++ b/services.jar.out/smali/com/android/server/pm/PackageManagerService.smali
@@ -3216,6 +3216,7 @@
     move-object/from16 v0, p0
 
     iput-object v2, v0, Lcom/android/server/pm/PackageManagerService;->mRequiredVerifierPackage:Ljava/lang/String;
+    invoke-static {}, Lcom/android/server/pm/ExtraPackageManagerServices;->postScanPackages()V
 
     monitor-exit v45
     :try_end_9
@@ -10450,6 +10451,9 @@
     .parameter "args"
     .parameter "newInstall"
     .parameter "res"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     move-object/from16 v0, p1
@@ -10925,6 +10929,14 @@
 
     invoke-direct/range {v1 .. v6}, Lcom/android/server/pm/PackageManagerService;->installNewPackageLI(Landroid/content/pm/PackageParser$Package;IILjava/lang/String;Lcom/android/server/pm/PackageManagerService$PackageInstalledInfo;)V
 
+    iget-object v1, v2, Landroid/content/pm/PackageParser$Package;->applicationInfo:Landroid/content/pm/ApplicationInfo;
+
+    move-object/from16 v0, p0
+
+    iget-object v6, v0, Lcom/android/server/pm/PackageManagerService;->mSettings:Lcom/android/server/pm/Settings;
+
+    invoke-static {v1, v6}, Lcom/android/server/pm/ExtraPackageManagerServices;->postProcessNewInstall(Landroid/content/pm/ApplicationInfo;Lcom/android/server/pm/Settings;)V
+
     goto/16 :goto_6
 .end method
 
@@ -15827,7 +15839,7 @@
 
     iget-object v3, v0, Lcom/android/server/pm/PackageManagerService;->mResolveActivity:Landroid/content/pm/ActivityInfo;
 
-    const v10, 0x60d0020
+    const v10, 0x60d003e
 
     iput v10, v3, Landroid/content/pm/ActivityInfo;->theme:I
 
--- a/services.jar.out/smali/com/android/server/pm/ShutdownThread.smali
+++ b/services.jar.out/smali/com/android/server/pm/ShutdownThread.smali
@@ -578,7 +578,7 @@
     invoke-direct {v4, p0}, Landroid/app/ProgressDialog;-><init>(Landroid/content/Context;)V
 
     .local v4, pd:Landroid/app/ProgressDialog;
-    const v5, 0x60c0191
+    const v5, 0x60c0026
 
     invoke-virtual {p0, v5}, Landroid/content/Context;->getText(I)Ljava/lang/CharSequence;
 
@@ -586,7 +586,7 @@
 
     invoke-virtual {v4, v5}, Landroid/app/ProgressDialog;->setTitle(Ljava/lang/CharSequence;)V
 
-    const v5, 0x60c01aa
+    const v5, 0x60c002c
 
     invoke-virtual {p0, v5}, Landroid/content/Context;->getText(I)Ljava/lang/CharSequence;
 
--- a/services.jar.out/smali/com/android/server/pm/UserManager.smali
+++ b/services.jar.out/smali/com/android/server/pm/UserManager.smali
@@ -1689,7 +1689,17 @@
 
     monitor-enter v1
 
+    if-nez p1, :cond_0
+
+    const/4 v0, 0x1
+
     :try_start_0
+    monitor-exit v1
+
+    :goto_0
+    return v0
+
+    :cond_0
     iget-object v0, p0, Lcom/android/server/pm/UserManager;->mUserIds:[I
 
     invoke-static {v0, p1}, Lcom/android/internal/util/ArrayUtils;->contains([II)Z
@@ -1698,7 +1708,7 @@
 
     monitor-exit v1
 
-    return v0
+    goto :goto_0
 
     :catchall_0
     move-exception v0
--- a/services.jar.out/smali/com/android/server/wm/WindowManagerService.smali
+++ b/services.jar.out/smali/com/android/server/wm/WindowManagerService.smali
@@ -17362,6 +17362,7 @@
     move v6, v7
 
     :cond_2
+    const/4 v6, 0x0
     iput-boolean v6, p0, Lcom/android/server/wm/WindowManagerService;->mSafeMode:Z
 
     :try_start_0
-- 
1.7.5.4


From bc01879276a9b12a4284b1ab904a59a12edced0f Mon Sep 17 00:00:00 2001
From: gexudong <gexudong@xiaomi.com>
Date: Thu, 21 Feb 2013 21:01:19 +0800
Subject: [PATCH 2/6] fix and more smali merge to
 d1e0b1f4c987d2531fb5542383d9bb6c67fb2003

Change-Id: I11911f16c0ab08e640bb3755e87ea5f2e468a5b6
---
 .../policy/impl/LockPatternKeyguardView.smali      |   24 ++++++------
 .../com/android/internal/policy/impl/Policy.smali  |    4 +-
 .../pm/ResolveInfo$DisplayNameComparator.smali     |   29 ++++++---------
 .../android/content/res/Resources$Theme.smali      |   23 +++++++++++--
 .../smali/android/content/res/Resources.smali      |   24 ++++++++++++-
 .../smali/android/telephony/PhoneNumberUtils.smali |    2 +-
 framework.jar.out/smali/android/view/View.smali    |    9 +++++
 .../smali/android/webkit/WebSettingsClassic.smali  |   33 +++++++++++++++++
 .../PreferenceFrameLayout$LayoutParams.smali       |   13 +++++++
 .../smali/android/widget/NumberPicker.smali        |   37 ++++++++++++++++++++
 .../smali/android/widget/ProgressBar.smali         |   31 ++++++++++++++++
 .../internal/widget/ActionBarContainer.smali       |   35 +------------------
 .../android/internal/widget/ActionBarView.smali    |    8 ++--
 .../android/server/am/ActivityManagerService.smali |    8 ++++-
 14 files changed, 204 insertions(+), 76 deletions(-)

--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView.smali
@@ -4723,28 +4723,28 @@
 
     move-result v6
 
-    invoke-direct/range {v0 .. v6}, Lcom/android/internal/policy/impl/PatternUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/widget/LockPatternUtils;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;I)V
+    invoke-direct/range {v0 .. v6}, Lcom/android/internal/policy/impl/MiuiPatternUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/widget/LockPatternUtils;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;I)V
 
-    .local v0, view:Lcom/android/internal/policy/impl/PatternUnlockScreen;
-    iget-object v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mLockPatternUtils:Lcom/android/internal/widget/LockPatternUtils;
+    .local v0, view:Lcom/android/internal/policy/impl/MiuiPatternUnlockScreen;
+    #iget-object v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mLockPatternUtils:Lcom/android/internal/widget/LockPatternUtils;
 
-    invoke-virtual {v3}, Lcom/android/internal/widget/LockPatternUtils;->isLockSparePasswordEnabled()Z
+    #invoke-virtual {v3}, Lcom/android/internal/widget/LockPatternUtils;->isLockSparePasswordEnabled()Z
 
-    move-result v3
+    #move-result v3
 
-    iput-boolean v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mEnableSparePassword:Z
+    #iput-boolean v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mEnableSparePassword:Z
 
     iget-boolean v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mEnableFallback:Z
 
-    invoke-virtual {v0, v3}, Lcom/android/internal/policy/impl/PatternUnlockScreen;->setEnableFallback(Z)V
+    invoke-virtual {v0, v3}, Lcom/android/internal/policy/impl/MiuiPatternUnlockScreen;->setEnableFallback(Z)V
 
-    iget-boolean v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mEnableSparePassword:Z
+    #iget-boolean v3, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mEnableSparePassword:Z
 
-    invoke-virtual {v0, v3}, Lcom/android/internal/policy/impl/PatternUnlockScreen;->setEnableSparePasswordFallback(Z)V
+    #invoke-virtual {v0, v3}, Lcom/android/internal/policy/impl/PatternUnlockScreen;->setEnableSparePasswordFallback(Z)V
 
     move-object v1, v0
 
-    .end local v0           #view:Lcom/android/internal/policy/impl/PatternUnlockScreen;
+    .end local v0           #view:Lcom/android/internal/policy/impl/MiuiPatternUnlockScreen;
     .restart local v1       #unlockView:Landroid/view/View;
     :goto_0
     invoke-direct {p0, v1}, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->initializeTransportControlView(Landroid/view/View;)V
@@ -4786,7 +4786,7 @@
 
     if-ne p1, v3, :cond_2
 
-    new-instance v1, Lcom/android/internal/policy/impl/SimPukUnlockScreen;
+    new-instance v1, Lcom/android/internal/policy/impl/MiuiSimPUKUnlockScreen;
 
     .end local v1           #unlockView:Landroid/view/View;
     iget-object v2, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mContext:Landroid/content/Context;
@@ -4809,7 +4809,7 @@
 
     if-ne p1, v3, :cond_3
 
-    new-instance v1, Lcom/android/internal/policy/impl/SimUnlockScreen;
+    new-instance v1, Lcom/android/internal/policy/impl/MiuiSimPINUnlockScreen;
 
     .end local v1           #unlockView:Landroid/view/View;
     iget-object v2, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mContext:Landroid/content/Context;
--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/Policy.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/Policy.smali
@@ -155,9 +155,9 @@
     .parameter "context"
 
     .prologue
-    new-instance v0, Lcom/android/internal/policy/impl/PhoneLayoutInflater;
+    new-instance v0, Lcom/android/internal/policy/impl/MiuiPhoneLayoutInflater;
 
-    invoke-direct {v0, p1}, Lcom/android/internal/policy/impl/PhoneLayoutInflater;-><init>(Landroid/content/Context;)V
+    invoke-direct {v0, p1}, Lcom/android/internal/policy/impl/MiuiPhoneLayoutInflater;-><init>(Landroid/content/Context;)V
 
     return-object v0
 .end method
--- a/framework.jar.out/smali/android/content/pm/ResolveInfo$DisplayNameComparator.smali
+++ b/framework.jar.out/smali/android/content/pm/ResolveInfo$DisplayNameComparator.smali
@@ -55,9 +55,12 @@
 
 # virtual methods
 .method public final compare(Landroid/content/pm/ResolveInfo;Landroid/content/pm/ResolveInfo;)I
-    .locals 5
+    .locals 3
     .parameter "a"
     .parameter "b"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     iget-object v2, p0, Landroid/content/pm/ResolveInfo$DisplayNameComparator;->mPM:Landroid/content/pm/PackageManager;
@@ -71,7 +74,7 @@
 
     iget-object v2, p1, Landroid/content/pm/ResolveInfo;->activityInfo:Landroid/content/pm/ActivityInfo;
 
-    iget-object v0, v2, Landroid/content/pm/PackageItemInfo;->name:Ljava/lang/String;
+    iget-object v0, v2, Landroid/content/pm/ActivityInfo;->name:Ljava/lang/String;
 
     :cond_0
     iget-object v2, p0, Landroid/content/pm/ResolveInfo$DisplayNameComparator;->mPM:Landroid/content/pm/PackageManager;
@@ -85,20 +88,12 @@
 
     iget-object v2, p2, Landroid/content/pm/ResolveInfo;->activityInfo:Landroid/content/pm/ActivityInfo;
 
-    iget-object v1, v2, Landroid/content/pm/PackageItemInfo;->name:Ljava/lang/String;
+    iget-object v1, v2, Landroid/content/pm/ActivityInfo;->name:Ljava/lang/String;
 
     :cond_1
     iget-object v2, p0, Landroid/content/pm/ResolveInfo$DisplayNameComparator;->sCollator:Ljava/text/Collator;
 
-    invoke-virtual {v0}, Ljava/lang/Object;->toString()Ljava/lang/String;
-
-    move-result-object v3
-
-    invoke-virtual {v1}, Ljava/lang/Object;->toString()Ljava/lang/String;
-
-    move-result-object v4
-
-    invoke-virtual {v2, v3, v4}, Ljava/text/Collator;->compare(Ljava/lang/String;Ljava/lang/String;)I
+    invoke-static {v2, p1, v0, p2, v1}, Landroid/content/pm/ResolveInfo$Injector;->compare(Ljava/text/Collator;Landroid/content/pm/ResolveInfo;Ljava/lang/CharSequence;Landroid/content/pm/ResolveInfo;Ljava/lang/CharSequence;)I
 
     move-result v2
 
--- a/framework.jar.out/smali/android/content/res/Resources$Theme.smali
+++ b/framework.jar.out/smali/android/content/res/Resources$Theme.smali
@@ -140,7 +140,13 @@
 
     invoke-static/range {v0 .. v6}, Landroid/content/res/AssetManager;->applyStyle(IIII[I[I[I)Z
 
-    return-object v7
+    iget-object v0, p0, Landroid/content/res/Resources$Theme;->this$0:Landroid/content/res/Resources;
+
+    invoke-virtual {v0, v7}, Landroid/content/res/Resources;->loadOverlayTypedArray(Landroid/content/res/TypedArray;)Landroid/content/res/TypedArray;
+
+    move-result-object v0
+
+    return-object v0
 .end method
 
 .method public obtainStyledAttributes(Landroid/util/AttributeSet;[III)Landroid/content/res/TypedArray;
@@ -190,8 +196,13 @@
 
     iput-object v9, v7, Landroid/content/res/TypedArray;->mXml:Landroid/content/res/XmlBlock$Parser;
 
-    return-object v7
+    iget-object v0, p0, Landroid/content/res/Resources$Theme;->this$0:Landroid/content/res/Resources;
+
+    invoke-virtual {v0, v7}, Landroid/content/res/Resources;->loadOverlayTypedArray(Landroid/content/res/TypedArray;)Landroid/content/res/TypedArray;
 
+    move-result-object v0
+
+    return-object v0
     :cond_0
     const/4 v3, 0x0
 
@@ -232,7 +243,13 @@
 
     invoke-static/range {v0 .. v6}, Landroid/content/res/AssetManager;->applyStyle(IIII[I[I[I)Z
 
-    return-object v7
+    iget-object v0, p0, Landroid/content/res/Resources$Theme;->this$0:Landroid/content/res/Resources;
+
+    invoke-virtual {v0, v7}, Landroid/content/res/Resources;->loadOverlayTypedArray(Landroid/content/res/TypedArray;)Landroid/content/res/TypedArray;
+
+    move-result-object v0
+
+    return-object v0
 .end method
 
 .method public resolveAttribute(ILandroid/util/TypedValue;Z)Z
--- a/framework.jar.out/smali/android/content/res/Resources.smali
+++ b/framework.jar.out/smali/android/content/res/Resources.smali
@@ -4401,7 +4401,11 @@
 
     iput-object v2, v0, Landroid/content/res/TypedArray;->mXml:Landroid/content/res/XmlBlock$Parser;
 
-    return-object v0
+    invoke-virtual {p0, v0}, Landroid/content/res/Resources;->loadOverlayTypedArray(Landroid/content/res/TypedArray;)Landroid/content/res/TypedArray;
+
+    move-result-object v3
+
+    return-object v3
 .end method
 
 .method public obtainTypedArray(I)Landroid/content/res/TypedArray;
@@ -4473,7 +4477,11 @@
 
     aput v4, v2, v4
 
-    return-object v0
+    invoke-virtual {p0, v0}, Landroid/content/res/Resources;->loadOverlayTypedArray(Landroid/content/res/TypedArray;)Landroid/content/res/TypedArray;
+
+    move-result-object v2
+
+    return-object v2
 .end method
 
 .method public openRawResource(I)Ljava/io/InputStream;
@@ -5738,3 +5746,14 @@
 
     goto :goto_0
 .end method
+
+.method loadOverlayTypedArray(Landroid/content/res/TypedArray;)Landroid/content/res/TypedArray;
+    .locals 0
+    .parameter "array"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    return-object p1
+.end method
--- a/framework.jar.out/smali/android/telephony/PhoneNumberUtils.smali
+++ b/framework.jar.out/smali/android/telephony/PhoneNumberUtils.smali
@@ -2823,7 +2823,7 @@
     :cond_14
     move-object/from16 v0, p1
 
-    invoke-static {v0, v10, v4}, Landroid/telephony/PhoneNumberUtils;->checkPrefixIsIgnorable(Ljava/lang/String;II)Z
+    invoke-static {v0, v11, v4}, Landroid/telephony/PhoneNumberUtils;->checkPrefixIsIgnorable(Ljava/lang/String;II)Z
 
     move-result v18
 
--- a/framework.jar.out/smali/android/view/View.smali
+++ b/framework.jar.out/smali/android/view/View.smali
@@ -3425,6 +3425,14 @@
     :cond_b
     invoke-virtual/range {p0 .. p0}, Landroid/view/View;->computeOpaqueFlags()V
 
+    move-object/from16 v0, p0
+
+    move-object/from16 v1, p2
+
+    move/from16 v2, p3
+
+    invoke-static {v0, v1, v2}, Landroid/view/View$Injector;->initializeChildrenSequenceStates(Landroid/view/View;Landroid/util/AttributeSet;I)V
+
     return-void
 
     .restart local v9       #bottomPadding:I
--- a/framework.jar.out/smali/android/webkit/WebSettingsClassic.smali
+++ b/framework.jar.out/smali/android/webkit/WebSettingsClassic.smali
@@ -5516,3 +5516,32 @@
 
     throw v1
 .end method
+
+.method public declared-synchronized setNightReadModeEnabled(Z)V
+    .locals 1
+    .parameter "enable"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    monitor-enter p0
+
+    :try_start_0
+    iput-boolean p1, p0, Landroid/webkit/WebSettingsClassic;->mNightReadMode:Z
+
+    invoke-direct {p0}, Landroid/webkit/WebSettingsClassic;->postSync()V
+    :try_end_0
+    .catchall {:try_start_0 .. :try_end_0} :catchall_0
+
+    monitor-exit p0
+
+    return-void
+
+    :catchall_0
+    move-exception v0
+
+    monitor-exit p0
+
+    throw v0
+.end method
--- a/framework2.jar.out/smali/android/preference/PreferenceFrameLayout$LayoutParams.smali
+++ b/framework2.jar.out/smali/android/preference/PreferenceFrameLayout$LayoutParams.smali
@@ -13,6 +13,11 @@
     name = "LayoutParams"
 .end annotation
 
+.annotation system Ldalvik/annotation/MemberClasses;
+    value = {
+        Landroid/preference/PreferenceFrameLayout$LayoutParams$Injector;
+    }
+.end annotation
 
 # instance fields
 .field public removeBorders:Z
@@ -54,6 +59,13 @@
 
     .local v0, a:Landroid/content/res/TypedArray;
     invoke-virtual {v0, v2, v2}, Landroid/content/res/TypedArray;->getBoolean(IZ)Z
+    move-result v1
+
+    iput-boolean v1, p0, Landroid/preference/PreferenceFrameLayout$LayoutParams;->removeBorders:Z
+
+    iget-boolean v1, p0, Landroid/preference/PreferenceFrameLayout$LayoutParams;->removeBorders:Z
+
+    invoke-static {p1, v1}, Landroid/preference/PreferenceFrameLayout$LayoutParams$Injector;->isRemoveBorders(Landroid/content/Context;Z)Z
 
     move-result v1
 
--- a/framework2.jar.out/smali/android/widget/NumberPicker.smali
+++ b/framework2.jar.out/smali/android/widget/NumberPicker.smali
@@ -97,6 +97,11 @@
 
 .field private final mInputText:Landroid/widget/EditText;
 
+.field private mIsV5:Z
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_FIELD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+.end field
 .field private mLastDownEventTime:J
 
 .field private mLastDownEventY:F
@@ -327,6 +332,12 @@
 
     iput v14, v0, Landroid/widget/NumberPicker;->mScrollState:I
 
+    const/4 v14, 0x0
+
+    move-object/from16 v0, p0
+
+    iput-boolean v14, v0, Landroid/widget/NumberPicker;->mIsV5:Z
+
     sget-object v14, Lcom/android/internal/R$styleable;->NumberPicker:[I
 
     const/4 v15, 0x0
@@ -3302,6 +3313,18 @@
     goto :goto_0
 .end method
 
+.method protected adjustScrollWheel()V
+    .locals 0
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-direct {p0}, Landroid/widget/NumberPicker;->ensureScrollWheelAdjusted()Z
+
+    return-void
+.end method
+
 .method public computeScroll()V
     .locals 4
 
@@ -4330,12 +4353,17 @@
 
     :cond_2
     :goto_1
+    iget-boolean v3, p0, Landroid/widget/NumberPicker;->mIsV5:Z
+
+    if-nez v3, :cond_miui_1
+
     invoke-virtual {p0}, Landroid/widget/NumberPicker;->getParent()Landroid/view/ViewParent;
 
     move-result-object v3
 
     invoke-interface {v3, v1}, Landroid/view/ViewParent;->requestDisallowInterceptTouchEvent(Z)V
 
+    :cond_miui_1
     iget-object v3, p0, Landroid/widget/NumberPicker;->mFlingScroller:Landroid/widget/Scroller;
 
     invoke-virtual {v3}, Landroid/widget/Scroller;->isFinished()Z
@@ -4930,6 +4958,10 @@
 
     iput-boolean p4, p0, Landroid/widget/NumberPicker;->mNeedSoftInput:Z
 
+    const/4 v0, 0x1
+
+    iput-boolean v0, p0, Landroid/widget/NumberPicker;->mIsV5:Z
+
     return-void
 .end method
 
--- a/framework2.jar.out/smali/android/widget/ProgressBar.smali
+++ b/framework2.jar.out/smali/android/widget/ProgressBar.smali
@@ -895,6 +895,21 @@
 .end method
 
 .method private tileifyIndeterminate(Landroid/graphics/drawable/Drawable;)Landroid/graphics/drawable/Drawable;
+    .locals 1
+    .parameter "drawable"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-virtual {p0, p1}, Landroid/widget/ProgressBar;->tileifyIndeterminateMiui(Landroid/graphics/drawable/Drawable;)Landroid/graphics/drawable/Drawable;
+
+    move-result-object v0
+
+    return-object v0
+.end method
+
+.method public tileifyIndeterminateMiui(Landroid/graphics/drawable/Drawable;)Landroid/graphics/drawable/Drawable;
     .locals 8
     .parameter "drawable"
 
@@ -1171,6 +1186,20 @@
     return-void
 .end method
 
+.method public getBgDrawable()Landroid/graphics/drawable/Drawable;
+    .locals 1
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-virtual {p0}, Landroid/widget/ProgressBar;->getCurrentDrawable()Landroid/graphics/drawable/Drawable;
+
+    move-result-object v0
+
+    return-object v0
+.end method
+
 .method public getCurrentDrawable()Landroid/graphics/drawable/Drawable;
     .locals 1
 
--- a/framework2.jar.out/smali/com/android/internal/widget/ActionBarContainer.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ActionBarContainer.smali
@@ -2,15 +2,6 @@
 .super Landroid/widget/FrameLayout;
 .source "ActionBarContainer.java"
 
-
-# annotations
-.annotation system Ldalvik/annotation/MemberClasses;
-    value = {
-        Lcom/android/internal/widget/ActionBarContainer$Injector;
-    }
-.end annotation
-
-
 # instance fields
 .field private mActionBarView:Lcom/android/internal/widget/ActionBarView;
 
@@ -138,18 +129,6 @@
 
 
 # virtual methods
-.method getActionBarBackground()Landroid/graphics/drawable/Drawable;
-    .locals 1
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    iget-object v0, p0, Lcom/android/internal/widget/ActionBarContainer;->mBackground:Landroid/graphics/drawable/Drawable;
-
-    return-object v0
-.end method
-
 .method protected getActionBarView()Lcom/android/internal/widget/ActionBarView;
     .locals 1
     .annotation build Landroid/annotation/MiuiHook;
@@ -162,18 +141,6 @@
     return-object v0
 .end method
 
-.method getStackedBackground()Landroid/graphics/drawable/Drawable;
-    .locals 1
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
-
-    .prologue
-    iget-object v0, p0, Lcom/android/internal/widget/ActionBarContainer;->mStackedBackground:Landroid/graphics/drawable/Drawable;
-
-    return-object v0
-.end method
-
 .method public getTabContainer()Landroid/view/View;
     .locals 1
 
@@ -584,7 +551,7 @@
 
     move-result v12
 
-    invoke-static {p0, v9, v10, v11, v12}, Lcom/android/internal/widget/ActionBarContainer$Injector;->setBounds(Lcom/android/internal/widget/ActionBarContainer;IIII)V
+    invoke-virtual {v8, v9, v10, v11, v12}, Landroid/graphics/drawable/Drawable;->setBounds(IIII)V
 
     const/4 v6, 0x1
 
--- a/framework2.jar.out/smali/com/android/internal/widget/ActionBarView.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ActionBarView.smali
@@ -952,9 +952,9 @@
 
     move-result-object v8
 
-    check-cast v8, Landroid/widget/LinearLayout;
+    check-cast v8, Landroid/view/ViewGroup;
 
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+    iput-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     :goto_0
     iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
@@ -1210,9 +1210,9 @@
 
     move-result-object v8
 
-    check-cast v8, Landroid/widget/LinearLayout;
+    check-cast v8, Landroid/view/ViewGroup;
 
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
+    iput-object v8, p0, Lcom/android/internal/widget/ActionBarView;->mTitleLayout:Landroid/view/ViewGroup;
 
     goto/16 :goto_0
 
--- a/services.jar.out/smali/com/android/server/am/ActivityManagerService.smali
+++ b/services.jar.out/smali/com/android/server/am/ActivityManagerService.smali
@@ -1403,7 +1403,7 @@
     .local v1, systemDir:Ljava/io/File;
     invoke-virtual {v1}, Ljava/io/File;->mkdirs()Z
 
-    invoke-static {v1, v0}, Lmiui/os/Environment;->init(Ljava/io/File;Ljava/io/File;)V
+    invoke-static {}, Lcom/android/server/am/ExtraActivityManagerService;->init()V
 
     new-instance v2, Lcom/android/server/am/BatteryStatsService;
 
@@ -44823,6 +44823,12 @@
 
     invoke-direct/range {v2 .. v16}, Lcom/android/server/am/ActivityManagerService;->broadcastIntentLocked(Lcom/android/server/am/ProcessRecord;Ljava/lang/String;Landroid/content/Intent;Ljava/lang/String;Landroid/content/IIntentReceiver;ILjava/lang/String;Landroid/os/Bundle;Ljava/lang/String;ZZIII)I
 
+    move-object/from16 v0, p0
+
+    iget-object v2, v0, Lcom/android/server/am/ActivityManagerService;->mContext:Landroid/content/Context;
+
+    invoke-static {v2}, Lcom/android/server/am/ExtraActivityManagerService;->finishBooting(Landroid/content/Context;)V
+
     .end local v19           #nmsg:Landroid/os/Message;
     :cond_1
     const-string v2, "ActivityManager"
-- 
1.7.5.4


From b71d40cdd3bbf79a0f01220adeff475fcfdd0026 Mon Sep 17 00:00:00 2001
From: gexudong <gexudong@xiaomi.com>
Date: Tue, 26 Feb 2013 20:21:54 +0800
Subject: [PATCH 3/6] merge to cf00f0159085ba23a11b0bd9306a2824888a3677

Change-Id: I6d9190c5febfe099a0137a3bc1afab670df8b702
---
 framework.jar.out/smali/android/app/Activity.smali |   17 ++++++++++-------
 1 files changed, 10 insertions(+), 7 deletions(-)

--- a/framework.jar.out/smali/android/app/Activity.smali
+++ b/framework.jar.out/smali/android/app/Activity.smali
@@ -4938,12 +4938,8 @@
 
 .method protected onPause()V
     .locals 1
-    .annotation build Landroid/annotation/MiuiHook;
-        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
-    .end annotation
 
     .prologue
-    invoke-static {p0}, Landroid/app/Activity$Injector;->onWindowHide(Landroid/app/Activity;)V
 
     invoke-virtual {p0}, Landroid/app/Activity;->getApplication()Landroid/app/Application;
 
@@ -5169,8 +5165,6 @@
 
     invoke-static {p0}, Landroid/app/Activity$Injector;->checkAccessControl(Landroid/app/Activity;)V
 
-    invoke-static {p0}, Landroid/app/Activity$Injector;->onWindowShow(Landroid/app/Activity;)V
-
     return-void
 .end method
 
@@ -5638,10 +5632,15 @@
 
 .method final performPause()V
     .locals 3
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v2, 0x0
 
+    invoke-static {p0}, Landroid/app/Activity$Injector;->onWindowHide(Landroid/app/Activity;)V
+
     iget-object v0, p0, Landroid/app/Activity;->mFragments:Landroid/app/FragmentManagerImpl;
 
     invoke-virtual {v0}, Landroid/app/FragmentManagerImpl;->dispatchPause()V
@@ -5940,6 +5939,9 @@
 
 .method final performResume()V
     .locals 3
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
     const/4 v1, 0x0
@@ -6054,6 +6056,8 @@
     throw v0
 
     :cond_1
+    invoke-static {p0}, Landroid/app/Activity$Injector;->onWindowShow(Landroid/app/Activity;)V
+
     return-void
 .end method
 
-- 
1.7.5.4


From b66f4279cd6e359a1abd93ed2153010c3bd29c88 Mon Sep 17 00:00:00 2001
From: gexudong <gexudong@xiaomi.com>
Date: Wed, 27 Feb 2013 20:37:07 +0800
Subject: [PATCH 4/6] add V5 sys prop and fix the context for shutdown dialog

Change-Id: I5f7b6e50b9a124fc00d8a7281269e2148c2e1043
---
 other/build.prop                                   |    2 ++
 .../com/android/server/pm/ShutdownThread.smali     |    4 ++--
 2 files changed, 4 insertions(+), 2 deletions(-)

--- a/other/build.prop
+++ b/other/build.prop
@@ -88,3 +88,5 @@
 dalvik.vm.stack-trace-file=/data/anr/traces.txt
 
 ro.telephony.call_ring.multiple=false
+ro.miui.ui.version.code=3
+ro.miui.ui.version.name=V5
--- a/services.jar.out/smali/com/android/server/pm/ShutdownThread.smali
+++ b/services.jar.out/smali/com/android/server/pm/ShutdownThread.smali
@@ -1585,7 +1585,7 @@
 
     new-instance v1, Landroid/view/ContextThemeWrapper;
 
-    const v8, 0x103006e
+    const v8, 0x60d003a
 
     invoke-direct {v1, p0, v8}, Landroid/view/ContextThemeWrapper;-><init>(Landroid/content/Context;I)V
 
@@ -1752,7 +1752,7 @@
     :cond_3
     new-instance v1, Landroid/view/ContextThemeWrapper;
 
-    const v8, 0x103006e
+    const v8, 0x60d003a
 
     invoke-direct {v1, p0, v8}, Landroid/view/ContextThemeWrapper;-><init>(Landroid/content/Context;I)V
 
-- 
1.7.5.4


From 4ab6a4120a27763636ae223e65ebb02d740f02a4 Mon Sep 17 00:00:00 2001
From: gexudong <gexudong@xiaomi.com>
Date: Thu, 7 Mar 2013 11:48:50 +0800
Subject: [PATCH 5/6] merge V5 changes to
 8e7891465c02552cb82b5364092839ebcbb46ee3

Change-Id: I457ba0b7af944252ba592c85dbde22f509a6ceb8
---
 .../LockPatternKeyguardView$AccountAnalyzer.smali  |   24 +++++++++-
 .../android/app/ApplicationPackageManager.smali    |   24 +++++----
 .../smali/android/content/pm/PackageItemInfo.smali |    4 +-
 .../internal/widget/ActionBarContainer.smali       |   44 ++++++++++++++--
 .../server/net/NetworkPolicyManagerService.smali   |   52 +++++++++-----------
 .../smali/com/android/server/pm/Installer.smali    |   16 ++++++
 .../android/server/pm/PackageManagerService.smali  |   33 +++++++++++-
 7 files changed, 146 insertions(+), 51 deletions(-)

--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer.smali
@@ -32,7 +32,7 @@
 
 .field private final mAccountManager:Landroid/accounts/AccountManager;
 
-.field private final mAccounts:[Landroid/accounts/Account;
+.field private mAccounts:[Landroid/accounts/Account;
 
 .field final synthetic this$0:Lcom/android/internal/policy/impl/LockPatternKeyguardView;
 
@@ -58,6 +58,26 @@
 
     iput-object v0, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer;->mAccounts:[Landroid/accounts/Account;
 
+    iget-object v0, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer;->mAccounts:[Landroid/accounts/Account;
+
+    if-eqz v0, :cond_0
+
+    iget-object v0, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer;->mAccounts:[Landroid/accounts/Account;
+
+    array-length v0, v0
+
+    if-nez v0, :cond_1
+
+    :cond_0
+    const-string v0, "com.xiaomi"
+
+    invoke-virtual {p2, v0}, Landroid/accounts/AccountManager;->getAccountsByType(Ljava/lang/String;)[Landroid/accounts/Account;
+
+    move-result-object v0
+
+    iput-object v0, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView$AccountAnalyzer;->mAccounts:[Landroid/accounts/Account;
+
+    :cond_1
     return-void
 .end method
 
--- a/framework.jar.out/smali/android/app/ApplicationPackageManager.smali
+++ b/framework.jar.out/smali/android/app/ApplicationPackageManager.smali
@@ -1340,7 +1340,7 @@
 
     .local v3, name:Landroid/app/ApplicationPackageManager$ResourceName;
 
-    invoke-virtual {p0, v3}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
+    invoke-direct {p0, v3}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
 
     move-result-object v1
 
@@ -1385,7 +1385,7 @@
     move-result-object v1
 
     #invoke-static {v3, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
-    invoke-virtual {p0, v3, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+    invoke-direct {p0, v3, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
     :try_end_0
     .catch Ljava/lang/RuntimeException; {:try_start_0 .. :try_end_0} :catch_0
 
@@ -1695,15 +1695,16 @@
 
 .method public getDefaultActivityIcon()Landroid/graphics/drawable/Drawable;
     .locals 2
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->CHANGE_CODE:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
 
     .prologue
-    invoke-static {}, Landroid/content/res/Resources;->getSystem()Landroid/content/res/Resources;
-
-    move-result-object v0
+    iget-object v0, p0, Landroid/app/ApplicationPackageManager;->mContext:Landroid/app/ContextImpl;
 
-    const v1, 0x1080093
+    const-string v1, "sym_def_app_icon.png"
 
-    invoke-virtual {v0, v1}, Landroid/content/res/Resources;->getDrawable(I)Landroid/graphics/drawable/Drawable;
+    invoke-static {v0, v1}, Lmiui/content/res/IconCustomizer;->getCustomizedIcon(Landroid/content/Context;Ljava/lang/String;)Landroid/graphics/drawable/BitmapDrawable;
 
     move-result-object v0
 
@@ -1808,7 +1809,7 @@
 
     .local v6, name:Landroid/app/ApplicationPackageManager$ResourceName;
     #invoke-static {v6}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
-    invoke-virtual {p0, v6}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
+    invoke-direct {p0, v6}, Landroid/app/ApplicationPackageManager;->getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
 
     move-result-object v1
 
@@ -1846,7 +1847,7 @@
     move-result-object v1
 
     #invoke-static {v6, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
-    invoke-virtual {p0, v6, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+    invoke-direct {p0, v6, v1}, Landroid/app/ApplicationPackageManager;->putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
     :try_end_2
     .catch Landroid/content/pm/PackageManager$NameNotFoundException; {:try_start_2 .. :try_end_2} :catch_1
     .catch Landroid/content/res/Resources$NotFoundException; {:try_start_2 .. :try_end_2} :catch_3
@@ -3733,7 +3734,7 @@
     goto :goto_0
 .end method
 
-.method putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
+.method private putCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;Landroid/graphics/drawable/Drawable;)V
     .locals 4
     .parameter "name"
     .parameter "dr"
@@ -4674,7 +4675,7 @@
     goto :goto_0
 .end method
 
-.method getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
+.method private getCachedIcon(Landroid/app/ApplicationPackageManager$ResourceName;)Landroid/graphics/drawable/Drawable;
     .locals 4
     .parameter "name"
     .annotation build Landroid/annotation/MiuiHook;
--- a/framework.jar.out/smali/android/content/pm/PackageItemInfo.smali
+++ b/framework.jar.out/smali/android/content/pm/PackageItemInfo.smali
@@ -349,9 +349,9 @@
     const/4 v0, 0x0
 
     .local v0, dr:Landroid/graphics/drawable/Drawable;
-    iget v1, p0, Landroid/content/pm/PackageItemInfo;->icon:I
+    #iget v1, p0, Landroid/content/pm/PackageItemInfo;->icon:I
 
-    if-eqz v1, :cond_2
+    #if-eqz v1, :cond_2
 
     iget-object v1, p0, Landroid/content/pm/PackageItemInfo;->name:Ljava/lang/String;
 
--- a/framework2.jar.out/smali/com/android/internal/widget/ActionBarContainer.smali
+++ b/framework2.jar.out/smali/com/android/internal/widget/ActionBarContainer.smali
@@ -127,7 +127,42 @@
     goto :goto_0
 .end method
 
+.method private shouldPutTabsOnTop()Z
+    .locals 2
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    const/4 v0, 0x0
+
+    iget-object v1, p0, Lcom/android/internal/widget/ActionBarContainer;->mContext:Landroid/content/Context;
+
+    invoke-static {v1}, Lmiui/util/UiUtils;->isV5Ui(Landroid/content/Context;)Z
+
+    move-result v1
+
+    if-eqz v1, :cond_1
+
+    :cond_0
+    :goto_0
+    return v0
+
+    :cond_1
+    iget-object v1, p0, Lcom/android/internal/widget/ActionBarContainer;->mActionBarView:Lcom/android/internal/widget/ActionBarView;
+
+    invoke-virtual {v1}, Lcom/android/internal/widget/ActionBarView;->getDisplayOptions()I
+
+    move-result v1
+
+    and-int/lit8 v1, v1, 0x2
+
+    if-nez v1, :cond_0
 
+    const/4 v0, 0x1
+
+    goto :goto_0
+.end method
 # virtual methods
 .method protected getActionBarView()Lcom/android/internal/widget/ActionBarView;
     .locals 1
@@ -339,15 +374,11 @@
     move-result v7
 
     .local v7, tabHeight:I
-    iget-object v8, p0, Lcom/android/internal/widget/ActionBarContainer;->mActionBarView:Lcom/android/internal/widget/ActionBarView;
-
-    invoke-virtual {v8}, Lcom/android/internal/widget/ActionBarView;->getDisplayOptions()I
+    invoke-direct {p0}, Lcom/android/internal/widget/ActionBarContainer;->shouldPutTabsOnTop()Z
 
     move-result v8
 
-    and-int/lit8 v8, v8, 0xa
-
-    if-nez v8, :cond_7
+    if-eqz v8, :cond_7
 
     invoke-virtual {p0}, Lcom/android/internal/widget/ActionBarContainer;->getChildCount()I
 
--- a/services.jar.out/smali/com/android/server/net/NetworkPolicyManagerService.smali
+++ b/services.jar.out/smali/com/android/server/net/NetworkPolicyManagerService.smali
@@ -2119,7 +2119,7 @@
 .end method
 
 .method private getTotalBytes(Landroid/net/NetworkTemplate;JJ)J
-    .locals 9
+    .locals 10
     .parameter "template"
     .parameter "start"
     .parameter "end"
@@ -2128,37 +2128,33 @@
     .end annotation
 
     .prologue
-    const-wide/16 v7, 0x0
+    const-wide/16 v8, 0x0
 
     :try_start_0
-    iget-object v0, p0, Lcom/android/server/net/NetworkPolicyManagerService;->mNetworkStats:Landroid/net/INetworkStatsService;
+    iget-object v1, p0, Lcom/android/server/net/NetworkPolicyManagerService;->mNetworkStats:Landroid/net/INetworkStatsService;
 
-    move-object v1, p1
+    move-object v0, p0
 
-    move-wide v2, p2
+    move-object v2, p1
 
-    move-wide v4, p4
+    move-wide v3, p2
 
-    invoke-interface/range {v0 .. v5}, Landroid/net/INetworkStatsService;->getNetworkTotalBytes(Landroid/net/NetworkTemplate;JJ)J
+    move-wide v5, p4
 
-    move-result-wide v0
-
-    invoke-static/range {p0 .. p5}, Lcom/android/server/net/NetworkPolicyManagerService$Injector;->adjustMobileDataUsage(Lcom/android/server/net/NetworkPolicyManagerService;Landroid/net/NetworkTemplate;JJ)J
+    invoke-static/range {v0 .. v6}, Lcom/android/server/net/NetworkPolicyManagerService$Injector;->getNetworkTotalBytes(Lcom/android/server/net/NetworkPolicyManagerService;Landroid/net/INetworkStatsService;Landroid/net/NetworkTemplate;JJ)J
     :try_end_0
     .catch Ljava/lang/RuntimeException; {:try_start_0 .. :try_end_0} :catch_0
     .catch Landroid/os/RemoteException; {:try_start_0 .. :try_end_0} :catch_1
 
-    move-result-wide v2
-
-    add-long/2addr v0, v2
+    move-result-wide v0
 
     :goto_0
     return-wide v0
 
     :catch_0
-    move-exception v6
+    move-exception v7
 
-    .local v6, e:Ljava/lang/RuntimeException;
+    .local v7, e:Ljava/lang/RuntimeException;
     const-string v0, "NetworkPolicy"
 
     new-instance v1, Ljava/lang/StringBuilder;
@@ -2171,7 +2167,7 @@
 
     move-result-object v1
 
-    invoke-virtual {v1, v6}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
+    invoke-virtual {v1, v7}, Ljava/lang/StringBuilder;->append(Ljava/lang/Object;)Ljava/lang/StringBuilder;
 
     move-result-object v1
 
@@ -2181,16 +2177,16 @@
 
     invoke-static {v0, v1}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
 
-    move-wide v0, v7
+    move-wide v0, v8
 
     goto :goto_0
 
-    .end local v6           #e:Ljava/lang/RuntimeException;
+    .end local v7           #e:Ljava/lang/RuntimeException;
     :catch_1
-    move-exception v6
+    move-exception v7
 
-    .local v6, e:Landroid/os/RemoteException;
-    move-wide v0, v7
+    .local v7, e:Landroid/os/RemoteException;
+    move-wide v0, v8
 
     goto :goto_0
 .end method
--- a/services.jar.out/smali/com/android/server/pm/Installer.smali
+++ b/services.jar.out/smali/com/android/server/pm/Installer.smali
@@ -711,6 +711,21 @@
 
 
 # virtual methods
+.method public callExecute(Ljava/lang/String;)I
+    .locals 1
+    .parameter "cmd"
+    .annotation build Landroid/annotation/MiuiHook;
+        value = .enum Landroid/annotation/MiuiHook$MiuiHookType;->NEW_METHOD:Landroid/annotation/MiuiHook$MiuiHookType;
+    .end annotation
+
+    .prologue
+    invoke-direct {p0, p1}, Lcom/android/server/pm/Installer;->execute(Ljava/lang/String;)I
+
+    move-result v0
+
+    return v0
+.end method
+
 .method public clearUserData(Ljava/lang/String;I)I
     .locals 3
     .parameter "name"
--- a/services.jar.out/smali/com/android/server/pm/PackageManagerService.smali
+++ b/services.jar.out/smali/com/android/server/pm/PackageManagerService.smali
@@ -1226,13 +1226,22 @@
     invoke-static {v2, v3}, Landroid/util/Slog;->w(Ljava/lang/String;Ljava/lang/String;)I
 
     :goto_1
-    new-instance v2, Lcom/android/server/pm/Installer;
+    new-instance v2, Lcom/android/server/pm/MiuiInstaller;
 
-    invoke-direct {v2}, Lcom/android/server/pm/Installer;-><init>()V
+    invoke-direct {v2}, Lcom/android/server/pm/MiuiInstaller;-><init>()V
 
     move-object/from16 v0, p0
 
     iput-object v2, v0, Lcom/android/server/pm/PackageManagerService;->mInstaller:Lcom/android/server/pm/Installer;
+    move-object/from16 v0, p0
+
+    iget-object v2, v0, Lcom/android/server/pm/PackageManagerService;->mContext:Landroid/content/Context;
+
+    move-object/from16 v0, p0
+
+    iget-object v3, v0, Lcom/android/server/pm/PackageManagerService;->mInstaller:Lcom/android/server/pm/Installer;
+
+    invoke-static {v2, v3}, Lcom/android/server/pm/PackageManagerService$Injector;->startMiuiShellService(Landroid/content/Context;Lcom/android/server/pm/Installer;)V
 
     const-string v2, "window"
 
@@ -4629,8 +4638,21 @@
     goto :goto_0
 
     :cond_3
-    iget-object v0, p0, Lcom/android/server/pm/PackageManagerService;->mResolveInfo:Landroid/content/pm/ResolveInfo;
+    iget-object v5, p0, Lcom/android/server/pm/PackageManagerService;->mResolveInfo:Landroid/content/pm/ResolveInfo;
+
+    move-object v0, p0
 
+    move-object v1, p1
+
+    move-object v2, p2
+
+    move v3, p3
+
+    move/from16 v4, p5
+
+    invoke-static/range {v0 .. v5}, Lcom/android/server/pm/PackageManagerService$Injector;->checkMiuiHomeIntent(Lcom/android/server/pm/PackageManagerService;Landroid/content/Intent;Ljava/lang/String;IILandroid/content/pm/ResolveInfo;)Landroid/content/pm/ResolveInfo;
+
+    move-result-object v0
     goto :goto_0
 
     .end local v7           #N:I
@@ -39330,6 +39352,9 @@
     .local v5, permFile:Ljava/io/File;
     invoke-direct {p0, v5}, Lcom/android/server/pm/PackageManagerService;->readPermissionsFromXml(Ljava/io/File;)V
 
+    iget-object v6, p0, Lcom/android/server/pm/PackageManagerService;->mAvailableFeatures:Ljava/util/HashMap;
+
+    invoke-static {v6}, Lcom/android/server/pm/PackageManagerService$Injector;->addAvailableFeatures(Ljava/util/HashMap;)V
     goto/16 :goto_0
 .end method
 
-- 
1.7.5.4


From 297e65a9cf24b89e2a80d937e12bf0af4c367cdd Mon Sep 17 00:00:00 2001
From: gexudong <gexudong@xiaomi.com>
Date: Thu, 7 Mar 2013 21:00:14 +0800
Subject: [PATCH 6/6] merge change for
 dacebe89f805c4bd757d5aed391a317a6298fe92

Change-Id: Ia0cb7c2fedf8ed682c7d2b14a49c3d584a41ea08
---
 .../policy/impl/LockPatternKeyguardView.smali      |    4 +++-
 1 files changed, 3 insertions(+), 1 deletions(-)

--- a/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView.smali
+++ b/android.policy.jar.out/smali/com/android/internal/policy/impl/LockPatternKeyguardView.smali
@@ -4845,7 +4845,9 @@
 
     iget-object v7, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mLockPatternUtils:Lcom/android/internal/widget/LockPatternUtils;
 
-    invoke-direct/range {v2 .. v7}, Lcom/android/internal/policy/impl/MiuiAccountUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;Lcom/android/internal/widget/LockPatternUtils;)V
+    iget-boolean v8, p0, Lcom/android/internal/policy/impl/LockPatternKeyguardView;->mForgotPattern:Z
+
+    invoke-direct/range {v2 .. v8}, Lcom/android/internal/policy/impl/MiuiAccountUnlockScreen;-><init>(Landroid/content/Context;Landroid/content/res/Configuration;Lcom/android/internal/policy/impl/KeyguardUpdateMonitor;Lcom/android/internal/policy/impl/KeyguardScreenCallback;Lcom/android/internal/widget/LockPatternUtils;Z)V
     :try_end_0
     .catch Ljava/lang/IllegalStateException; {:try_start_0 .. :try_end_0} :catch_0
 
-- 
1.7.5.4

